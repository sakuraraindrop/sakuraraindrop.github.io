<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>hackasat-2022-quals | cheng_xing's blog</title><meta name="author" content="cheng_xing"><meta name="copyright" content="cheng_xing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="black-hole先构建docker镜像 1docker build -f challenge&#x2F;Dockerfile challenge -t black_hole:challenge  然后 1socat -v tcp-listen:31337,reuseaddr exec:&quot;docker run --rm -i black_hole\:challenge&quot;  后面就能通过">
<meta property="og:type" content="article">
<meta property="og:title" content="hackasat-2022-quals">
<meta property="og:url" content="https://sakuraraindrop.github.io/2025/09/30/hackasat-2022-quals/index.html">
<meta property="og:site_name" content="cheng_xing&#39;s blog">
<meta property="og:description" content="black-hole先构建docker镜像 1docker build -f challenge&#x2F;Dockerfile challenge -t black_hole:challenge  然后 1socat -v tcp-listen:31337,reuseaddr exec:&quot;docker run --rm -i black_hole\:challenge&quot;  后面就能通过">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sakuraraindrop.github.io/img/ltx.jpg">
<meta property="article:published_time" content="2025-09-30T12:06:48.000Z">
<meta property="article:modified_time" content="2025-10-03T13:08:13.497Z">
<meta property="article:author" content="cheng_xing">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sakuraraindrop.github.io/img/ltx.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "hackasat-2022-quals",
  "url": "https://sakuraraindrop.github.io/2025/09/30/hackasat-2022-quals/",
  "image": "https://sakuraraindrop.github.io/img/ltx.jpg",
  "datePublished": "2025-09-30T12:06:48.000Z",
  "dateModified": "2025-10-03T13:08:13.497Z",
  "author": [
    {
      "@type": "Person",
      "name": "cheng_xing",
      "url": "https://sakuraraindrop.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/ltx-icon.jpg"><link rel="canonical" href="https://sakuraraindrop.github.io/2025/09/30/hackasat-2022-quals/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'hackasat-2022-quals',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/hk.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">147</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/hk.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/ltx-icon.jpg" alt="Logo"><span class="site-name">cheng_xing's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">hackasat-2022-quals</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">hackasat-2022-quals</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-09-30T12:06:48.000Z" title="发表于 2025-09-30 20:06:48">2025-09-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-03T13:08:13.497Z" title="更新于 2025-10-03 21:08:13">2025-10-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SAT/">SAT</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="black-hole"><a href="#black-hole" class="headerlink" title="black-hole"></a>black-hole</h2><p>先构建docker镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f challenge/Dockerfile challenge -t black_hole:challenge</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:31337,reuseaddr exec:&quot;docker run --rm -i black_hole\:challenge&quot;</span><br></pre></td></tr></table></figure>

<p>后面就能通过nc与31337端口交互</p>
<p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># Local imports</span></span><br><span class="line"><span class="keyword">from</span> libs.timeout <span class="keyword">import</span> timeout, TimeoutError, MINUTE</span><br><span class="line"></span><br><span class="line">MSG_SIZE = <span class="number">256</span></span><br><span class="line">LOWER_RANDOM_MSG_SIZE = <span class="built_in">int</span>(MSG_SIZE * <span class="number">0.55</span>)</span><br><span class="line">UPPER_RANDOM_MSG_SIZE = <span class="built_in">int</span>(LOWER_RANDOM_MSG_SIZE * <span class="number">0.37</span>) + LOWER_RANDOM_MSG_SIZE</span><br><span class="line">NUM_OF_BYTES_GUESSES = UPPER_RANDOM_MSG_SIZE*(UPPER_RANDOM_MSG_SIZE+<span class="number">1</span>) // <span class="number">2</span> + <span class="number">3</span>*UPPER_RANDOM_MSG_SIZE</span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenge enviroment variables</span></span><br><span class="line">FLAG = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;flag&#123;0bscur3!s3cur3&#125;&quot;</span>)</span><br><span class="line">TO = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;TIMEOUT&quot;</span>, <span class="number">5</span> * MINUTE))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print properly in docker/socket env</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">p</span>(<span class="params">s, end=<span class="string">&quot;\n&quot;</span>, flush=<span class="literal">True</span></span>):</span><br><span class="line">    sys.stdout.write(<span class="string">f&quot;<span class="subst">&#123;s&#125;</span><span class="subst">&#123;end&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> flush: sys.stdout.flush() </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlackHole</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.encoding = defaultdict(<span class="built_in">dict</span>)</span><br><span class="line">        <span class="variable language_">self</span>.create_transpositions()</span><br><span class="line">        <span class="variable language_">self</span>.create_random_msgs()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_transpositions</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> num_len <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,MSG_SIZE+<span class="number">1</span>):</span><br><span class="line">            perm = np.random.permutation(MSG_SIZE)</span><br><span class="line">            <span class="variable language_">self</span>.encoding[num_len][<span class="string">&quot;trans&quot;</span>] = <span class="built_in">list</span>(perm[:num_len])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_random_msgs</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> num_len <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,MSG_SIZE+<span class="number">1</span>):</span><br><span class="line">            <span class="variable language_">self</span>.encoding[num_len][<span class="string">&#x27;encode&#x27;</span>] = <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">            <span class="keyword">while</span>(<span class="string">b&#x27;\x00&#x27;</span> <span class="keyword">in</span> <span class="variable language_">self</span>.encoding[num_len][<span class="string">&#x27;encode&#x27;</span>]):</span><br><span class="line">                <span class="variable language_">self</span>.encoding[num_len][<span class="string">&#x27;encode&#x27;</span>] = secrets.token_bytes(MSG_SIZE)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encode_msg</span>(<span class="params">self, msg</span>):</span><br><span class="line">        msg_nums, msg_len = <span class="built_in">list</span>(msg), <span class="built_in">len</span>(msg)</span><br><span class="line"></span><br><span class="line">        encoded_msg = <span class="built_in">list</span>(<span class="variable language_">self</span>.encoding[msg_len][<span class="string">&quot;encode&quot;</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> idx, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg_nums):</span><br><span class="line">            encoded_msg[<span class="variable language_">self</span>.encoding[msg_len][<span class="string">&quot;trans&quot;</span>][idx]] ^= num</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(encoded_msg) == MSG_SIZE</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(encoded_msg)</span><br><span class="line"></span><br><span class="line"><span class="meta">@timeout(<span class="params">TO</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params">bh</span>):</span><br><span class="line">    success = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    rnd_msg_size = random.randint(LOWER_RANDOM_MSG_SIZE, UPPER_RANDOM_MSG_SIZE)</span><br><span class="line">    <span class="keyword">while</span>(<span class="string">b&#x27;\x00&#x27;</span> <span class="keyword">in</span> (random_msg := secrets.token_bytes(rnd_msg_size))): <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    random_msg = bh.encode_msg(random_msg)</span><br><span class="line"></span><br><span class="line">    p(<span class="string">f&quot;Encoded msg is: <span class="subst">&#123;binascii.hexlify(random_msg).decode()&#125;</span>&quot;</span>)</span><br><span class="line">    p(<span class="string">f&quot;We can stream <span class="subst">&#123;NUM_OF_BYTES_GUESSES&#125;</span> bytes of data before the sat kills the connection. Please help. (Send your message in hex.)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">p_err_and_sub</span>(<span class="params">err_msg</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> bytes_left</span><br><span class="line">        p(err_msg)</span><br><span class="line">        bytes_left -= l_len</span><br><span class="line"></span><br><span class="line">    bytes_left = NUM_OF_BYTES_GUESSES</span><br><span class="line">    <span class="keyword">while</span> bytes_left &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> success:</span><br><span class="line">        p(<span class="string">f&quot;(<span class="subst">&#123;bytes_left&#125;</span>) Msg: &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        line = sys.stdin.readline()</span><br><span class="line">        </span><br><span class="line">        line = line.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">        l_len = <span class="built_in">len</span>(line)</span><br><span class="line">        bytes_left -= (l_len // <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> l_len % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            p(<span class="string">&quot;Must provide even-length string&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> l_len &gt; <span class="number">2</span>*(MSG_SIZE-<span class="number">1</span>):</span><br><span class="line">            p(<span class="string">f&quot;Size of msg cannot be greater than <span class="subst">&#123;MSG_SIZE-<span class="number">1</span>&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> l_len == <span class="number">0</span>:</span><br><span class="line">            p(<span class="string">f&quot;Size of msg must be greater than 0&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">elif</span> bytes_left &lt; <span class="number">0</span>:</span><br><span class="line">            bytes_left += (l_len // <span class="number">2</span>)</span><br><span class="line">            p(<span class="string">f&quot;Msg too large, you only have <span class="subst">&#123;bytes_left&#125;</span> bytes left...&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Check to make sure that the message doesn&#x27;t contain &quot;00&quot; on a byte alignment</span></span><br><span class="line">        <span class="keyword">for</span> b_idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(line)-<span class="number">2</span>, <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;00&quot;</span> == line[b_idx:b_idx+<span class="number">2</span>]:</span><br><span class="line">                p(<span class="string">&quot;Must provide message with no NULL bytes (00)&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            msg = binascii.unhexlify(line)</span><br><span class="line">        <span class="keyword">except</span> binascii.Error <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">str</span>(e) == <span class="string">&quot;Odd-length string&quot;</span>:</span><br><span class="line">                p(<span class="string">&quot;Must provide even-length string&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># exit(-1)</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">str</span>(e) == <span class="string">&quot;Non-hexadecimal digit found&quot;</span>:</span><br><span class="line">                p(<span class="string">&quot;Must provide hexadecimal digits only&quot;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># exit(-1)</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">        encoded_msg = bh.encode_msg(msg)</span><br><span class="line">        encoded_msg_hex = binascii.hexlify(encoded_msg).decode()</span><br><span class="line"></span><br><span class="line">        p(encoded_msg_hex)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> encoded_msg == random_msg:</span><br><span class="line">            p(<span class="string">f&quot;Satellite-link synced! Flag: <span class="subst">&#123;FLAG&#125;</span>&quot;</span>)</span><br><span class="line">            exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> success</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p(<span class="string">&quot;Generating black hole...\n&quot;</span>)</span><br><span class="line">    bh = BlackHole()</span><br><span class="line"></span><br><span class="line">    sys.stdin.flush()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        success = challenge(bh)</span><br><span class="line">    <span class="keyword">except</span> TimeoutError:</span><br><span class="line">        p(<span class="string">&quot;\nTimeout, Bye&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> success:</span><br><span class="line">        p(<span class="string">&quot;You ran out of data to send! Bye.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>程序生成一个长度为 n 的随机明文（不含 0x00），经自定义编码器得到 256 字节密文 Y（十六进制打印给挑战者）。随后进入交互循环，可以多次提交十六进制字符串，服务将返回对应编码后的 256 字节十六进制。若某次返回值恰好等于最初打印的 Y，即判定同步成功并输出 flag。</p>
<p>全局参数与配额</p>
<ul>
<li><code>MSG_SIZE = 256</code>；</li>
<li>随机明文长度 <code>n</code> 在区间<br><code>LOWER_RANDOM_MSG_SIZE = ⌊256×0.55⌋ = 140</code> 与<br><code>UPPER_RANDOM_MSG_SIZE = 140 + ⌊140×0.37⌋ = 191</code> 之间；</li>
<li>交互总预算字节（按提交<strong>明文字节数</strong>累计）为<br><code>NUM_OF_BYTES_GUESSES = 191×192/2 + 3×191 = 18909</code>。</li>
</ul>
<p>输入限制在循环内严格检查：必须偶数字符、长度 ≤ <code>2*(MSG_SIZE-1)</code>、不得包含“00”字节（按字节对齐），否则提示并继续。</p>
<p>编码器结构</p>
<p>类 <code>BlackHole</code> 的初始化构造了两套与长度相关的参数：</p>
<ul>
<li><strong>置换表</strong> <code>trans_L</code>：对每个 <code>L∈[1..256]</code>，先生成 <code>np.random.permutation(256)</code>，取前 <code>L</code> 个作为该长度的投影位置们；</li>
<li><strong>底板</strong> <code>E_L</code>：对每个 <code>L</code>，生成一个<strong>不含 0x00</strong>的 256 字节随机串。</li>
</ul>
<p>编码函数 <code>encode_msg(m)</code> 的规则是：<br>把 <code>E_|m|</code> 复制为可变数组，然后对 <code>i=0..|m|-1</code>，令<br><code>encoded[trans_|m|[i]] ^= m[i]</code>。返回 256 字节结果</p>
<p>目标密文</p>
<p>挑战开始时，随机取 <code>n∈[140..191]</code>，生成长度为 <code>n</code> 的随机明文 <code>R</code>（不含 <code>0x00</code>），计算<br><code>Y = encode_msg(R) = E_n ⊕ P_n(R)</code>，并把 <code>Y</code> 的 hex 打印出来。这里 <code>P_n(·)</code> 表示把长度为 n 的向量按 <code>trans_n</code> 扔到 256 维上并异或聚合的线性映射。</p>
<p>解题推导（线性 + 碰撞判定）</p>
<p>目标是构造某条提交 <code>M*</code> 使 <code>encode_msg(M*) == Y</code>。由线性结构可知：</p>
<p>$$\text{encode}_n(M) &#x3D; E_n \oplus P_n(M)$$</p>
<p>因此当我们能恢复 <strong><code>n</code>、<code>trans_n</code> 与 <code>E_n</code> 的受影响位置</strong> 后，便可由</p>
<p>$$R[i] &#x3D; Y[\text{trans}_n[i]] \oplus E_n[\text{trans}_n[i]]$$</p>
<p>逐字节反推出目标明文 <code>R</code>，提交即获胜。关键是：<strong>如何在预算内恢复这些量</strong>。</p>
<p>第一步：判定真实长度 <code>n</code></p>
<p>策略：对每个候选 <code>L∈[140..191]</code>，发送全 <code>0x01</code> 的消息 <code>1^L</code>，得到</p>
<p>$$O1_L &#x3D; E_L \oplus P_L(1,1,\dots,1)$$</p>
<p>与目标 <code>Y=E_n\oplus P_n(R)</code> 做逐字节比较，计算不等计数 <code>H_L</code>。</p>
<ul>
<li>若 <code>L≠n</code>：<code>E_L</code> 与 <code>E_n</code> 独立随机，几乎所有 256 处都会不同，<code>H_L≈256</code>（实验中通常 250+）。</li>
<li>若 <code>L= n</code>：<code>E_n</code> 抵消，只在 <code>trans_n</code> 这 <code>n</code> 个位置出现 <code>1⊕R[i]</code> 的差异，其余 256−n 位置两边都是 <code>E_n</code>，因而 <strong><code>H_n≈n</code></strong>。</li>
</ul>
<p>于是<strong>取 <code>H_L</code> 最小的 L 即为 n</strong>。这一步的字节成本为</p>
<p>$$\sum_{L&#x3D;140}^{191} L &#x3D; 8606 \ll 18909$$</p>
<p>完全可行。上述判定逻辑与预算上限，均可在源码参数与循环里印证。 </p>
<blockquote>
<p>赛中日志如 <code>Detected n = 177, distance = 175</code> 即是该步的产物，距离值与 <code>n</code> 接近符合预期。</p>
</blockquote>
<p>第二步：一次”打标”恢复置换 <code>trans_n</code> 与底板差分</p>
<p>在已经固定 <code>n</code> 的情况下，再发送一条长度为 <code>n</code> 的<strong>标号消息</strong>：</p>
<p>$$M_{\text{map}} &#x3D; (2,3,4,\dots, n+1)$$</p>
<p>（避免 0x00 与 0x01），得到</p>
<p>$$Omap &#x3D; E_n \oplus P_n(M_{\text{map}})$$</p>
<p>把它与 $O1_n &#x3D; E_n \oplus P_n(1,1,\dots,1)$ 做差：</p>
<p>$$<br>Omap[p] \oplus O1_n[p] &#x3D;<br>\begin{cases}<br>v_i \oplus 0x01, &amp; p &#x3D; \text{trans}_n[i] \newline<br>0, &amp; \text{否则}<br>\end{cases}<br>$$<br>因此所有非零差分的位置集合正好是置换像集 $$S &#x3D; {\text{trans}_n[i]}$$。并且每个差分值唯一对应 <code>i</code>：</p>
<p>$$i &#x3D; \big(Omap[p]\oplus O1_n[p]\oplus 0x01\big) - 2$$</p>
<p>即可恢复<strong>完整的 <code>trans_n</code> 映射</strong>。此外，在这些受影响位置 <code>p</code> 上，</p>
<p>$$E_n[p] &#x3D; O1_n[p] \oplus 0x01$$</p>
<p>从而也得到与 <code>R</code> 相关的 <code>E_n</code> 片段。该步只需再花费 <code>n</code> 字节预算。</p>
<p>第三步：反推 <code>R</code> 并提交</p>
<p>对每个 <code>i∈[0..n-1]</code>，令 <code>p = trans_n[i]</code>，有</p>
<p>$$R[i] &#x3D; Y[p] \oplus E_n[p]$$</p>
<p>得到 <code>R</code> 后把它发回即可使 <code>encode_n(R)=Y</code>，触发输出 flag。该步再用 <code>n</code> 字节。合计预算</p>
<p>$$8606 + n + n \le 8606 + 382 &#x3D; 8988 \ll 18909$$</p>
<p>稳稳在限制之内。预算与限制参见源码定义与输入计数逻辑。 </p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">&quot;10.249.10.107&quot;</span>, <span class="number">31337</span></span><br><span class="line">MSG_SIZE = <span class="number">256</span></span><br><span class="line">LOWER = <span class="built_in">int</span>(MSG_SIZE * <span class="number">0.55</span>)          <span class="comment"># 140</span></span><br><span class="line">UPPER = <span class="built_in">int</span>(LOWER * <span class="number">0.37</span>) + LOWER     <span class="comment"># 191</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_bytes</span>(<span class="params">hexstr</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(hexstr.strip())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_hex</span>(<span class="params">bs</span>):</span><br><span class="line">    <span class="keyword">return</span> bs.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_until_prompt</span>(<span class="params">io</span>):</span><br><span class="line">    data = io.recvuntil(<span class="string">b&quot;) Msg: &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> data.decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_and_get</span>(<span class="params">io, msg_bytes</span>):</span><br><span class="line">    io.sendline(to_hex(msg_bytes).encode())</span><br><span class="line">    <span class="comment"># 服务先回一行编码后的 512 hex，再打印下一次提示</span></span><br><span class="line">    enc_line = io.recvline().strip().decode()</span><br><span class="line">    _ = io.recvuntil(<span class="string">b&quot;) Msg: &quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> to_bytes(enc_line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = remote(HOST, PORT)</span><br><span class="line">    banner = recv_until_prompt(io)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 抓目标 Y</span></span><br><span class="line">    m = re.search(<span class="string">r&quot;Encoded msg is:\s*([0-9a-fA-F]+)&quot;</span>, banner)</span><br><span class="line">    <span class="keyword">assert</span> m, <span class="string">&quot;Failed to find target hex&quot;</span></span><br><span class="line">    Y = to_bytes(m.group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(Y) == MSG_SIZE</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Phase 1: 扫描 L，发 0x01*L</span></span><br><span class="line">    O1_by_L = &#123;&#125;</span><br><span class="line">    dist_by_L = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> L <span class="keyword">in</span> <span class="built_in">range</span>(LOWER, UPPER + <span class="number">1</span>):</span><br><span class="line">        msg = <span class="built_in">bytes</span>([<span class="number">0x01</span>]) * L</span><br><span class="line">        out = send_and_get(io, msg)</span><br><span class="line">        O1_by_L[L] = out</span><br><span class="line">        <span class="comment"># Hamming（逐字节不相等计数）</span></span><br><span class="line">        dist_by_L[L] = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(MSG_SIZE) <span class="keyword">if</span> out[i] != Y[i])</span><br><span class="line"></span><br><span class="line">    n = <span class="built_in">min</span>(dist_by_L, key=dist_by_L.get)</span><br><span class="line">    log.info(<span class="string">f&quot;Detected n = <span class="subst">&#123;n&#125;</span>, distance = <span class="subst">&#123;dist_by_L[n]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    O1 = O1_by_L[n]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Phase 2: 一次性标号，恢复 trans 和 E</span></span><br><span class="line">    v = [i + <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]  <span class="comment"># all distinct, avoid 0x00/0x01</span></span><br><span class="line">    Mmap = <span class="built_in">bytes</span>(v)</span><br><span class="line">    Omap = send_and_get(io, Mmap)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 找出被影响的位置集合 S（Omap 与 O1 不同的位置）</span></span><br><span class="line">    S = [p <span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(MSG_SIZE) <span class="keyword">if</span> Omap[p] != O1[p]]</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(S) == n, <span class="string">f&quot;Unexpected affected positions: <span class="subst">&#123;<span class="built_in">len</span>(S)&#125;</span> != <span class="subst">&#123;n&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    trans = [<span class="literal">None</span>] * n              <span class="comment"># trans[i] = position p</span></span><br><span class="line">    En = <span class="built_in">bytearray</span>(O1)              <span class="comment"># start from O1; fix S positions to get E</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> S:</span><br><span class="line">        delta = Omap[p] ^ O1[p]     <span class="comment"># = v_i ^ 0x01</span></span><br><span class="line">        vi = delta ^ <span class="number">0x01</span></span><br><span class="line">        i = vi - <span class="number">2</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="number">0</span> &lt;= i &lt; n</span><br><span class="line">        trans[i] = p</span><br><span class="line">        En[p] = O1[p] ^ <span class="number">0x01</span>        <span class="comment"># restore E at this position</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">all</span>(t <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">for</span> t <span class="keyword">in</span> trans)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Phase 3: 还原 R 并提交</span></span><br><span class="line">    R = <span class="built_in">bytearray</span>(n)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        p = trans[i]</span><br><span class="line">        R[i] = Y[p] ^ En[p]</span><br><span class="line">        <span class="keyword">assert</span> R[i] != <span class="number">0</span>            <span class="comment"># 题目保证随机明文不含 0x00</span></span><br><span class="line"></span><br><span class="line">    final = <span class="built_in">bytes</span>(R)</span><br><span class="line">    <span class="comment"># 发送最终消息，服务应回 Flag</span></span><br><span class="line">    io.sendline(to_hex(final).encode())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 服务器会先回一行编码后的hex，再回一行包含 Flag 的提示，然后断开</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        line = io.recvline(timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(line.decode(errors=<span class="string">&quot;ignore&quot;</span>), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Flag&quot;</span> <span class="keyword">in</span> line.decode(errors=<span class="string">&quot;ignore&quot;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Flag found!&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    io.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="sunfun"><a href="#sunfun" class="headerlink" title="sunfun"></a>sunfun</h2><p>Dockerfile里要把python-dev换为python3-dev</p>
<p>先构建docker镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build challenge -t sunfun:challenge</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:12345,reuseaddr exec:&quot;docker run --rm -i -e FLAG=flag&#123;zulu49225delta\:GG1EnNVMK3-hPvlNKAdEJxcujvp9WK4rEchuEdlDp3yv_Wh_uvB5ehGq-fyRowvwkWpdAMTKbidqhK4JhFsaz1k&#125; sunfun\:challenge&quot;</span><br></pre></td></tr></table></figure>

<p>后面就能通过nc与12345端口交互</p>
<p>challenge.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fun in the Sun Challenge</span></span><br><span class="line"><span class="keyword">from</span> cmath <span class="keyword">import</span> acos, pi</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> dot, cross</span><br><span class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> norm</span><br><span class="line"><span class="keyword">from</span> skyfield.api <span class="keyword">import</span> load, wgs84</span><br><span class="line">ts = load.timescale()</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> timeout <span class="keyword">import</span> timeout, TimeoutError</span><br><span class="line">time = <span class="built_in">int</span>(os.getenv(<span class="string">&quot;TIMEOUT&quot;</span>,<span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Challenge Intro</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_intro</span>():</span><br><span class="line">    art = [</span><br><span class="line">        <span class="string">&quot;            FUN                   &quot;</span>,</span><br><span class="line">        <span class="string">&quot;              IN                  &quot;</span>,</span><br><span class="line">        <span class="string">&quot;                THE               &quot;</span>,</span><br><span class="line">        <span class="string">&quot;                  SUN!!           &quot;</span>,</span><br><span class="line">        <span class="string">&quot;                                  &quot;</span>,</span><br><span class="line">        <span class="string">&quot;               y                  &quot;</span>,</span><br><span class="line">        <span class="string">&quot;              /              .    &quot;</span>,</span><br><span class="line">        <span class="string">&quot;           ////             &lt;O&gt;   &quot;</span>,</span><br><span class="line">        <span class="string">&quot;          ////o--z           &#x27;    &quot;</span>,</span><br><span class="line">        <span class="string">&quot;            |                     &quot;</span>,</span><br><span class="line">        <span class="string">&quot;            x                     &quot;</span>,</span><br><span class="line">        <span class="string">&quot; &quot;</span>,</span><br><span class="line">        <span class="string">&quot; &quot;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> art:</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line">        sleep(<span class="number">0.05</span>)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quaternion</span>(<span class="params">u,v</span>):</span><br><span class="line">    u = u / norm(u)</span><br><span class="line">    v = v / norm(v)</span><br><span class="line"></span><br><span class="line">    q = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">    q[<span class="number">0</span>:<span class="number">3</span>] = cross(u,v)</span><br><span class="line">    q[<span class="number">3</span>] = <span class="number">1</span> + dot(u,v)</span><br><span class="line">    q = q / norm(q)</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vectorFromQuaternion</span>(<span class="params">u,q</span>):</span><br><span class="line">    v = u + <span class="number">2</span>*q[<span class="number">3</span>]*cross(q[<span class="number">0</span>:<span class="number">3</span>],u) + <span class="number">2</span>*(cross(q[<span class="number">0</span>:<span class="number">3</span>],cross(q[<span class="number">0</span>:<span class="number">3</span>],u)))</span><br><span class="line">    <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">angleBetweenVectors</span>(<span class="params">u,v</span>):</span><br><span class="line">    angle = acos(dot(u,v)/(norm(u)*norm(v)))</span><br><span class="line">    <span class="keyword">return</span> angle.real</span><br><span class="line"></span><br><span class="line"><span class="meta">@timeout(<span class="params">time</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    <span class="comment"># Load satellites</span></span><br><span class="line">    sat = load.tle_file(<span class="string">&#x27;sat.tle&#x27;</span>)</span><br><span class="line">    <span class="comment">#if sat: print(&quot;Loaded&quot;,len(sat),&quot;TLE&quot;)</span></span><br><span class="line">    <span class="comment">#else: print(&quot;No TLEs :(&quot;)</span></span><br><span class="line">    sat = sat[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    eph = load(<span class="string">&#x27;de440s.bsp&#x27;</span>)</span><br><span class="line">    sun, earth, mars = eph[<span class="string">&#x27;Sun&#x27;</span>], eph[<span class="string">&#x27;Earth&#x27;</span>], eph[<span class="string">&#x27;Mars Barycenter&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Set simulation epoch</span></span><br><span class="line">    <span class="comment"># May 21, 2022, 14:00 UTC</span></span><br><span class="line">    t = ts.utc(<span class="number">2022</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Challenge Question</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Provide the the quaternion (Qx, Qy, Qz, Qw) to point your spacecraft at the sun at&quot;</span>,t.utc_strftime())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The solar panels face the -X axis of the spacecraft body frame or [-1,0,0]&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Qx = &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    x = <span class="built_in">float</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Qy = &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    y = <span class="built_in">float</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Qz = &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    z = <span class="built_in">float</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Qw = &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    w = <span class="built_in">float</span>(<span class="built_in">input</span>())</span><br><span class="line"></span><br><span class="line">    ansQ = [x, y, z, w]</span><br><span class="line">    ansQ = ansQ / norm(ansQ)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Quaternion normalized to:&quot;</span>,ansQ)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check answer</span></span><br><span class="line">    bodyV = [-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>] <span class="comment"># -x axis is solar panels in sat body frame</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># TLE doesn&#x27;t matter b/c this sat is so close to Earth relative to Earth-Sun distance</span></span><br><span class="line">    <span class="comment"># If it was farther away, need to convert the satellite geocentric coordinates (earth origin) to barycentric (sun origin)</span></span><br><span class="line">    sunV = earth.at(t).observe(sun).position.km</span><br><span class="line">    sunV = sunV / norm(sunV)</span><br><span class="line">    <span class="comment">#print(sunV)</span></span><br><span class="line">    <span class="comment">#sunQ = quaternion(bodyV,sunV)</span></span><br><span class="line">    <span class="comment">#print(sunQ)</span></span><br><span class="line"></span><br><span class="line">    ansV = vectorFromQuaternion(bodyV,ansQ)</span><br><span class="line">    angle = angleBetweenVectors(sunV,ansV) * <span class="number">180</span>/pi</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The solar panels are facing %.3f degrees away from the sun&quot;</span> %angle)</span><br><span class="line">    <span class="comment"># If pointed at sun within 1 degree, accept the answer</span></span><br><span class="line">    <span class="keyword">if</span> angle &lt; <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    render_intro()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Challenge</span></span><br><span class="line">    success = challenge()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> success:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;You got it! Here&#x27;s your flag:&quot;</span>)</span><br><span class="line">        flag = os.getenv(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;That didn&#x27;t work, try again!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>给出了天体历de440s.bsp和卫星信息sat.tle</p>
<p>题目分析</p>
<p>数学工具函数</p>
<ul>
<li><p><code>quaternion(u,v)</code>：构造把单位向量 <code>u</code> 旋到单位向量 <code>v</code> 的最小转角四元数，返回 <code>[qx, qy, qz, qw]</code>（<strong>最后一位为标量部</strong>）。核心：<br>$$q_{\text{vec}} &#x3D; u \times v,\quad q_w &#x3D; 1 + u\cdot v,\quad q &#x3D; \frac{[q_{\text{vec}},, q_w]}{||[q_{\text{vec}},, q_w]||}$$</p>
</li>
<li><p><code>vectorFromQuaternion(u,q)</code>：用单位四元数 $q&#x3D;[\mathbf{q}, w]$ 旋转三维向量 <code>u</code>：<br>$$v &#x3D; u + 2w(\mathbf{q}\times u) + 2,\mathbf{q}\times(\mathbf{q}\times u)$$<br>这是把 $v’ &#x3D; q,v,q^*$ 展开到纯向量形式后的高效实现。</p>
</li>
<li><p><code>angleBetweenVectors(u,v)</code>：$\theta&#x3D;\arccos!\frac{u\cdot v}{||u||||v||}$，返回<strong>弧度</strong>（调用处再转度）。</p>
</li>
</ul>
<p><code>challenge()</code> 主流程</p>
<ol>
<li>读取 TLE 与天体历（TLE 在这里<strong>基本无用</strong>，因为地—日距离远，地球附近卫星位置对<strong>单位方向</strong>几乎不影响）。</li>
<li>固定时刻：<strong>2022-05-21 14:00:00 UTC</strong>。</li>
<li>提示输入四元数 <code>(Qx,Qy,Qz,Qw)</code>，并单位化。</li>
<li>设机体系 <strong>-X 轴</strong> 为太阳能板法向：<code>bodyV = [-1,0,0]</code>。</li>
<li>用 Skyfield 计算 <code>sunV = unit( earth.at(t).observe(sun).position.km )</code>，即<strong>地球观测太阳方向</strong>单位向量。</li>
<li>用用户四元数旋转 <code>bodyV</code> 得 <code>ansV</code>，与 <code>sunV</code> 求夹角；角度 &lt; 1° 即判定正确，打印 <code>FLAG</code>。</li>
</ol>
<blockquote>
<p>关键点：问题本质是<strong>求一个把机体 -X 轴对准太阳方向的旋转</strong>，以四元数形式提交。</p>
</blockquote>
<p>解题步骤</p>
<p>步骤 0：明确坐标与约定</p>
<ul>
<li><strong>机体坐标系</strong>：太阳能板朝向为 <strong>-X 轴</strong>，向量 $u &#x3D; [-1,0,0]$。</li>
<li><strong>惯性&#x2F;天球坐标</strong>：<code>earth.at(t).observe(sun)</code> 得到的 $\mathbf{s}$ 是 ICRF 中的<strong>地球→太阳</strong>向量。单位化 $v&#x3D;\frac{\mathbf{s}}{||\mathbf{s}||}$。</li>
<li><strong>四元数顺序</strong>：题目与代码均采用 $[Q_x, Q_y, Q_z, Q_w]$，<strong>标量在最后</strong>。</li>
</ul>
<p>步骤 1：计算目标方向</p>
<p>$v &#x3D; \text{unit}\big(\text{Earth}(t)\rightarrow\text{Sun}(t)\big)$</p>
<p>步骤 2：由两向量求最小转角四元数</p>
<p>设 $u&#x3D;[-1,0,0]$，$v$ 如上。</p>
<ul>
<li>旋转轴方向 $\propto u\times v$；</li>
<li>转角 $\theta&#x3D;\arccos(u\cdot v)$；</li>
<li>轴角到四元数：<br>$$q &#x3D; \big[\hat{n}\sin\frac{\theta}{2}, \cos\frac{\theta}{2}\big]<br>\quad\text{其中};\hat{n}&#x3D;\frac{u\times v}{||u\times v||}$$</li>
<li><strong>等价的快捷构造</strong>（避免先显式求 $\theta$）：<br>$$q_{\text{vec}}&#x3D;u\times v,\quad q_w&#x3D;1+u\cdot v,\quad<br>q&#x3D;\frac{[q_{\text{vec}},q_w]}{||[q_{\text{vec}},q_w]||}$$<br>该式与上式在非 180° 情况下等价，而且数值稳定、实现简单。</li>
</ul>
<p>得到 $q&#x3D;[Q_x,Q_y,Q_z,Q_w]$ 后，<strong>单位化</strong>并注意：$q$ 与 $-q$ 表示同一旋转，二者都正确。</p>
<p>步骤 3：自检（必做）</p>
<ul>
<li>用 <code>vectorFromQuaternion</code>（或等价 <code>q v q*</code>）旋转 $u$ 得 $u’$。</li>
<li>夹角：<br>$$\varepsilon &#x3D; \arccos\frac{u’\cdot v}{||u’||||v||}$$<br>应接近 0°；满足题目阈值 $\varepsilon&lt;1^\circ$ 即通过。</li>
</ul>
<blockquote>
<p>题面之所以说“TLE 不重要”，就在于我们只取<strong>单位方向</strong> (v)，地球附近几百&#x2F;几千公里的位置差对 1AU 量级几乎无贡献。</p>
</blockquote>
<p>相关公式与实现细节</p>
<ol>
<li>角度与点积</li>
</ol>
<p>$$\cos\theta &#x3D; \frac{u\cdot v}{||u||,||v||}<br>\quad\Rightarrow\quad<br>\theta&#x3D;\arccos(\cos\theta)$$<br>实现时应把 $\cos\theta$ <strong>钳制</strong>到 $[-1,1]$：<br><code>cosang = max(min(cosang, 1.0), -1.0)</code> 以避免浮点微超界导致 <code>acos</code> 返回 NaN。</p>
<ol start="2">
<li>轴角到四元数</li>
</ol>
<p>设旋转轴单位向量 $\hat{n}$、转角 $\theta$，则<br>$$q &#x3D;<br>\left[<br>\hat{n}\sin\frac{\theta}{2},<br>\cos\frac{\theta}{2}<br>\right]<br>&#x3D; [q_x, q_y, q_z, q_w]$$<br>本题以<strong>标量部在最后</strong>为约定。</p>
<ol start="3">
<li>“两向量最小旋转”快捷式的由来</li>
</ol>
<p>$$\begin{aligned}<br>&amp;\cos\theta &#x3D; u\cdot v,\quad<br>\sin\theta\hat{n} &#x3D; u\times v,\newline<br>&amp;\Rightarrow<br>\cos\frac{\theta}{2} &#x3D; \sqrt{\frac{1+\cos\theta}{2}}<br>&#x3D;\sqrt{\frac{1+u\cdot v}{2}},\newline<br>&amp;\sin\frac{\theta}{2}\hat{n}<br>&#x3D;\frac{u\times v}{||u\times v||}\sin\frac{\theta}{2}<br>&#x3D;\frac{u\times v}{\sqrt{2(1+u\cdot v)}},\newline<br>&amp;\Rightarrow q \propto \big[u\times v, 1+u\cdot v\big],<br>\end{aligned}$$<br>归一化即可。</p>
<ol start="4">
<li>用四元数旋转向量（无显式矩阵）</li>
</ol>
<p>把三维向量视作纯虚四元数 $p&#x3D;[\mathbf{u},0]$，单位四元数 $q&#x3D;[\mathbf{q},w]$：<br>$$p’ &#x3D; qpq^*<br>\Rightarrow<br>\mathbf{u}’ &#x3D;<br>\mathbf{u} + 2w(\mathbf{q}\times\mathbf{u}) + 2\mathbf{q}\times(\mathbf{q}\times\mathbf{u})$$<br>这是代码 <code>vectorFromQuaternion</code> 的来源，<strong>无需建 3×3 旋转矩阵</strong>。</p>
<ol start="5">
<li>退化与鲁棒性</li>
</ol>
<ul>
<li><strong>180° 情况</strong>：若 $u\cdot v\approx -1$，则 $q_w&#x3D;1+u\cdot v\approx 0$，且 $u\times v\approx 0$（两向量共线但反向），快捷式失效。<br>处理：任选一条与 $u$ 不共线的轴（如 $[0,1,0]$ 或 $[0,0,1]$），令 $\hat{n}&#x3D;\text{unit}(u\times \text{fallback})$，取 $q&#x3D;[\hat{n}\sin\pi&#x2F;2,\cos\pi&#x2F;2]&#x3D;[\hat{n},0]$。</li>
<li><strong>单位化</strong>：四元数与方向向量都要做单位化，避免累计误差。</li>
<li><strong>符号等价</strong>：$q$ 与 $-q$ 等价；若下游系统约定不同，需统一。</li>
</ul>
<ol start="6">
<li>坐标系与方向</li>
</ol>
<ul>
<li><code>earth.at(t).observe(sun)</code> 结果位于 ICRF（与 J2000 非常接近的惯性系），不需要为“近地卫星”额外将地心向量改为太阳系质心向量，因为<strong>只取单位方向</strong>。</li>
<li>航天器机体的“面向太阳”定义清晰：以<code>-X</code> 为板法向；若题面改为 “+X&#x2F;±Y&#x2F;±Z”，只需更新 $u$。</li>
</ul>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">计算把航天器机体 -X 轴旋转到太阳方向的四元数 [Qx, Qy, Qz, Qw]</span></span><br><span class="line"><span class="string">时刻：2022-05-21 14:00:00 UTC</span></span><br><span class="line"><span class="string">依赖：numpy, skyfield (pip install skyfield)</span></span><br><span class="line"><span class="string">输入：sat.tle（不严格必需，但保留加载演示）, de440s.bsp</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> array, cross, dot</span><br><span class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> norm</span><br><span class="line"><span class="keyword">from</span> cmath <span class="keyword">import</span> acos, pi</span><br><span class="line"><span class="keyword">from</span> skyfield.api <span class="keyword">import</span> load</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># === 如果 sat.tle / de440s.bsp 不与脚本同目录，请替换为你的真实路径 ===</span></span><br><span class="line">TLE_PATH = os.path.join(os.path.dirname(__file__), <span class="string">&quot;sat.tle&quot;</span>)</span><br><span class="line">BSP_PATH = os.path.join(os.path.dirname(__file__), <span class="string">&quot;de440s.bsp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unit</span>(<span class="params">v</span>):</span><br><span class="line">    v = np.array(v, dtype=<span class="built_in">float</span>)</span><br><span class="line">    <span class="keyword">return</span> v / norm(v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">quaternion_from_u_to_v</span>(<span class="params">u, v</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    计算将向量 u 旋转到向量 v 的四元数 [qx, qy, qz, qw]（qw 为标量部）。</span></span><br><span class="line"><span class="string">    假设不处于 180° 退化情形；若 dot(u,v) 接近 -1，建议添加备用轴处理。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    u = unit(u)</span><br><span class="line">    v = unit(v)</span><br><span class="line">    q_vec = cross(u, v)</span><br><span class="line">    q_w = <span class="number">1.0</span> + <span class="built_in">float</span>(dot(u, v))</span><br><span class="line">    q = np.array([q_vec[<span class="number">0</span>], q_vec[<span class="number">1</span>], q_vec[<span class="number">2</span>], q_w], dtype=<span class="built_in">float</span>)</span><br><span class="line">    q = q / norm(q)</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_vector_by_quaternion</span>(<span class="params">u, q</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用单位四元数 q=[qx,qy,qz,qw] 旋转向量 u，返回旋转后的向量。</span></span><br><span class="line"><span class="string">    v = u + 2*w*(q_vec × u) + 2*(q_vec × (q_vec × u))</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    u = np.array(u, dtype=<span class="built_in">float</span>)</span><br><span class="line">    q_vec = np.array(q[:<span class="number">3</span>], dtype=<span class="built_in">float</span>)</span><br><span class="line">    w = <span class="built_in">float</span>(q[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> u + <span class="number">2</span>*w*cross(q_vec, u) + <span class="number">2</span>*cross(q_vec, cross(q_vec, u))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">angle_between</span>(<span class="params">u, v</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;返回向量夹角（度）。&quot;&quot;&quot;</span></span><br><span class="line">    u = np.array(u, dtype=<span class="built_in">float</span>)</span><br><span class="line">    v = np.array(v, dtype=<span class="built_in">float</span>)</span><br><span class="line">    cu, cv = norm(u), norm(v)</span><br><span class="line">    <span class="keyword">if</span> cu == <span class="number">0</span> <span class="keyword">or</span> cv == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">float</span>(<span class="string">&#x27;nan&#x27;</span>)</span><br><span class="line">    cosang = <span class="built_in">float</span>(dot(u, v) / (cu * cv))</span><br><span class="line">    <span class="comment"># 钳制到 [-1, 1] 防止浮点越界</span></span><br><span class="line">    cosang = <span class="built_in">max</span>(<span class="built_in">min</span>(cosang, <span class="number">1.0</span>), -<span class="number">1.0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span>(acos(cosang).real * <span class="number">180.0</span> / pi)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 载入时标与星历</span></span><br><span class="line">    ts = load.timescale()</span><br><span class="line">    <span class="comment"># TLE 实际不参与地日方向计算，这里只示范可用性；失败也不影响后续</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = load.tle_file(TLE_PATH)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[WARN] 加载 TLE 失败（无妨）：<span class="subst">&#123;e&#125;</span>&quot;</span>, file=sys.stderr)</span><br><span class="line"></span><br><span class="line">    eph = load(BSP_PATH)</span><br><span class="line">    sun, earth = eph[<span class="string">&quot;Sun&quot;</span>], eph[<span class="string">&quot;Earth&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 指定挑战时刻：2022-05-21 14:00:00 UTC</span></span><br><span class="line">    t = ts.utc(<span class="number">2022</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 地球在 t 时刻观测太阳的方向（单位向量）</span></span><br><span class="line">    sun_vec = earth.at(t).observe(sun).position.km</span><br><span class="line">    sun_dir = unit(sun_vec)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 机体 -X 轴（太阳能板法向）</span></span><br><span class="line">    body_neg_x = np.array([-<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算四元数并单位化</span></span><br><span class="line">    q = quaternion_from_u_to_v(body_neg_x, sun_dir)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 验证：旋转机体 -X 后与太阳方向的偏差角</span></span><br><span class="line">    rotated = rotate_vector_by_quaternion(body_neg_x, q)</span><br><span class="line">    err_deg = angle_between(rotated, sun_dir)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== 结果 ===&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Qx, Qy, Qz, Qw =&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;&#123;:.16f&#125; &#123;:.16f&#125; &#123;:.16f&#125; &#123;:.16f&#125;&quot;</span>.<span class="built_in">format</span>(q[<span class="number">0</span>], q[<span class="number">1</span>], q[<span class="number">2</span>], q[<span class="number">3</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;验证偏差角（度）：&#123;:.6f&#125;&quot;</span>.<span class="built_in">format</span>(err_deg))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如需模仿挑战程序的“是否通过”逻辑：</span></span><br><span class="line">    <span class="keyword">if</span> err_deg &lt; <span class="number">1.0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;通过判定：夹角 &lt; 1° ✅&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未通过判定：夹角 &gt;= 1° ❌&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


<h2 id="matters-of-state"><a href="#matters-of-state" class="headerlink" title="matters_of_state"></a>matters_of_state</h2><p>Dockerfile里要把python-dev换为python3-dev</p>
<p>requirements.txt修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">orbitalpy==0.7.0</span><br><span class="line">numpy</span><br><span class="line">represent==1.6.0.post0</span><br></pre></td></tr></table></figure>

<p>先构建docker镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build challenge -t matters_of_state:challenge</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:12345,reuseaddr exec:&quot;docker run --rm -i -e SEED=1465500232115169100 -e FLAG=flag&#123;TESTflag1234&#125; matters_of_state\:challenge&quot;</span><br></pre></td></tr></table></figure>

<p>后面就能通过nc与12345端口交互</p>
<p>challenge.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> orbital</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> astropy </span><br><span class="line"><span class="keyword">from</span> timeout <span class="keyword">import</span> timeout,TimeoutError</span><br><span class="line"></span><br><span class="line">to = <span class="built_in">int</span>( os.getenv(<span class="string">&quot;TIMEOUT&quot;</span>,<span class="number">120</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_to_vec</span>(<span class="params"> str_in </span>):</span><br><span class="line">    vec =  np.fromstring( str_in , dtype=<span class="built_in">float</span>, count=-<span class="number">1</span> , sep=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>( vec.size != <span class="number">3</span> ):</span><br><span class="line">        <span class="keyword">raise</span> <span class="string">&quot;Vector doesnt have 3 elements&quot;</span></span><br><span class="line">    <span class="keyword">return</span> vec</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">single</span>( ):</span><br><span class="line">    pos_tolerance = <span class="number">10.0</span></span><br><span class="line">    vel_tolerance = <span class="number">0.1</span></span><br><span class="line">    correct = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Orbital Elements: &quot;</span>)</span><br><span class="line">    RE = <span class="number">6378.0</span></span><br><span class="line">    a = <span class="number">10.0</span> * RE</span><br><span class="line">    e =  <span class="number">0.3</span> </span><br><span class="line">    i = <span class="number">63.0</span> </span><br><span class="line">    RAAN =  <span class="number">25.0</span> </span><br><span class="line">    peri = <span class="number">78.0</span></span><br><span class="line">    mu = <span class="number">398600.5</span>  <span class="comment"># km^3 / s^2</span></span><br><span class="line">    n = np.sqrt( mu / np.power(a,<span class="number">3</span>))</span><br><span class="line">    M = <span class="number">10.0</span> <span class="comment">#random.random( ) * 360.0</span></span><br><span class="line">    times = [<span class="string">&#x27;2022-01-01T00:00:00&#x27;</span>]</span><br><span class="line">    t = astropy.time.Time(times, <span class="built_in">format</span>=<span class="string">&#x27;isot&#x27;</span>, scale=<span class="string">&#x27;utc&#x27;</span>)    </span><br><span class="line">    orbit = orbital.elements.KeplerianElements( a=a*<span class="number">1000.0</span>, e=e, i=np.deg2rad(i), raan=np.deg2rad(RAAN) , arg_pe=np.deg2rad(peri), M0=np.deg2rad(M), body=orbital.bodies.earth , ref_epoch=t )</span><br><span class="line">    orbit.propagate_anomaly_by(M=<span class="number">0.0</span>)</span><br><span class="line">    pos_truth = orbit.r/<span class="number">1000.0</span></span><br><span class="line">    vel_truth = orbit.v/<span class="number">1000.0</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Given the following orbit elements: &quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;semi-major axis: &#123;&#125; km&quot;</span>.<span class="built_in">format</span>(a))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;eccentricity: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;inclination: &#123;&#125; deg&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;RAAN: &#123;&#125; deg&quot;</span>.<span class="built_in">format</span>(RAAN))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Mean anomaly: &#123;&#125; deg&quot;</span>.<span class="built_in">format</span>(M))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Argument of periapsis: &#123;&#125; deg&quot;</span>.<span class="built_in">format</span>(peri))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Time: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( t[<span class="number">0</span>] ))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Find the state vector of the statellite&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Position: X,Y,Z &quot;</span> , flush=<span class="literal">True</span>)</span><br><span class="line">    pos_answer = <span class="built_in">input</span>( )</span><br><span class="line">    p = str_to_vec( pos_answer )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Velocity: Vx,Vy,Vz&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">    vel_answer = <span class="built_in">input</span>( ) </span><br><span class="line">    v = str_to_vec( vel_answer )</span><br><span class="line">    dP = np.linalg.norm( pos_truth - p )</span><br><span class="line">    dV = np.linalg.norm( vel_truth - v )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;dP: &#123;&#125; dV: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( dP ,dV ), flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span>( dP &gt; pos_tolerance ):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Position incorrect&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">        correct = <span class="literal">False</span> </span><br><span class="line">    <span class="keyword">if</span>( dV &gt; vel_tolerance ):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Velocity incorrect&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">        correct = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> correct</span><br><span class="line"></span><br><span class="line"><span class="meta">@timeout(<span class="params"> to </span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    N = <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>( N ):</span><br><span class="line">        ok = single( )</span><br><span class="line">        <span class="keyword">if</span>( <span class="literal">False</span> == ok ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Wrong&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;....Later&quot;</span> , flush=<span class="literal">True</span>)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Correct&quot;</span> , flush=<span class="literal">True</span>)</span><br><span class="line">    flag = os.getenv(<span class="string">&quot;FLAG&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( flag ) , flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        main()</span><br><span class="line">    <span class="keyword">except</span> TimeoutError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Timeout.....bye&quot;</span>)</span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>源码分析</p>
<p>给出<strong>开普勒轨道要素</strong>与<strong>时间</strong>，让选手在给定公差内返回三维<strong>位置&#x2F;速度</strong>向量（km 和 km&#x2F;s）。</p>
<p>关键点：</p>
<ul>
<li><p>轨道参数（固定示例）：</p>
<ul>
<li>地球半径 $R_E&#x3D;6378\text{ km}$，半长轴 $a&#x3D;10R_E$</li>
<li>偏心率 $e&#x3D;0.3$，倾角 $i&#x3D;63^\circ$</li>
<li>升交点赤经 $\Omega&#x3D;25^\circ$</li>
<li>近地点幅角 $\omega&#x3D;78^\circ$</li>
<li>平近点角 $M&#x3D;10^\circ$</li>
<li>历元 $t&#x3D;$ 2022-01-01T00:00:00 UTC</li>
</ul>
</li>
<li><p>利用 <code>orbital</code> + <code>astropy</code> 构造轨道，并得到“真值” $\mathbf r,\mathbf v$（以 m、m&#x2F;s 返回，随后换算成 km、km&#x2F;s）。</p>
</li>
<li><p>用户需输入：</p>
<ul>
<li>位置 <code>X,Y,Z</code>（km）</li>
<li>速度 <code>Vx,Vy,Vz</code>（km&#x2F;s）</li>
</ul>
</li>
<li><p>评分：</p>
<ul>
<li>位置误差范数 $||\Delta \mathbf r||\le 10 \text{ km}$</li>
<li>速度误差范数 $||\Delta \mathbf v||\le 0.1 \text{ km&#x2F;s}$</li>
<li>若有一项超标，本轮失败并立刻结束；连续答对 N&#x3D;5 轮后打印环境变量 <code>FLAG</code>。</li>
</ul>
</li>
</ul>
<blockquote>
<p>换言之，参赛者只要能把给定六根数按地球二体轨道模型，转换为 ECI 坐标系下的 $\mathbf r,\mathbf v$，并满足阈值，就能通关。</p>
</blockquote>
<p>solver.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"><span class="keyword">import</span> sgp4.api <span class="keyword">as</span> sp4</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> helper</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_value</span>(<span class="params"> text , preamble </span>):</span><br><span class="line">    lines = text.split(<span class="string">&quot;\n&quot;</span>) </span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span>( preamble <span class="keyword">in</span> line ):</span><br><span class="line">            out = line </span><br><span class="line">    value = re.findall(<span class="string">&quot;\d+\.\d+&quot;</span>, out)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span>(value[<span class="number">0</span>] )</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_date</span>(<span class="params"> text ,preamble</span>):</span><br><span class="line">    lines = text.split(<span class="string">&quot;\n&quot;</span>) </span><br><span class="line">    out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span>( preamble <span class="keyword">in</span> line ):</span><br><span class="line">            out = line.replace(preamble,<span class="string">&quot;&quot;</span>) </span><br><span class="line">            out = out.replace(<span class="string">&quot;UTC&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">            out = out.strip()</span><br><span class="line">            out=out+<span class="string">&quot;+0000&quot;</span></span><br><span class="line">    date = datetime.datetime.strptime( out  , <span class="string">&#x27;%Y-%m-%d %H:%M:%S%z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> date</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mean_to_eccentic</span>(<span class="params"> M , e , tol=<span class="number">1e-5</span> </span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( M &gt; np.pi ):</span><br><span class="line">        M0 = np.pi*<span class="number">2</span> - M </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        M0 = M </span><br><span class="line">    E_guess = np.arange( <span class="number">0</span> , np.pi , tol )</span><br><span class="line">    M_Guess =  E_guess - e*np.sin(E_guess )</span><br><span class="line"></span><br><span class="line">    dM =<span class="built_in">abs</span>( M0 - M_Guess ) </span><br><span class="line">    ind = np.argmin( dM , axis=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span>( M &gt; np.pi ):</span><br><span class="line">        E = <span class="number">2</span>*np.pi - E_guess[ind]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        E = E_guess[ind]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Eccentric anomaly is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( E))</span><br><span class="line">    <span class="keyword">return</span> E</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_single</span>(<span class="params"> sock </span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Trying to solve&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    challenge = sock.read_until([<span class="string">&quot;Find&quot;</span> ,<span class="string">&quot;Flag&quot;</span>,<span class="string">&quot;Wrong&quot;</span>])</span><br><span class="line">    <span class="built_in">print</span>(challenge , flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span>( <span class="string">&quot;Wrong&quot;</span> <span class="keyword">in</span> challenge):</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span>( <span class="string">&quot;Flag&quot;</span> <span class="keyword">in</span> challenge):</span><br><span class="line">        <span class="built_in">print</span>(sock.get_remaining() , flush=<span class="literal">True</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    a = get_value( challenge , <span class="string">&quot;semi-major&quot;</span>)</span><br><span class="line">    e = get_value( challenge , <span class="string">&quot;eccentricity&quot;</span>)</span><br><span class="line">    i = get_value( challenge , <span class="string">&quot;inc&quot;</span>)</span><br><span class="line">    RAAN = get_value( challenge , <span class="string">&quot;RAAN&quot;</span>)</span><br><span class="line">    peri  = get_value(challenge, <span class="string">&quot;Argument&quot;</span>)</span><br><span class="line">    M = get_value(challenge, <span class="string">&quot;Mean&quot;</span>)</span><br><span class="line">    mu = <span class="number">398600.4418</span>  <span class="comment"># km^3 / s^2</span></span><br><span class="line">    <span class="comment">#d  = get_date( challenge , &quot;Time:&quot;)</span></span><br><span class="line">    inc = np.deg2rad( i )</span><br><span class="line">    E = mean_to_eccentic( np.deg2rad(M),  e )</span><br><span class="line">    TA = np.arccos( (np.cos(E)-e)/(<span class="number">1</span>- e*np.cos(E)))</span><br><span class="line">    <span class="built_in">print</span>( <span class="string">&quot;True Anomaly is:  &#123;&#125;&quot;</span>.<span class="built_in">format</span>( TA ))</span><br><span class="line">    R = np.deg2rad( RAAN )</span><br><span class="line">    W = np.deg2rad( peri ) + TA </span><br><span class="line">    </span><br><span class="line">    r = a*(<span class="number">1</span>- e*np.cos(E))</span><br><span class="line">    v = np.sqrt( mu * ( (<span class="number">2</span>/r) - (<span class="number">1</span>/a) ) )</span><br><span class="line">    fpa = np.arctan( e*np.sin(TA ) / (<span class="number">1</span>+ e*np.cos(TA)))</span><br><span class="line">    <span class="keyword">if</span>( TA &gt; np.pi ):</span><br><span class="line">        fpa = -fpa</span><br><span class="line">    D1 = np.array( [np.cos(-W), np.sin(-W), <span class="number">0</span> , -np.sin(-W), np.cos(-W) , <span class="number">0</span> ,<span class="number">0</span> ,<span class="number">0</span> , <span class="number">1</span>]) <span class="comment"># true anomaly rotation and argp</span></span><br><span class="line">    D2 = np.array( [<span class="number">1</span> , <span class="number">0</span>, <span class="number">0</span> , <span class="number">0</span>, np.cos(-inc) , np.sin(-inc) , <span class="number">0</span>, -np.sin(-inc), np.cos(-inc)] ) <span class="comment"># incl rotation</span></span><br><span class="line">    D3 = np.array( [np.cos(-R), np.sin(-R), <span class="number">0</span> , -np.sin(-R), np.cos(-R) , <span class="number">0</span> ,<span class="number">0</span> ,<span class="number">0</span> , <span class="number">1</span>]) <span class="comment"># RAAN rotation</span></span><br><span class="line"></span><br><span class="line">    D1 = D1.reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">    D2 = D2.reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line">    D3 = D3.reshape(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    rot = np.matmul( D3, np.matmul( D2, D1 ))</span><br><span class="line">    rot2 = rot.transpose() </span><br><span class="line">    <span class="built_in">print</span>( <span class="string">&quot;FPA is &#123;&#125;&quot;</span>.<span class="built_in">format</span>( fpa))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Velocity is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( v))</span><br><span class="line">    v_r = v * np.sin( fpa )</span><br><span class="line">    v_w = v * np.cos( fpa )</span><br><span class="line">    R_VEC = np.array([r , <span class="number">0</span> , <span class="number">0</span> ])</span><br><span class="line">    V_VEC = np.array([v_r , v_w , <span class="number">0</span> ])</span><br><span class="line">    R_VEC = R_VEC.reshape(<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">    V_VEC = V_VEC.reshape(<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>( V_VEC )</span><br><span class="line"></span><br><span class="line">    position = np.matmul( rot , R_VEC ).reshape(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">    velocity = np.matmul( rot,V_VEC).reshape(<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line">    position = position[<span class="number">0</span>]</span><br><span class="line">    velocity = velocity[<span class="number">0</span>]</span><br><span class="line">    pos = <span class="string">&quot;&#123;&#125;,&#123;&#125;,&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>( position[<span class="number">0</span>], position[<span class="number">1</span>], position[<span class="number">2</span>])</span><br><span class="line">    vel = <span class="string">&quot;&#123;&#125;,&#123;&#125;,&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>( velocity[<span class="number">0</span>], velocity[<span class="number">1</span>], velocity[<span class="number">2</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I think the position is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( pos), flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I think the velocity is: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( vel ), flush=<span class="literal">True</span>)</span><br><span class="line">  </span><br><span class="line">    sock.send( pos )</span><br><span class="line">    sock.send( vel)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">batch_solve</span>(<span class="params">host, port </span>):</span><br><span class="line">    s = helper.TcpReader( host,  port )</span><br><span class="line">    ticket = os.getenv(<span class="string">&quot;CHAL_TICKET&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>( ticket  != <span class="literal">None</span> ):</span><br><span class="line">        s.read_until(<span class="string">&quot;Ticket please:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sending ticket - &#123;&#125;&quot;</span>.<span class="built_in">format</span>( ticket ), flush=<span class="literal">True</span>)</span><br><span class="line">        s.send( ticket)</span><br><span class="line">        s.send( <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        ticket_sent = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    keep_going = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span>( keep_going ):</span><br><span class="line">        solve_single(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    host = <span class="string">&#x27;10.249.10.107&#x27;</span></span><br><span class="line">    port = <span class="number">12345</span></span><br><span class="line">    batch_solve( host , port ) </span><br></pre></td></tr></table></figure>

<p>解题脚本流程：</p>
<ol>
<li><p>从环境变量获取连接参数：<code>CHAL_HOST</code>、<code>CHAL_PORT</code>。若有工单&#x2F;凭证 <code>CHAL_TICKET</code>，先按服务端提示发送。</p>
</li>
<li><p>轮询读取服务端的挑战文本，判断三种情形：</p>
<ul>
<li>含 <code>Wrong</code>：退出（上一轮答错）</li>
<li>含 <code>Flag</code>：读取并打印剩余内容，退出（通关）</li>
<li>含 <code>Find</code>：这是题面，进入求解。</li>
</ul>
</li>
<li><p>解析题面中的数值：<code>semi-major</code>、<code>eccentricity</code>、<code>inc</code>（倾角）、<code>RAAN</code>、<code>Argument</code>（近地点幅角）、<code>Mean</code>（平近点角）。</p>
</li>
<li><p>以标准地球引力常数 $\mu&#x3D;398600.4418,\text{km}^3&#x2F;\text{s}^2$ 进行<strong>二体问题</strong>求解：</p>
<ul>
<li>$M\to E$（平近点角到偏近点角）</li>
<li>$E\to \nu$（偏近点角到真近点角）</li>
<li>$a,e,\nu\to r,v$（轨道半径与速度模长）</li>
<li>计算<strong>飞行路径角</strong> $\gamma$（Flight Path Angle, FPA），把 (v) 分解为径向与切向分量 $v_r,v_t$</li>
<li>用旋转矩阵把**轨道平面坐标系（PQW&#x2F;Perifocal）**矢量转到 <strong>ECI</strong></li>
</ul>
</li>
<li><p>把得到的 <code>position</code>、<code>velocity</code> 以 “逗号分隔+换行” 的格式回发。</p>
</li>
</ol>
<p>数学推导与公式说明</p>
<p>轨道六根数回顾</p>
<p>给定地球二体模型下的六根数：<br>$$(a, e, i, \Omega, \omega, M)$$<br>其中 $a$ 半长轴、$e$ 偏心率、$i$ 倾角、$\Omega$ 升交点赤经、$\omega$ 近地点幅角、$M$ 平近点角。假设历元即题面时间（脚本中未做历元传播）。</p>
<p>Kepler 方程：求偏近点角 $E$</p>
<p>Kepler 方程（椭圆轨道）：<br>$$M &#x3D; E - e\sin E \quad (0\le E &lt; 2\pi)$$<br>解题脚本函数 <code>mean_to_eccentic(M,e,tol)</code> 用网格枚举在 $[0,\pi]$ 以 <code>tol</code> 为步长近似求解，并对 $M&gt;\pi$ 做对称处理。虽然不如牛顿法精确高效，但在该题误差阈值下通常足够。</p>
<p>偏近点角 $E$ 到真近点角 $\nu$</p>
<p>脚本采用：<br>$$\nu&#x3D;\arccos\left(\frac{\cos E - e}{1-e\cos E}\right)$$<br>然后根据 $M$ 的半周期对称性处理符号&#x2F;象限问题（通过后续对飞行路径角的符号进行修正）。更稳健的办法是用半角公式配合 <code>atan2</code>：<br>$$\tan\frac{\nu}{2}&#x3D;\sqrt{\frac{1+e}{1-e}}\tan\frac{E}{2},\quad<br>\nu&#x3D;2\ \mathrm{atan2}\left(\sqrt{1+e}\sin\frac{E}{2},\ \sqrt{1-e}\cos\frac{E}{2}\right)$$<br><code>atan2</code> 能自动处理象限。</p>
<p>轨道半径 $r$ 与速度模长 $v$</p>
<ul>
<li>轨道半径（椭圆几何关系）：<br>$$r &#x3D; a(1-e\cos E)$$<br>也可写成<br>$$r&#x3D;\frac{p}{1+e\cos\nu},\quad p&#x3D;a(1-e^2)$$</li>
<li>由 <strong>Vis-Viva 方程</strong> 得速度模长：<br>$$v&#x3D;\sqrt{\mu\left(\frac{2}{r}-\frac{1}{a}\right)}$$</li>
</ul>
<p>飞行路径角 $\gamma$ 与速度分解</p>
<p>脚本用：<br>$$\gamma&#x3D;\arctan\left(\frac{e\sin\nu}{1+e\cos\nu}\right)$$<br>若 $\nu&gt;\pi$ 则取负号（相当于在远地点后半周速度方向的径向分量变号）。这与经典关系一致：<br>$$v_r &#x3D; v\sin\gamma,\qquad v_t &#x3D; v\cos\gamma$$<br>用更“教科书”的表达是（直接用 $p&#x3D;a(1-e^2)$）：<br>$$v_r&#x3D;\sqrt{\frac{\mu}{p}}e\sin\nu,\qquad<br>v_t&#x3D;\sqrt{\frac{\mu}{p}}(1+e\cos\nu)$$<br>两种写法等价；脚本选择先求 $v$ 再按 $\gamma$ 分解。</p>
<p>坐标系与旋转（PQW → ECI）</p>
<ul>
<li><strong>PQW&#x2F;Perifocal</strong>（轨道平面）坐标系：<br>$ \hat{\mathbf p} $ 指向近地点、$ \hat{\mathbf q} $ 为轨道切向、$ \hat{\mathbf w}&#x3D;\hat{\mathbf p}\times\hat{\mathbf q} $ 指出轨道面法向。</li>
<li><strong>ECI</strong>：惯性坐标系（地球赤道春分点为参考）。</li>
</ul>
<p>标准从 PQW 到 ECI 的方向余弦矩阵（DCM）是：<br>$$\mathbf C_{PQW\to ECI} &#x3D; R_3(-\Omega),R_1(-i),R_3(-\omega),$$<br>其中<br>$$R_3(\theta)&#x3D;<br>\begin{bmatrix}<br>\cos\theta&amp;\sin\theta&amp;0\newline<br>-\sin\theta&amp;\cos\theta&amp;0\newline<br>0&amp;0&amp;1<br>\end{bmatrix},\quad<br>R_1(\phi)&#x3D;<br>\begin{bmatrix}<br>1&amp;0&amp;0\newline<br>0&amp;\cos\phi&amp;\sin\phi\newline<br>0&amp;-\sin\phi&amp;\cos\phi<br>\end{bmatrix}$$</p>
<p>脚本做了一个<strong>等效</strong>变换：先把真近点角 $\nu$ 并入到第一步旋转<br>$$W &#x3D; \omega + \nu$$<br>然后使用<br>$$\mathbf{rot} &#x3D; R_3(-\Omega),R_1(-i),R_3(-W)$$<br>再令<br>$$\mathbf r_{PQW} &#x3D; \begin{bmatrix} r \newline 0 \newline 0\end{bmatrix},\quad<br>\mathbf v_{PQW} &#x3D; \begin{bmatrix} v_r \newline v_t \newline 0\end{bmatrix}$$<br>最后<br>$$\mathbf r_{ECI}&#x3D;\mathbf{rot},\mathbf r_{PQW},\qquad<br>\mathbf v_{ECI}&#x3D;\mathbf{rot},\mathbf v_{PQW}$$<br>这是完全正确的：将 $\nu$ 并到最后一个 $R_3$ 里等价于先在 PQW 里绕 $\hat{\mathbf w}$ 旋转 $\nu$ 后再做三旋。脚本中 <code>D1,D2,D3</code> 正是这三步的矩阵展开。</p>
<blockquote>
<p>小结：<strong>位置</strong>在 PQW 中位于 $x$ 轴（近地点方向），<strong>速度</strong>在 PQW 中由 $(v_r,v_t,0)$ 表示，随后一次旋转到 ECI。</p>
</blockquote>
<p>脚本实现细节与注意事项</p>
<p>文本解析（<code>get_value</code>，<code>get_date</code>）</p>
<ul>
<li><p><code>get_value(text, preamble)</code>：逐行寻找包含关键前缀的行，用正则 <code>\d+\.\d+</code> 抓取<strong>第一个小数</strong>并转为 <code>float</code>。</p>
<ul>
<li>局限：不支持<strong>整数</strong>（如 <code>10</code> 没有小数点）、负数、科学计数法；若行里有多个数字，它只取第一个。</li>
<li>但题面格式固定、均为小数形式，因此能用。</li>
</ul>
</li>
<li><p><code>get_date</code> 未使用（被注释掉），题面给的时间只作为展示，脚本假定当前历元即题面时间，因此不做传播。</p>
</li>
</ul>
<p>Kepler 方程求解（<code>mean_to_eccentic</code>）</p>
<ul>
<li>采用<strong>网格搜索</strong>（步长 <code>tol</code>），并用对称性把 $[0,2\pi)$ 的问题折半到 $[0,\pi]$。</li>
<li>精度由 <code>tol</code> 控制；容差适当即可满足误差阈值。</li>
</ul>
<p>姿态旋转矩阵构造</p>
<ul>
<li>构造 <code>D1=R3(-W)</code>、<code>D2=R1(-i)</code>、<code>D3=R3(-Ω)</code>，并按 <code>rot = D3 @ (D2 @ D1)</code> 相乘（从右到左依次作用）。</li>
<li>然后 <code>r=rot @ [r,0,0]^T</code>，<code>v=rot @ [v_r,v_t,0]^T</code>，得到 ECI 坐标。</li>
</ul>
<p>解题思路</p>
<ul>
<li><strong>读题面 → 解析六根数</strong></li>
<li><strong>求 $E$</strong>：解 $M&#x3D;E-e\sin E$</li>
<li><strong>求 $\nu$</strong>：由 $E$ 得到真近点角</li>
<li><strong>求 $r,v$</strong>：$r&#x3D;a(1-e\cos E)$，$v&#x3D;\sqrt{\mu(2&#x2F;r-1&#x2F;a)}$</li>
<li><strong>分解速度</strong>：$(v_r,v_t)&#x3D;(v\sin\gamma,,v\cos\gamma)$ 或直接用 $\sqrt{\mu&#x2F;p}$ 公式</li>
<li><strong>坐标变换</strong>：$\mathbf r&#x3D;\mathbf{rot}[r,0,0]^T$，$\mathbf v&#x3D;\mathbf{rot}[v_r,v_t,0]^T$，其中<br>$\mathbf{rot}&#x3D;R_3(-\Omega)R_1(-i)R_3(-(\omega+\nu))$</li>
<li><strong>按协议回填</strong>：格式 <code>x,y,z\n</code> 与 <code>vx,vy,vz\n</code></li>
<li><strong>循环处理直至拿到 Flag</strong></li>
</ul>
<h2 id="power-level"><a href="#power-level" class="headerlink" title="power_level"></a>power_level</h2><p>先构建docker镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build challenge -t power_level:challenge</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v tcp-listen:10000,reuseaddr exec:&quot;docker run --rm -i -e SEED=1465500232115169100 -e FLAG=flag&#123;TESTflag1234&#125; -p 25000\:10001 power_level\:challenge&quot;</span><br></pre></td></tr></table></figure>

<p>后面就能通过nc与10000和25000端口交互</p>
<p>challenge.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sqlite3 <span class="keyword">import</span> Time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random </span><br><span class="line"><span class="keyword">import</span> siggen </span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> easteregg</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> timeout <span class="keyword">import</span> timeout,TimeoutError</span><br><span class="line"></span><br><span class="line">to = <span class="built_in">int</span>( os.getenv(<span class="string">&quot;TIMEOUT&quot;</span>,<span class="number">120</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_siggen</span>(<span class="params"> gen , port </span>) :</span><br><span class="line">    gen.send(port) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@timeout(<span class="params">to</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>(<span class="params"> args </span>):</span><br><span class="line">    <span class="comment"># Constants</span></span><br><span class="line">    Fs = <span class="number">100000.0</span></span><br><span class="line">    <span class="comment"># allow a few random amplitudes</span></span><br><span class="line">    amp_choices = [<span class="number">200</span>, <span class="number">400</span>, <span class="number">800</span>] <span class="comment"># increment by 2x amplitude ( 4x power since power is A^2)</span></span><br><span class="line">    <span class="comment"># Only one frquency </span></span><br><span class="line">    freq_choices = [   Fs/<span class="number">32</span>  ]</span><br><span class="line">    freq_tolerance = <span class="number">100</span> <span class="comment"># Hz</span></span><br><span class="line">    snr_tolerance = <span class="number">0.5</span> <span class="comment"># dB</span></span><br><span class="line">    N = <span class="built_in">int</span>(Fs)</span><br><span class="line">    <span class="comment"># Noise variance  / Noise pwower</span></span><br><span class="line">    noise_variance = <span class="number">100.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Make choices at random</span></span><br><span class="line">    amp = random.choice( amp_choices )</span><br><span class="line">    freq = random.choice( freq_choices )</span><br><span class="line">    <span class="comment"># This is both the textbook and wikipedia definition of snr.</span></span><br><span class="line">    <span class="comment"># SNR = Psig / Pnoise</span></span><br><span class="line">    <span class="comment"># Psig = A^2</span></span><br><span class="line">    <span class="comment"># Pnoise = var( noise )</span></span><br><span class="line">    snr = <span class="number">10</span> * np.log10( amp*amp /  noise_variance   )</span><br><span class="line">    sample_host = os.getenv( <span class="string">&quot;SERVICE_HOST&quot;</span>, )</span><br><span class="line">    sample_port = <span class="built_in">int</span>( os.getenv(<span class="string">&quot;SERVICE_PORT&quot;</span>, <span class="number">1000</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Connect via TCP to get the samples at &#123;&#125;:&#123;&#125;&quot;</span>.<span class="built_in">format</span>( sample_host,sample_port) , flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;The sample rate is &#123;&#125;&quot;</span>.<span class="built_in">format</span>( Fs ), flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># Create some samples on a new thread</span></span><br><span class="line">    gen = siggen.tcp_siggen( samp_rate=Fs , freq=freq , amp=amp,  noise_var=noise_variance , N=N)</span><br><span class="line">    t = threading.Thread( target=run_siggen , args=(gen,args.port) , daemon=<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br><span class="line">    <span class="comment"># Ask the player what they think the answer is</span></span><br><span class="line">    <span class="comment"># If they answer with the correct dragonball quote then print the easter egg!</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;What is the frequency of the signal? (Hz)&quot;</span>)</span><br><span class="line">    freq_str = <span class="built_in">input</span>() </span><br><span class="line">    easteregg.check_easteregg( freq_str )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;What is the signal to noise ratio (dB)&quot;</span>)</span><br><span class="line">    snr_str = <span class="built_in">input</span>()</span><br><span class="line">    easteregg.check_easteregg( snr_str )</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;You answered freq: &#123;&#125; snr: &#123;&#125;&quot;</span>.<span class="built_in">format</span>( freq_str,snr_str))</span><br><span class="line">    <span class="comment"># Make sure the answers are floats</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        snr_answer = <span class="built_in">float</span>( snr_str )</span><br><span class="line">        freq_answer = <span class="built_in">float</span>( freq_str )</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;input malformed - type in numbers like 123.456789&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Check if the answers are within the tolerance</span></span><br><span class="line">    snr_correct = np.<span class="built_in">abs</span>( snr - snr_answer ) &lt; snr_tolerance </span><br><span class="line">    freq_correct = np.<span class="built_in">abs</span>( freq - freq_answer ) &lt; freq_tolerance</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( snr_correct <span class="keyword">and</span> freq_correct ):</span><br><span class="line">        flag = os.getenv(<span class="string">&quot;FLAG&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Here is your flag:&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Wrong answer results in Napa&#x27;s quote!</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;What!!! there is no way that can be right!&quot;</span>)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Exiting&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--sample-port&quot;</span>, dest=<span class="string">&quot;port&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, required=<span class="literal">True</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    service_host = os.getenv(<span class="string">&quot;SERVICE_HOST&quot;</span> , <span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">    service_port = os.getenv(<span class="string">&quot;SERVICE_PORT&quot;</span> , args.port)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Samples available at: &#123;&#125; &#123;&#125; &quot;</span>.<span class="built_in">format</span>( service_host, service_port))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        challenge(args)</span><br><span class="line">    <span class="keyword">except</span> TimeoutError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Timeout ....bye&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">work</span>(<span class="params"> sock , Fs , N </span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Trying to get &#123;&#125; samples at &#123;&#125;&quot;</span>.<span class="built_in">format</span>(N,Fs))</span><br><span class="line">    count = <span class="number">0</span> </span><br><span class="line">    bytes_total = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="comment"># Get the sample bytes </span></span><br><span class="line">    <span class="keyword">while</span>( count &lt; N*<span class="number">8</span> ):</span><br><span class="line">        bytes_in =  sock.recv( N*<span class="number">8</span> )<span class="comment"># receive N complex64 bit numbers</span></span><br><span class="line">        bytes_total = bytes_total + bytes_in</span><br><span class="line">        count = count + <span class="built_in">len</span>( bytes_in)</span><br><span class="line">    <span class="comment"># Make them into a complex 64</span></span><br><span class="line">    samples = np.frombuffer( bytes_total , dtype=np.dtype(<span class="string">&#x27;complex64&#x27;</span>))    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Got &#123;&#125; samples&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(samples)))</span><br><span class="line">    <span class="comment"># Take a FFT of the samples</span></span><br><span class="line">    spectrum = np.fft.fft( samples  , norm=<span class="string">&quot;forward&quot;</span>)</span><br><span class="line">    freqs = np.fft.fftfreq(samples.shape[-<span class="number">1</span>]) * Fs</span><br><span class="line">    power = np.real(spectrum * np.conj( spectrum ) ) </span><br><span class="line">    max_ind = np.argmax( power )</span><br><span class="line">    <span class="comment"># Make a copy of the spectrum but zero out the values around the signal - this leaves only noise</span></span><br><span class="line">    noise_band = spectrum </span><br><span class="line">    noise_band[max_ind] = <span class="number">0</span> <span class="comment"># remove the tone from the signal to get the noise only (only works for a pure carrier like this problem)</span></span><br><span class="line">    noise_band[max_ind-<span class="number">1</span>] = <span class="number">0</span> </span><br><span class="line">    noise_band[max_ind+<span class="number">1</span>] = <span class="number">0</span> </span><br><span class="line">    <span class="comment"># Take an iift of the noise only signal so that we get things in time domain </span></span><br><span class="line">    noise_only = np.fft.ifft( noise_band , norm=<span class="string">&#x27;forward&#x27;</span> ) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get the frequency of the sinusioid and its power</span></span><br><span class="line">    freq = freqs[ max_ind ]</span><br><span class="line">    max_power = np.real(power[max_ind])</span><br><span class="line">    <span class="comment"># Take the variance of the noise only signal to get its power</span></span><br><span class="line">    noise_power = np.var( noise_only )  <span class="comment"># Textbook definition of noise power is the variance of the noise</span></span><br><span class="line">    <span class="comment"># Put things in DB which is nice!</span></span><br><span class="line">    sig_power_db = <span class="number">10</span>*np.log10( max_power) </span><br><span class="line">    noise_power_db = <span class="number">10</span>*np.log10( noise_power  ) </span><br><span class="line">    snr = sig_power_db - noise_power_db</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I think the answers are&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Frequency (HZ): &#123;&#125;&quot;</span>.<span class="built_in">format</span>(freq))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Signal Power: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(sig_power_db))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Noise Power: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(noise_power_db))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SNR (dB): &#123;&#125;&quot;</span>.<span class="built_in">format</span>(snr))</span><br><span class="line">    <span class="keyword">return</span> (freq,snr)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_samp_rate</span>(<span class="params"> text </span>):</span><br><span class="line">    preamble = <span class="string">&quot;The sample rate is&quot;</span></span><br><span class="line">    lines = text.split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span>( preamble <span class="keyword">in</span> line ):</span><br><span class="line">            fs_str = line.replace(preamble,<span class="string">&quot;&quot;</span>)</span><br><span class="line">            fs_str = fs_str.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">            fs_str = fs_str.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">float</span>( fs_str )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params"> host , port , sample_port </span>): </span><br><span class="line">    <span class="comment"># Get the challenge prompt</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Solver listening for challenge prompt on: &#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>( host,port))</span><br><span class="line">    prompts = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    prompts.connect((host, port))</span><br><span class="line">    ticket = os.getenv(<span class="string">&quot;CHAL_TICKET&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>( ticket  != <span class="literal">None</span> ):</span><br><span class="line">        prompts.recv(<span class="number">1000</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sending ticket - &#123;&#125;&quot;</span>.<span class="built_in">format</span>( ticket ), flush=<span class="literal">True</span>)</span><br><span class="line">        prompts.send( ticket.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        prompts.send( <span class="string">&quot;\n&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        ticket_sent = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    out = prompts.recv(<span class="number">1000</span>)</span><br><span class="line">    text = out.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(text, flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># Create a socket to listen for the samples</span></span><br><span class="line">    sample_host = <span class="string">&#x27;10.249.10.107&#x27;</span></span><br><span class="line">    sample_port = <span class="number">25000</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Solver listening for smaples on: &#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>( sample_host, sample_port))</span><br><span class="line">    samps = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    samps.connect((sample_host, sample_port))</span><br><span class="line">    <span class="comment"># Deduce the sample rate from the challenge</span></span><br><span class="line">    Fs = get_samp_rate( text )</span><br><span class="line">    <span class="comment"># Figure out what the frequency and snr is </span></span><br><span class="line">    answers = work( samps, Fs, <span class="built_in">int</span>(Fs) )</span><br><span class="line">    <span class="comment"># Send the answers as text</span></span><br><span class="line">    prompts.send( <span class="string">&quot;&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(answers[<span class="number">0</span>]).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    prompts.send( <span class="string">&quot;&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(answers[<span class="number">1</span>]).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    out = prompts.recv(<span class="number">1000</span>)</span><br><span class="line">    <span class="built_in">print</span>(out.decode(<span class="string">&#x27;utf-8&#x27;</span>), flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Solver exiting&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    host = <span class="string">&#x27;10.249.10.107&#x27;</span></span><br><span class="line">    port = <span class="number">10000</span></span><br><span class="line">    sample_port = <span class="number">25000</span></span><br><span class="line">    solve( host , port , sample_port )</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io">cheng_xing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io/2025/09/30/hackasat-2022-quals/">https://sakuraraindrop.github.io/2025/09/30/hackasat-2022-quals/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://sakuraraindrop.github.io" target="_blank">cheng_xing's blog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/ltx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related  no-desc" href="/2025/09/27/20250927%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20250927随缘刷题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">20250927随缘刷题</div></div></div></a><a class="pagination-related  no-desc" href="/2025/10/02/20251002%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/" title="20251002论文精读"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">20251002论文精读</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">cheng_xing</div><div class="author-info-description">web菜鸡修炼中</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">147</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/sakuraraindrop"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/sakuraraindrop" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://space.bilibili.com/504596197" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#black-hole"><span class="toc-number">1.</span> <span class="toc-text">black-hole</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sunfun"><span class="toc-number">2.</span> <span class="toc-text">sunfun</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#matters-of-state"><span class="toc-number">3.</span> <span class="toc-text">matters_of_state</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#power-level"><span class="toc-number">4.</span> <span class="toc-text">power_level</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/17/reverse-learning/" title="reverse-learning">reverse-learning</a><time datetime="2025-10-17T04:52:59.000Z" title="发表于 2025-10-17 12:52:59">2025-10-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/09/hackasat-2020-quals/" title="hackasat-2020-quals">hackasat-2020-quals</a><time datetime="2025-10-09T06:51:05.000Z" title="发表于 2025-10-09 14:51:05">2025-10-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/02/20251002%E8%AE%BA%E6%96%87%E7%B2%BE%E8%AF%BB/" title="20251002论文精读">20251002论文精读</a><time datetime="2025-10-02T09:04:55.000Z" title="发表于 2025-10-02 17:04:55">2025-10-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/30/hackasat-2022-quals/" title="hackasat-2022-quals">hackasat-2022-quals</a><time datetime="2025-09-30T12:06:48.000Z" title="发表于 2025-09-30 20:06:48">2025-09-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/27/20250927%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20250927随缘刷题">20250927随缘刷题</a><time datetime="2025-09-27T04:45:15.000Z" title="发表于 2025-09-27 12:45:15">2025-09-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/hk.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By cheng_xing</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>